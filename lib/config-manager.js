"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigManager = exports.Stage = void 0;
const aws_cdk_lib_1 = require("aws-cdk-lib");
const logs = __importStar(require("aws-cdk-lib/aws-logs"));
const dotenv = __importStar(require("dotenv"));
const path = __importStar(require("path"));
const zod_1 = require("zod");
const constants = __importStar(require("./constants"));
var Stage;
(function (Stage) {
    Stage["DEV"] = "dev";
    Stage["STAGING"] = "staging";
    Stage["PROD"] = "prod";
})(Stage || (exports.Stage = Stage = {}));
const envSchema = zod_1.z.object({
    STAGE: zod_1.z.enum(['dev', 'staging', 'prod']),
    AWS_ACCOUNT: zod_1.z.string().regex(/^\d{12}$/, "Must be a 12-digit AWS Account ID"),
    AWS_REGION: zod_1.z.string().min(4),
    VECTOR_CONNECTION_STRING: zod_1.z.string().url(),
    VECTOR_SECRET_ARN: zod_1.z.string().includes('arn:aws:secretsmanager'),
    LANGFUSE_SECRET_KEY: zod_1.z.string().startsWith('sk-lf-'),
    LANGFUSE_PUBLIC_KEY: zod_1.z.string().startsWith('pk-lf-'),
    LANGFUSE_BASE_URL: zod_1.z.string().url(),
});
class ConfigManager {
    static instance;
    settings;
    constructor() {
        dotenv.config({ path: path.resolve(__dirname, '../.env') });
        const result = envSchema.safeParse(process.env);
        if (!result.success) {
            console.error("âŒ Invalid environment configuration:");
            console.error(JSON.stringify(result.error.format(), null, 2));
            throw new Error("Config validation failed");
        }
        const env = result.data;
        this.settings = {
            stage: env.STAGE,
            account: env.AWS_ACCOUNT,
            region: env.AWS_REGION,
            agentModel: constants.AGENT_MODEL,
            embeddingModel: constants.EMBEDDING_MODEL,
            evaluationJudgeModel: constants.EVALUATION_JUDGE_MODEL,
            agentName: `${constants.AGENT_NAME}-${env.STAGE}`,
            removalPolicy: env.STAGE === Stage.PROD ? aws_cdk_lib_1.RemovalPolicy.RETAIN : aws_cdk_lib_1.RemovalPolicy.DESTROY,
            appName: constants.APP_NAME,
            domain: constants.DOMAIN,
            agentModelInputTokenPrice: constants.AGENT_MODEL_INPUT_TOKEN_PRICE,
            agentModelOutputTokenPrice: constants.AGENT_MODEL_OUTPUT_TOKEN_PRICE,
            embeddingModelInputTokenPrice: constants.EMBEDDING_MODEL_INPUT_TOKEN_PRICE,
            embeddingModelOutputTokenPrice: constants.EMBEDDING_MODEL_OUTPUT_TOKEN_PRICE,
            evaluationJudgeInputTokenPrice: constants.EVALUATION_JUDGE_INPUT_TOKEN_PRICE,
            evaluationJudgeOutputTokenPrice: constants.EVALUATION_JUDGE_OUTPUT_TOKEN_PRICE,
            allowedOrigins: env.STAGE === Stage.PROD ? constants.ALLOWED_ORIGINS_PROD : constants.ALLOWED_ORIGINS_DEV,
            logRetention: env.STAGE === Stage.PROD ? logs.RetentionDays.ONE_MONTH : logs.RetentionDays.ONE_WEEK,
            vectorStore: {
                embeddingModelArn: `arn:aws:bedrock:${env.AWS_REGION}::foundation-model/${constants.EMBEDDING_MODEL}`,
                connectionString: env.VECTOR_CONNECTION_STRING,
                credentialsSecretArn: env.VECTOR_SECRET_ARN,
            },
            langfuse: {
                secretKey: env.LANGFUSE_SECRET_KEY,
                publicKey: env.LANGFUSE_PUBLIC_KEY,
                baseUrl: env.LANGFUSE_BASE_URL,
            },
        };
        Object.freeze(this.settings);
        Object.freeze(this.settings.vectorStore);
        Object.freeze(this.settings.langfuse);
    }
    static getInstance() {
        if (!ConfigManager.instance) {
            ConfigManager.instance = new ConfigManager();
        }
        return ConfigManager.instance;
    }
    get config() {
        return this.settings;
    }
}
exports.ConfigManager = ConfigManager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLW1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjb25maWctbWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2Q0FBNEM7QUFDNUMsMkRBQTZDO0FBQzdDLCtDQUFpQztBQUNqQywyQ0FBNkI7QUFDN0IsNkJBQXdCO0FBRXhCLHVEQUF5QztBQUN6QyxJQUFZLEtBSVg7QUFKRCxXQUFZLEtBQUs7SUFDYixvQkFBVyxDQUFBO0lBQ1gsNEJBQW1CLENBQUE7SUFDbkIsc0JBQWEsQ0FBQTtBQUNqQixDQUFDLEVBSlcsS0FBSyxxQkFBTCxLQUFLLFFBSWhCO0FBRUQsTUFBTSxTQUFTLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUN2QixLQUFLLEVBQUUsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDekMsV0FBVyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLG1DQUFtQyxDQUFDO0lBQzlFLFVBQVUsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM3Qix3QkFBd0IsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxFQUFFO0lBQzFDLGlCQUFpQixFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsd0JBQXdCLENBQUM7SUFDaEUsbUJBQW1CLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7SUFDcEQsbUJBQW1CLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7SUFDcEQsaUJBQWlCLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRTtDQUN0QyxDQUFD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LENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRU0sTUFBTSxDQUFDLFdBQVc7UUFDckIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUMxQixhQUFhLENBQUMsUUFBUSxHQUFHLElBQUksYUFBYSxFQUFFLENBQUM7UUFDakQsQ0FBQztRQUNELE9BQU8sYUFBYSxDQUFDLFFBQVEsQ0FBQztJQUNsQyxDQUFDO0lBRUQsSUFBVyxNQUFNO1FBQ2IsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3pCLENBQUM7Q0FDSjtBQS9ERCxzQ0ErREMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZW1vdmFsUG9saWN5IH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgbG9ncyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbG9ncyc7XG5pbXBvcnQgKiBhcyBkb3RlbnYgZnJvbSAnZG90ZW52JztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuaW1wb3J0ICogYXMgY29uc3RhbnRzIGZyb20gJy4vY29uc3RhbnRzJztcbmV4cG9ydCBlbnVtIFN0YWdlIHtcbiAgICBERVYgPSAnZGV2JyxcbiAgICBTVEFHSU5HID0gJ3N0YWdpbmcnLFxuICAgIFBST0QgPSAncHJvZCcsXG59XG5cbmNvbnN0IGVudlNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICBTVEFHRTogei5lbnVtKFsnZGV2JywgJ3N0YWdpbmcnLCAncHJvZCddKSxcbiAgICBBV1NfQUNDT1VOVDogei5zdHJpbmcoKS5yZWdleCgvXlxcZHsxMn0kLywgXCJNdXN0IGJlIGEgMTItZGlnaXQgQVdTIEFjY291bnQgSURcIiksXG4gICAgQVdTX1JFR0lPTjogei5zdHJpbmcoKS5taW4oNCksXG4gICAgVkVDVE9SX0NPTk5FQ1RJT05fU1RSSU5HOiB6LnN0cmluZygpLnVybCgpLFxuICAgIFZFQ1RPUl9TRUNSRVRfQVJOOiB6LnN0cmluZygpLmluY2x1ZGVzKCdhcm46YXdzOnNlY3JldHNtYW5hZ2VyJyksXG4gICAgTEFOR0ZVU0VfU0VDUkVUX0tFWTogei5zdHJpbmcoKS5zdGFydHNXaXRoKCdzay1sZi0nKSxcbiAgICBMQU5HRlVTRV9QVUJMSUNfS0VZOiB6LnN0cmluZygpLnN0YXJ0c1dpdGgoJ3BrLWxmLScpLFxuICAgIExBTkdGVVNFX0JBU0VfVVJMOiB6LnN0cmluZygpLnVybCgpLFxufSk7XG5cbmV4cG9ydCB0eXBlIEVudkNvbmZpZyA9IHouaW5mZXI8dHlwZW9mIGVudlNjaGVtYT47XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmVjdG9yU3RvcmVDb25maWcge1xuICAgIHJlYWRvbmx5IGVtYmVkZGluZ01vZGVsQXJuOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgY29ubmVjdGlvblN0cmluZzogc3RyaW5nO1xuICAgIHJlYWRvbmx5IGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGFuZ0Z1c2VDb25maWcge1xuICAgIHJlYWRvbmx5IHNlY3JldEtleTogc3RyaW5nO1xuICAgIHJlYWRvbmx5IHB1YmxpY0tleTogc3RyaW5nO1xuICAgIHJlYWRvbmx5IGJhc2VVcmw6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcHBTZXR0aW5ncyB7XG4gICAgcmVhZG9ubHkgYWNjb3VudDogc3RyaW5nO1xuICAgIHJlYWRvbmx5IHJlZ2lvbjogc3RyaW5nO1xuICAgIHJlYWRvbmx5IGFnZW50TW9kZWw6IHN0cmluZztcbiAgICByZWFkb25seSBlbWJlZGRpbmdNb2RlbDogc3RyaW5nO1xuICAgIHJlYWRvbmx5IGV2YWx1YXRpb25KdWRnZU1vZGVsOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgYWdlbnROYW1lOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgdmVjdG9yU3RvcmU6IFZlY3RvclN0b3JlQ29uZmlnO1xuICAgIHJlYWRvbmx5IHN0YWdlOiBTdGFnZTtcbiAgICByZWFkb25seSByZW1vdmFsUG9saWN5OiBSZW1vdmFsUG9saWN5O1xuICAgIHJlYWRvbmx5IGFwcE5hbWU6IHN0cmluZztcbiAgICByZWFkb25seSBkb21haW46IHN0cmluZztcbiAgICByZWFkb25seSBhZ2VudE1vZGVsSW5wdXRUb2tlblByaWNlOiBudW1iZXI7XG4gICAgcmVhZG9ubHkgYWdlbnRNb2RlbE91dHB1dFRva2VuUHJpY2U6IG51bWJlcjtcbiAgICByZWFkb25seSBlbWJlZGRpbmdNb2RlbElucHV0VG9rZW5QcmljZTogbnVtYmVyO1xuICAgIHJlYWRvbmx5IGVtYmVkZGluZ01vZGVsT3V0cHV0VG9rZW5QcmljZTogbnVtYmVyO1xuICAgIHJlYWRvbmx5IGV2YWx1YXRpb25KdWRnZUlucHV0VG9rZW5QcmljZTogbnVtYmVyO1xuICAgIHJlYWRvbmx5IGV2YWx1YXRpb25KdWRnZU91dHB1dFRva2VuUHJpY2U6IG51bWJlcjtcbiAgICByZWFkb25seSBhbGxvd2VkT3JpZ2luczogc3RyaW5nW107XG4gICAgcmVhZG9ubHkgbG9nUmV0ZW50aW9uOiBsb2dzLlJldGVudGlvbkRheXM7XG4gICAgcmVhZG9ubHkgbGFuZ2Z1c2U6IExhbmdGdXNlQ29uZmlnO1xufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlnTWFuYWdlciB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IENvbmZpZ01hbmFnZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSBzZXR0aW5nczogQXBwU2V0dGluZ3M7XG5cbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBkb3RlbnYuY29uZmlnKHsgcGF0aDogcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uLy5lbnYnKSB9KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBlbnZTY2hlbWEuc2FmZVBhcnNlKHByb2Nlc3MuZW52KTtcblxuICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEludmFsaWQgZW52aXJvbm1lbnQgY29uZmlndXJhdGlvbjpcIik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKEpTT04uc3RyaW5naWZ5KHJlc3VsdC5lcnJvci5mb3JtYXQoKSwgbnVsbCwgMikpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ29uZmlnIHZhbGlkYXRpb24gZmFpbGVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZW52ID0gcmVzdWx0LmRhdGE7XG5cbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHtcbiAgICAgICAgICAgIHN0YWdlOiBlbnYuU1RBR0UgYXMgU3RhZ2UsXG4gICAgICAgICAgICBhY2NvdW50OiBlbnYuQVdTX0FDQ09VTlQsXG4gICAgICAgICAgICByZWdpb246IGVudi5BV1NfUkVHSU9OLFxuICAgICAgICAgICAgYWdlbnRNb2RlbDogY29uc3RhbnRzLkFHRU5UX01PREVMLFxuICAgICAgICAgICAgZW1iZWRkaW5nTW9kZWw6IGNvbnN0YW50cy5FTUJFRERJTkdfTU9ERUwsXG4gICAgICAgICAgICBldmFsdWF0aW9uSnVkZ2VNb2RlbDogY29uc3RhbnRzLkVWQUxVQVRJT05fSlVER0VfTU9ERUwsXG4gICAgICAgICAgICBhZ2VudE5hbWU6IGAke2NvbnN0YW50cy5BR0VOVF9OQU1FfS0ke2Vudi5TVEFHRX1gLFxuICAgICAgICAgICAgcmVtb3ZhbFBvbGljeTogZW52LlNUQUdFID09PSBTdGFnZS5QUk9EID8gUmVtb3ZhbFBvbGljeS5SRVRBSU4gOiBSZW1vdmFsUG9saWN5LkRFU1RST1ksXG4gICAgICAgICAgICBhcHBOYW1lOiBjb25zdGFudHMuQVBQX05BTUUsXG4gICAgICAgICAgICBkb21haW46IGNvbnN0YW50cy5ET01BSU4sXG4gICAgICAgICAgICBhZ2VudE1vZGVsSW5wdXRUb2tlblByaWNlOiBjb25zdGFudHMuQUdFTlRfTU9ERUxfSU5QVVRfVE9LRU5fUFJJQ0UsXG4gICAgICAgICAgICBhZ2VudE1vZGVsT3V0cHV0VG9rZW5QcmljZTogY29uc3RhbnRzLkFHRU5UX01PREVMX09VVFBVVF9UT0tFTl9QUklDRSxcbiAgICAgICAgICAgIGVtYmVkZGluZ01vZGVsSW5wdXRUb2tlblByaWNlOiBjb25zdGFudHMuRU1CRURESU5HX01PREVMX0lOUFVUX1RPS0VOX1BSSUNFLFxuICAgICAgICAgICAgZW1iZWRkaW5nTW9kZWxPdXRwdXRUb2tlblByaWNlOiBjb25zdGFudHMuRU1CRURESU5HX01PREVMX09VVFBVVF9UT0tFTl9QUklDRSxcbiAgICAgICAgICAgIGV2YWx1YXRpb25KdWRnZUlucHV0VG9rZW5QcmljZTogY29uc3RhbnRzLkVWQUxVQVRJT05fSlVER0VfSU5QVVRfVE9LRU5fUFJJQ0UsXG4gICAgICAgICAgICBldmFsdWF0aW9uSnVkZ2VPdXRwdXRUb2tlblByaWNlOiBjb25zdGFudHMuRVZBTFVBVElPTl9KVURHRV9PVVRQVVRfVE9LRU5fUFJJQ0UsXG4gICAgICAgICAgICBhbGxvd2VkT3JpZ2luczogZW52LlNUQUdFID09PSBTdGFnZS5QUk9EID8gY29uc3RhbnRzLkFMTE9XRURfT1JJR0lOU19QUk9EIDogY29uc3RhbnRzLkFMTE9XRURfT1JJR0lOU19ERVYsXG4gICAgICAgICAgICBsb2dSZXRlbnRpb246IGVudi5TVEFHRSA9PT0gU3RhZ2UuUFJPRCA/IGxvZ3MuUmV0ZW50aW9uRGF5cy5PTkVfTU9OVEggOiBsb2dzLlJldGVudGlvbkRheXMuT05FX1dFRUssXG4gICAgICAgICAgICB2ZWN0b3JTdG9yZToge1xuICAgICAgICAgICAgICAgIGVtYmVkZGluZ01vZGVsQXJuOiBgYXJuOmF3czpiZWRyb2NrOiR7ZW52LkFXU19SRUdJT059Ojpmb3VuZGF0aW9uLW1vZGVsLyR7Y29uc3RhbnRzLkVNQkVERElOR19NT0RFTH1gLFxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25TdHJpbmc6IGVudi5WRUNUT1JfQ09OTkVDVElPTl9TVFJJTkcsXG4gICAgICAgICAgICAgICAgY3JlZGVudGlhbHNTZWNyZXRBcm46IGVudi5WRUNUT1JfU0VDUkVUX0FSTixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsYW5nZnVzZToge1xuICAgICAgICAgICAgICAgIHNlY3JldEtleTogZW52LkxBTkdGVVNFX1NFQ1JFVF9LRVksXG4gICAgICAgICAgICAgICAgcHVibGljS2V5OiBlbnYuTEFOR0ZVU0VfUFVCTElDX0tFWSxcbiAgICAgICAgICAgICAgICBiYXNlVXJsOiBlbnYuTEFOR0ZVU0VfQkFTRV9VUkwsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9O1xuXG4gICAgICAgIE9iamVjdC5mcmVlemUodGhpcy5zZXR0aW5ncyk7XG4gICAgICAgIE9iamVjdC5mcmVlemUodGhpcy5zZXR0aW5ncy52ZWN0b3JTdG9yZSk7XG4gICAgICAgIE9iamVjdC5mcmVlemUodGhpcy5zZXR0aW5ncy5sYW5nZnVzZSk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBDb25maWdNYW5hZ2VyIHtcbiAgICAgICAgaWYgKCFDb25maWdNYW5hZ2VyLmluc3RhbmNlKSB7XG4gICAgICAgICAgICBDb25maWdNYW5hZ2VyLmluc3RhbmNlID0gbmV3IENvbmZpZ01hbmFnZXIoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29uZmlnTWFuYWdlci5pbnN0YW5jZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IGNvbmZpZygpOiBBcHBTZXR0aW5ncyB7XG4gICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzO1xuICAgIH1cbn0iXX0=