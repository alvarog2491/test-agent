"use strict";
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.BdaProjectLambda = void 0;
const path = require("path");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const cdk_nag_1 = require("cdk-nag");
/**
 * Lambda function that manages BDA project creation
 */
class BdaProjectLambda extends aws_cdk_lib_1.aws_lambda.Function {
    constructor(scope, id, props) {
        const role = new aws_cdk_lib_1.aws_iam.Role(scope, `${id}manageProject`, {
            assumedBy: new aws_cdk_lib_1.aws_iam.ServicePrincipal('lambda.amazonaws.com'),
        });
        super(scope, id, {
            runtime: aws_cdk_lib_1.aws_lambda.Runtime.PYTHON_3_13,
            handler: 'lambda.handler',
            // eslint-disable-next-line @cdklabs/no-invalid-path
            code: aws_cdk_lib_1.aws_lambda.Code.fromAsset(path.join(__dirname, '../../../../lambda/aws-bedrock-data-automation/bda_project')),
            layers: props.lambdaLayers,
            description: 'BDA control plane for BDA project operations',
            environment: {
                INPUT_BUCKET: props.inputBucket.bucketName,
                POWERTOOLS_SERVICE_NAME: 'BEDROCK_PROJECT',
            },
            memorySize: 1024,
            role: role,
            architecture: aws_cdk_lib_1.aws_lambda.Architecture.X86_64,
            timeout: aws_cdk_lib_1.Duration.minutes(15),
        });
        // Add basic permissions for CloudWatch logs
        const cloudwatchLogsPolicy = new aws_cdk_lib_1.aws_iam.Policy(scope, `${id}LambdaBasicExecPolicy`, {
            statements: [
                new aws_cdk_lib_1.aws_iam.PolicyStatement({
                    effect: aws_cdk_lib_1.aws_iam.Effect.ALLOW,
                    actions: [
                        'logs:CreateLogGroup',
                        'logs:CreateLogStream',
                        'logs:PutLogEvents',
                    ],
                    resources: [
                        `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/${this.functionName}`,
                        `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/${this.functionName}:*`,
                    ],
                }),
            ],
        });
        cdk_nag_1.NagSuppressions.addResourceSuppressions(cloudwatchLogsPolicy, [{ id: 'AwsSolutions-IAM5', reason: 'Lambda requires CloudWatch logs permissions with log group name patterns' }]);
        role.attachInlinePolicy(cloudwatchLogsPolicy);
        // Permissions for BDA
        const bedrockBDAPolicy = new aws_cdk_lib_1.aws_iam.Policy(scope, `${id}BedrockBDAProjectPolicy`, {
            statements: [
                new aws_cdk_lib_1.aws_iam.PolicyStatement({
                    effect: aws_cdk_lib_1.aws_iam.Effect.ALLOW,
                    actions: [
                        'bedrock:CreateDataAutomationProject',
                        'bedrock:ListDataAutomationProjects',
                        'bedrock:DeleteDataAutomationProject',
                        'bedrock:GetDataAutomationProject',
                    ],
                    resources: ['*'],
                }),
            ],
        });
        cdk_nag_1.NagSuppressions.addResourceSuppressions(bedrockBDAPolicy, [{
                id: 'AwsSolutions-IAM5',
                reason: 'Project Lambda need access for managing data processing projects',
            }], true);
        role.attachInlinePolicy(bedrockBDAPolicy);
        // Give Lambda access to the bucket
        if (this.role) {
            props.inputBucket.grantReadWrite(this.role);
        }
        cdk_nag_1.NagSuppressions.addResourceSuppressions(role, [{
                id: 'AwsSolutions-IAM5',
                reason: 'Lambda needs read access to process files from the input bucket',
            }], true);
    }
}
exports.BdaProjectLambda = BdaProjectLambda;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmRhLXByb2plY3QtbGFtYmRhLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3BhdHRlcm5zL2dlbi1haS9hd3MtYmVkcm9jay1kYXRhLWF1dG9tYXRpb24vYmRhLXByb2plY3QtbGFtYmRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7O0FBRUgsNkJBQTZCO0FBQzdCLDZDQUFrRjtBQUVsRixxQ0FBMEM7QUFtQjFDOztHQUVHO0FBQ0gsTUFBYSxnQkFBaUIsU0FBUSx3QkFBTSxDQUFDLFFBQVE7SUFDbkQsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUE0QjtRQUNwRSxNQUFNLElBQUksR0FBRyxJQUFJLHFCQUFHLENBQUMsSUFBSSxDQUN2QixLQUFLLEVBQ0wsR0FBRyxFQUFFLGVBQWUsRUFDcEI7WUFDRSxTQUFTLEVBQUUsSUFBSSxxQkFBRyxDQUFDLGdCQUFnQixDQUFDLHNCQUFzQixDQUFDO1NBQzVELENBQ0YsQ0FBQztRQUVGLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFO1lBRWYsT0FBTyxFQUFFLHdCQUFNLENBQUMsT0FBTyxDQUFDLFdBQVc7WUFDbkMsT0FBTyxFQUFFLGdCQUFnQjtZQUN6QixvREFBb0Q7WUFDcEQsSUFBSSxFQUFFLHdCQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSw0REFBNEQsQ0FBQyxDQUFDO1lBQy9HLE1BQU0sRUFBRSxLQUFLLENBQUMsWUFBWTtZQUMxQixXQUFXLEVBQUUsOENBQThDO1lBQzNELFdBQVcsRUFBRTtnQkFDWCxZQUFZLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVO2dCQUMxQyx1QkFBdUIsRUFBRSxpQkFBaUI7YUFDM0M7WUFDRCxVQUFVLEVBQUUsSUFBSTtZQUNoQixJQUFJLEVBQUUsSUFBSTtZQUNWLFlBQVksRUFBRSx3QkFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNO1lBQ3hDLE9BQU8sRUFBRSxzQkFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7U0FDOUIsQ0FBQyxDQUFDO1FBRUgsNENBQTRDO1FBQzVDLE1BQU0sb0JBQW9CLEdBQUcsSUFBSSxxQkFBRyxDQUFDLE1BQU0sQ0FDekMsS0FBSyxFQUNMLEdBQUcsRUFBRSx1QkFBdUIsRUFDNUI7WUFDRSxVQUFVLEVBQUU7Z0JBQ1YsSUFBSSxxQkFBRyxDQUFDLGVBQWUsQ0FBQztvQkFDdEIsTUFBTSxFQUFFLHFCQUFHLENBQUMsTUFBTSxDQUFDLEtBQUs7b0JBQ3hCLE9BQU8sRUFBRTt3QkFDUCxxQkFBcUI7d0JBQ3JCLHNCQUFzQjt3QkFDdEIsbUJBQW1CO3FCQUNwQjtvQkFDRCxTQUFTLEVBQUU7d0JBQ1QsT0FBTyxpQkFBRyxDQUFDLFNBQVMsU0FBUyxpQkFBRyxDQUFDLE1BQU0sSUFBSSxpQkFBRyxDQUFDLFVBQVUsMEJBQTBCLElBQUksQ0FBQyxZQUFZLEVBQUU7d0JBQ3RHLE9BQU8saUJBQUcsQ0FBQyxTQUFTLFNBQVMsaUJBQUcsQ0FBQyxNQUFNLElBQUksaUJBQUcsQ0FBQyxVQUFVLDBCQUEwQixJQUFJLENBQUMsWUFBWSxJQUFJO3FCQUN6RztpQkFDRixDQUFDO2FBQ0g7U0FDRixDQUNGLENBQUM7UUFFRix5QkFBZSxDQUFDLHVCQUF1QixDQUNyQyxvQkFBb0IsRUFDcEIsQ0FBQyxFQUFFLEVBQUUsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLEVBQUUsMEVBQTBFLEVBQUUsQ0FBQyxDQUNsSCxDQUFDO1FBRUYsSUFBSSxDQUFDLGtCQUFrQixDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFFOUMsc0JBQXNCO1FBQ3RCLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxxQkFBRyxDQUFDLE1BQU0sQ0FDckMsS0FBSyxFQUNMLEdBQUcsRUFBRSx5QkFBeUIsRUFDOUI7WUFDRSxVQUFVLEVBQUU7Z0JBQ1YsSUFBSSxxQkFBRyxDQUFDLGVBQWUsQ0FBQztvQkFDdEIsTUFBTSxFQUFFLHFCQUFHLENBQUMsTUFBTSxDQUFDLEtBQUs7b0JBQ3hCLE9BQU8sRUFBRTt3QkFDUCxxQ0FBcUM7d0JBQ3JDLG9DQUFvQzt3QkFDcEMscUNBQXFDO3dCQUNyQyxrQ0FBa0M7cUJBQ25DO29CQUNELFNBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQztpQkFDakIsQ0FBQzthQUNIO1NBQ0YsQ0FDRixDQUFDO1FBRUYseUJBQWUsQ0FBQyx1QkFBdUIsQ0FDckMsZ0JBQWdCLEVBQ2hCLENBQUM7Z0JBQ0MsRUFBRSxFQUFFLG1CQUFtQjtnQkFDdkIsTUFBTSxFQUFFLGtFQUFrRTthQUMzRSxDQUFDLEVBQ0YsSUFBSSxDQUNMLENBQUM7UUFDRixJQUFJLENBQUMsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUUxQyxtQ0FBbUM7UUFDbkMsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDZCxLQUFLLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUMsQ0FBQztRQUVELHlCQUFlLENBQUMsdUJBQXVCLENBQ3JDLElBQUksRUFDSixDQUFDO2dCQUNDLEVBQUUsRUFBRSxtQkFBbUI7Z0JBQ3ZCLE1BQU0sRUFBRSxpRUFBaUU7YUFDMUUsQ0FBQyxFQUNGLElBQUksQ0FDTCxDQUFDO0lBQ0osQ0FBQztDQUNGO0FBckdELDRDQXFHQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBhd3NfaWFtIGFzIGlhbSwgYXdzX2xhbWJkYSBhcyBsYW1iZGEsIER1cmF0aW9uLCBBd3MgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBzMyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtczMnO1xuaW1wb3J0IHsgTmFnU3VwcHJlc3Npb25zIH0gZnJvbSAnY2RrLW5hZyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcblxuLyoqXG4gKiBQcm9wZXJ0aWVzIGZvciBjcmVhdGluZyBhIEJkYVByb2plY3RMYW1iZGFQcm9wc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIEJkYVByb2plY3RMYW1iZGFQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgUzMgYnVja2V0XG4gICAqIGZvciBpbnB1dCBkYXRhIHVzZWQgYnkgdGhlIEJlZHJvY2sgRGF0YSBBdXRvbWF0aW9uIHByb2Nlc3MuXG4gICAqIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgYnVja2V0IHdpbGwgYmUgY3JlYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGlucHV0QnVja2V0OiBzMy5JQnVja2V0O1xuICAvKipcbiAgICogVGhlIGxheWVycyB0byBhcHBseSB0byB0aGlzIGxhbWJkYSBmdW5jdGlvbi5cbiAgICovXG4gIHJlYWRvbmx5IGxhbWJkYUxheWVyczogbGFtYmRhLklMYXllclZlcnNpb25bXTtcbn1cblxuLyoqXG4gKiBMYW1iZGEgZnVuY3Rpb24gdGhhdCBtYW5hZ2VzIEJEQSBwcm9qZWN0IGNyZWF0aW9uXG4gKi9cbmV4cG9ydCBjbGFzcyBCZGFQcm9qZWN0TGFtYmRhIGV4dGVuZHMgbGFtYmRhLkZ1bmN0aW9uIHtcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IEJkYVByb2plY3RMYW1iZGFQcm9wcykge1xuICAgIGNvbnN0IHJvbGUgPSBuZXcgaWFtLlJvbGUoXG4gICAgICBzY29wZSxcbiAgICAgIGAke2lkfW1hbmFnZVByb2plY3RgLFxuICAgICAge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnbGFtYmRhLmFtYXpvbmF3cy5jb20nKSxcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIHN1cGVyKHNjb3BlLCBpZCwge1xuXG4gICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5QWVRIT05fM18xMyxcbiAgICAgIGhhbmRsZXI6ICdsYW1iZGEuaGFuZGxlcicsXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGNka2xhYnMvbm8taW52YWxpZC1wYXRoXG4gICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tQXNzZXQocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uLy4uLy4uL2xhbWJkYS9hd3MtYmVkcm9jay1kYXRhLWF1dG9tYXRpb24vYmRhX3Byb2plY3QnKSksXG4gICAgICBsYXllcnM6IHByb3BzLmxhbWJkYUxheWVycyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQkRBIGNvbnRyb2wgcGxhbmUgZm9yIEJEQSBwcm9qZWN0IG9wZXJhdGlvbnMnLFxuICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgSU5QVVRfQlVDS0VUOiBwcm9wcy5pbnB1dEJ1Y2tldC5idWNrZXROYW1lLFxuICAgICAgICBQT1dFUlRPT0xTX1NFUlZJQ0VfTkFNRTogJ0JFRFJPQ0tfUFJPSkVDVCcsXG4gICAgICB9LFxuICAgICAgbWVtb3J5U2l6ZTogMTAyNCxcbiAgICAgIHJvbGU6IHJvbGUsXG4gICAgICBhcmNoaXRlY3R1cmU6IGxhbWJkYS5BcmNoaXRlY3R1cmUuWDg2XzY0LFxuICAgICAgdGltZW91dDogRHVyYXRpb24ubWludXRlcygxNSksXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgYmFzaWMgcGVybWlzc2lvbnMgZm9yIENsb3VkV2F0Y2ggbG9nc1xuICAgIGNvbnN0IGNsb3Vkd2F0Y2hMb2dzUG9saWN5ID0gbmV3IGlhbS5Qb2xpY3koXG4gICAgICBzY29wZSxcbiAgICAgIGAke2lkfUxhbWJkYUJhc2ljRXhlY1BvbGljeWAsXG4gICAgICB7XG4gICAgICAgIHN0YXRlbWVudHM6IFtcbiAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAgICdsb2dzOkNyZWF0ZUxvZ0dyb3VwJyxcbiAgICAgICAgICAgICAgJ2xvZ3M6Q3JlYXRlTG9nU3RyZWFtJyxcbiAgICAgICAgICAgICAgJ2xvZ3M6UHV0TG9nRXZlbnRzJyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICAgICAgYGFybjoke0F3cy5QQVJUSVRJT059OmxvZ3M6JHtBd3MuUkVHSU9OfToke0F3cy5BQ0NPVU5UX0lEfTpsb2ctZ3JvdXA6L2F3cy9sYW1iZGEvJHt0aGlzLmZ1bmN0aW9uTmFtZX1gLFxuICAgICAgICAgICAgICBgYXJuOiR7QXdzLlBBUlRJVElPTn06bG9nczoke0F3cy5SRUdJT059OiR7QXdzLkFDQ09VTlRfSUR9OmxvZy1ncm91cDovYXdzL2xhbWJkYS8ke3RoaXMuZnVuY3Rpb25OYW1lfToqYCxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSksXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgICk7XG5cbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICBjbG91ZHdhdGNoTG9nc1BvbGljeSxcbiAgICAgIFt7IGlkOiAnQXdzU29sdXRpb25zLUlBTTUnLCByZWFzb246ICdMYW1iZGEgcmVxdWlyZXMgQ2xvdWRXYXRjaCBsb2dzIHBlcm1pc3Npb25zIHdpdGggbG9nIGdyb3VwIG5hbWUgcGF0dGVybnMnIH1dLFxuICAgICk7XG5cbiAgICByb2xlLmF0dGFjaElubGluZVBvbGljeShjbG91ZHdhdGNoTG9nc1BvbGljeSk7XG5cbiAgICAvLyBQZXJtaXNzaW9ucyBmb3IgQkRBXG4gICAgY29uc3QgYmVkcm9ja0JEQVBvbGljeSA9IG5ldyBpYW0uUG9saWN5KFxuICAgICAgc2NvcGUsXG4gICAgICBgJHtpZH1CZWRyb2NrQkRBUHJvamVjdFBvbGljeWAsXG4gICAgICB7XG4gICAgICAgIHN0YXRlbWVudHM6IFtcbiAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAgICdiZWRyb2NrOkNyZWF0ZURhdGFBdXRvbWF0aW9uUHJvamVjdCcsXG4gICAgICAgICAgICAgICdiZWRyb2NrOkxpc3REYXRhQXV0b21hdGlvblByb2plY3RzJyxcbiAgICAgICAgICAgICAgJ2JlZHJvY2s6RGVsZXRlRGF0YUF1dG9tYXRpb25Qcm9qZWN0JyxcbiAgICAgICAgICAgICAgJ2JlZHJvY2s6R2V0RGF0YUF1dG9tYXRpb25Qcm9qZWN0JyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICApO1xuXG4gICAgTmFnU3VwcHJlc3Npb25zLmFkZFJlc291cmNlU3VwcHJlc3Npb25zKFxuICAgICAgYmVkcm9ja0JEQVBvbGljeSxcbiAgICAgIFt7XG4gICAgICAgIGlkOiAnQXdzU29sdXRpb25zLUlBTTUnLFxuICAgICAgICByZWFzb246ICdQcm9qZWN0IExhbWJkYSBuZWVkIGFjY2VzcyBmb3IgbWFuYWdpbmcgZGF0YSBwcm9jZXNzaW5nIHByb2plY3RzJyxcbiAgICAgIH1dLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuICAgIHJvbGUuYXR0YWNoSW5saW5lUG9saWN5KGJlZHJvY2tCREFQb2xpY3kpO1xuXG4gICAgLy8gR2l2ZSBMYW1iZGEgYWNjZXNzIHRvIHRoZSBidWNrZXRcbiAgICBpZiAodGhpcy5yb2xlKSB7XG4gICAgICBwcm9wcy5pbnB1dEJ1Y2tldC5ncmFudFJlYWRXcml0ZSh0aGlzLnJvbGUpO1xuICAgIH1cblxuICAgIE5hZ1N1cHByZXNzaW9ucy5hZGRSZXNvdXJjZVN1cHByZXNzaW9ucyhcbiAgICAgIHJvbGUsXG4gICAgICBbe1xuICAgICAgICBpZDogJ0F3c1NvbHV0aW9ucy1JQU01JyxcbiAgICAgICAgcmVhc29uOiAnTGFtYmRhIG5lZWRzIHJlYWQgYWNjZXNzIHRvIHByb2Nlc3MgZmlsZXMgZnJvbSB0aGUgaW5wdXQgYnVja2V0JyxcbiAgICAgIH1dLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuICB9XG59XG4iXX0=