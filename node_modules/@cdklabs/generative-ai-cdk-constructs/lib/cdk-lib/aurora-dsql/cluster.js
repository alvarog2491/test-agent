"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Cluster = exports.ClusterBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const dsql = require("aws-cdk-lib/aws-dsql");
const iam = require("aws-cdk-lib/aws-iam");
// Internal libs
const perms = require("./perms");
const validation_helpers_1 = require("./validation-helpers");
/******************************************************************************
 *                              CONSTANTS
 *****************************************************************************/
/**
 * Minimum length for cluster tags
 * @internal
 */
const CLUSTER_TAG_MIN_LENGTH = 1;
/**
 * Maximum length for browser tags
 * @internal
 */
const CLUSTER_TAG_MAX_LENGTH = 256;
/******************************************************************************
 *                        ABSTRACT BASE CLASS
 *****************************************************************************/
/**
 * Abstract base class for a Aurora DSQL cluster.
 * Contains methods and attributes valid for Aurora DSQL clusters either created with CDK or imported.
 */
class ClusterBase extends aws_cdk_lib_1.Resource {
    constructor(scope, id) {
        super(scope, id);
    }
    /**
     * Grants IAM actions to the IAM Principal
     * @param grantee - The IAM principal to grant permissions to
     * @param actions - The actions to grant
     * @returns An IAM Grant object representing the granted permissions
     */
    grant(grantee, ...actions) {
        return iam.Grant.addToPrincipal({
            grantee: grantee,
            resourceArns: [this.clusterArn],
            actions: actions,
        });
    }
    /**
     * Grants connection authorization to the IAM Principal
     * @see https://docs.aws.amazon.com/aurora-dsql/latest/userguide/authentication-authorization.html#authentication-authorization-iam-policy
     * @param grantee - The IAM principal to grant permissions to
     * @default - Default grant configuration:
     * - actions: ['dsql:DbConnect'] on this.clusterArn
     * @returns An IAM Grant object representing the granted permissions
     */
    grantConnect(grantee) {
        return this.grant(grantee, ...perms.AURORA_DSQL_CONNECT_PERMS);
    }
    /**
     * Grants connection authorization to the IAM Principal
     * @see https://docs.aws.amazon.com/aurora-dsql/latest/userguide/authentication-authorization.html#authentication-authorization-iam-policy
     * @param grantee - The IAM principal to grant permissions to
     * @default - Default grant configuration:
     * - actions: ['dsql:DbConnectAdmin'] on this.clusterArn
     * @returns An IAM Grant object representing the granted permissions
     */
    grantConnectAdmin(grantee) {
        return this.grant(grantee, ...perms.AURORA_DSQL_CONNECT_ADMIN_PERMS);
    }
}
exports.ClusterBase = ClusterBase;
_a = JSII_RTTI_SYMBOL_1;
ClusterBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.auroraDsql.ClusterBase", version: "0.1.312" };
/******************************************************************************
 *                                Class
 *****************************************************************************/
/**
 * Aurora DSQL cluster resource for AWS Aurora DSQL.
 * You can use this resource to create, modify, and manage clusters.
 * @see https://docs.aws.amazon.com/aurora-dsql/latest/userguide/what-is-aurora-dsql.html
 * @resource AWS::DSQL::Cluster
 */
class Cluster extends ClusterBase {
    /**
     * Static Method for importing an existing Aurora DSQL cluster.
     */
    /**
     * Creates an Aurora DSQL cluster reference from an existing cluster's attributes.
     *
     * @param scope - The construct scope
     * @param id - Identifier of the construct
     * @param attrs - Attributes of the existing cluster
     * @returns An ICluster reference to the existing cluster
     */
    static fromClusterAttributes(scope, id, attrs) {
        class Import extends ClusterBase {
            constructor(s, i) {
                super(s, i);
                this.clusterArn = attrs.clusterArn;
                this.clusterId = aws_cdk_lib_1.Arn.split(attrs.clusterArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME).resourceName;
                this.creationTime = attrs.creationTime;
                this.status = attrs.status;
                this.vpcEndpointServiceName = attrs.vpcEndpointServiceName;
                this.encryptionKey = attrs.encryptionKey;
            }
        }
        // Return new Cluster
        return new Import(scope, id);
    }
    // ------------------------------------------------------
    // CONSTRUCTOR
    // ------------------------------------------------------
    constructor(scope, id, props) {
        super(scope, id);
        // ------------------------------------------------------
        // Validators
        // ------------------------------------------------------
        /**
         * Validates the multi-region properties
         * @param props The multi-region properties to validate
         * @throws Error if the multi-region properties are invalid
         */
        this._validateMultiRegionProperties = (props) => {
            if (!props) {
                return;
            }
            // The witness Region specified in multiRegionProperties.witnessRegion cannot be the same as the cluster's Region.
            if (props.witnessRegion && !aws_cdk_lib_1.Token.isUnresolved(this.stack.region)) {
                if (props.witnessRegion === this.stack.region) {
                    throw new Error('Witness region cannot be the same as the cluster\'s Region');
                }
            }
            // For the provided peered clusters, they must be in different Regions.
            if (props.clusters && !aws_cdk_lib_1.Token.isUnresolved(this.stack.region)) {
                for (const cluster of props.clusters) {
                    const region = aws_cdk_lib_1.Arn.split(cluster.clusterArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME).region;
                    if (region === this.stack.region) {
                        throw new Error(`Peered cluster ${cluster.clusterArn} cannot be in the same Region ${this.stack.region} as the cluster's Region`);
                    }
                }
            }
        };
        /**
         * Validates the removal policy
         * @param removalPolicy The removal policy to validate
         * @throws Error if the removal policy is invalid
         */
        this._validateRemovalPolicy = (removalPolicy) => {
            if (removalPolicy && removalPolicy !== aws_cdk_lib_1.RemovalPolicy.DESTROY && removalPolicy !== aws_cdk_lib_1.RemovalPolicy.RETAIN) {
                throw new Error('Invalid removal policy. Only RemovalPolicy.DESTROY and RemovalPolicy.RETAIN are allowed.');
            }
        };
        /**
         * Validates the cluster tags format
         * @param tags The tags object to validate
         * @returns Array of validation error messages, empty if valid
         */
        this._validateClusterTags = (tags) => {
            let errors = [];
            if (!tags) {
                return errors; // Tags are optional
            }
            // Validate each tag key and value
            for (const [key, value] of Object.entries(tags)) {
                errors.push(...(0, validation_helpers_1.validateStringFieldLength)({
                    value: key,
                    fieldName: 'Tag key',
                    minLength: CLUSTER_TAG_MIN_LENGTH,
                    maxLength: CLUSTER_TAG_MAX_LENGTH,
                }));
                // Validate tag key pattern: ^[a-zA-Z0-9\s._:/=+@-]*$
                const validKeyPattern = /^[a-zA-Z0-9\s._:/=+@-]*$/;
                errors.push(...(0, validation_helpers_1.validateFieldPattern)(key, 'Tag key', validKeyPattern));
                // Validate tag value
                errors.push(...(0, validation_helpers_1.validateStringFieldLength)({
                    value: value,
                    fieldName: 'Tag value',
                    minLength: CLUSTER_TAG_MIN_LENGTH,
                    maxLength: CLUSTER_TAG_MAX_LENGTH,
                }));
                // Validate tag value pattern: ^[a-zA-Z0-9\s._:/=+@-]*$
                const validValuePattern = /^[a-zA-Z0-9\s._:/=+@-]*$/;
                errors.push(...(0, validation_helpers_1.validateFieldPattern)(value, 'Tag value', validValuePattern));
            }
            return errors;
        };
        // ------------------------------------------------------
        // Set properties and defaults
        // ------------------------------------------------------
        this.tags = props.tags;
        this.multiRegionProperties = props.multiRegionProperties;
        this.encryptionKey = props.kmsKey;
        // ------------------------------------------------------
        // Validation
        // ------------------------------------------------------
        this._validateMultiRegionProperties(this.multiRegionProperties);
        (0, validation_helpers_1.throwIfInvalid)(this._validateClusterTags, this.tags);
        this._validateRemovalPolicy(props.removalPolicy);
        // ------------------------------------------------------
        // CFN Props - With Lazy support
        // ------------------------------------------------------
        const cfnProps = {
            deletionProtectionEnabled: props.removalPolicy ? props.removalPolicy === aws_cdk_lib_1.RemovalPolicy.RETAIN : false,
            kmsEncryptionKey: this.encryptionKey?.keyArn,
            multiRegionProperties: this._renderMultiRegionProperties(),
            tags: this.tags ? Object.entries(this.tags).map(([key, value]) => ({ key, value })) : undefined,
        };
        // ------------------------------------------------------
        // Create the resource
        // ------------------------------------------------------
        this.__resource = new dsql.CfnCluster(this, 'Resource', cfnProps);
        // Get attributes directly from the CloudFormation resource
        this.clusterArn = this.__resource.attrResourceArn;
        this.creationTime = this.__resource.attrCreationTime;
        this.clusterId = this.__resource.attrIdentifier;
        this.status = this.__resource.attrStatus;
        this.vpcEndpointServiceName = this.__resource.attrVpcEndpointServiceName;
    }
    /**
     * Render the multi-region properties.
     *
     * @returns MultiRegionPropertiesProperty object in CloudFormation format, or undefined if no multi-region properties are defined
     * @default - undefined if no multi-region properties are provided
     * @internal This is an internal core function and should not be called directly.
     */
    _renderMultiRegionProperties() {
        return this.multiRegionProperties ? {
            clusters: this.multiRegionProperties.clusters?.map(cluster => cluster.clusterArn),
            witnessRegion: this.multiRegionProperties.witnessRegion,
        } : undefined;
    }
}
exports.Cluster = Cluster;
_b = JSII_RTTI_SYMBOL_1;
Cluster[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.auroraDsql.Cluster", version: "0.1.312" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2x1c3Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jZGstbGliL2F1cm9yYS1kc3FsL2NsdXN0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUVILDZDQUF3RjtBQUN4Riw2Q0FBNkM7QUFDN0MsMkNBQTJDO0FBSTNDLGdCQUFnQjtBQUNoQixpQ0FBaUM7QUFDakMsNkRBQXVHO0FBRXZHOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBTSxzQkFBc0IsR0FBRyxDQUFDLENBQUM7QUFFakM7OztHQUdHO0FBQ0gsTUFBTSxzQkFBc0IsR0FBRyxHQUFHLENBQUM7QUFvRG5DOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBc0IsV0FBWSxTQUFRLHNCQUFRO0lBMEJoRCxZQUFZLEtBQWdCLEVBQUUsRUFBVTtRQUN0QyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNJLEtBQUssQ0FBQyxPQUF1QixFQUFFLEdBQUcsT0FBaUI7UUFDeEQsT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQztZQUM5QixPQUFPLEVBQUUsT0FBTztZQUNoQixZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1lBQy9CLE9BQU8sRUFBRSxPQUFPO1NBQ2pCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7Ozs7OztPQU9HO0lBQ0ksWUFBWSxDQUFDLE9BQXVCO1FBQ3pDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNJLGlCQUFpQixDQUFDLE9BQXVCO1FBQzlDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxLQUFLLENBQUMsK0JBQStCLENBQUMsQ0FBQztJQUN2RSxDQUFDOztBQWxFSCxrQ0FtRUM7OztBQWdHRDs7K0VBRStFO0FBQy9FOzs7OztHQUtHO0FBQ0gsTUFBYSxPQUFRLFNBQVEsV0FBVztJQUN0Qzs7T0FFRztJQUNIOzs7Ozs7O09BT0c7SUFDSSxNQUFNLENBQUMscUJBQXFCLENBQUMsS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBd0I7UUFDeEYsTUFBTSxNQUFPLFNBQVEsV0FBVztZQVE5QixZQUFZLENBQVksRUFBRSxDQUFTO2dCQUNqQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQVJFLGVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO2dCQUM5QixjQUFTLEdBQUcsaUJBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSx1QkFBUyxDQUFDLG1CQUFtQixDQUFDLENBQUMsWUFBYSxDQUFDO2dCQUNyRixpQkFBWSxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUM7Z0JBQ2xDLFdBQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO2dCQUN0QiwyQkFBc0IsR0FBRyxLQUFLLENBQUMsc0JBQXNCLENBQUM7Z0JBQ3RELGtCQUFhLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQztZQUlwRCxDQUFDO1NBQ0Y7UUFFRCxxQkFBcUI7UUFDckIsT0FBTyxJQUFJLE1BQU0sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQWtERCx5REFBeUQ7SUFDekQsY0FBYztJQUNkLHlEQUF5RDtJQUN6RCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQXlCO1FBQ2pFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFxRG5CLHlEQUF5RDtRQUN6RCxhQUFhO1FBQ2IseURBQXlEO1FBQ3pEOzs7O1dBSUc7UUFDSyxtQ0FBOEIsR0FBRyxDQUFDLEtBQXdDLEVBQVEsRUFBRTtZQUMxRixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ1gsT0FBTztZQUNULENBQUM7WUFFRCxrSEFBa0g7WUFDbEgsSUFBSSxLQUFLLENBQUMsYUFBYSxJQUFJLENBQUMsbUJBQUssQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO2dCQUNsRSxJQUFJLEtBQUssQ0FBQyxhQUFhLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztvQkFDOUMsTUFBTSxJQUFJLEtBQUssQ0FBQyw0REFBNEQsQ0FBQyxDQUFDO2dCQUNoRixDQUFDO1lBQ0gsQ0FBQztZQUVELHVFQUF1RTtZQUN2RSxJQUFJLEtBQUssQ0FBQyxRQUFRLElBQUksQ0FBQyxtQkFBSyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7Z0JBQzdELEtBQUssTUFBTSxPQUFPLElBQUksS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUNyQyxNQUFNLE1BQU0sR0FBRyxpQkFBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLHVCQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxNQUFNLENBQUM7b0JBQ25GLElBQUksTUFBTSxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7d0JBQ2pDLE1BQU0sSUFBSSxLQUFLLENBQUMsa0JBQWtCLE9BQU8sQ0FBQyxVQUFVLGlDQUFpQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sMEJBQTBCLENBQUMsQ0FBQztvQkFDcEksQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUMsQ0FBQztRQUVGOzs7O1dBSUc7UUFDSywyQkFBc0IsR0FBRyxDQUFDLGFBQTZCLEVBQVEsRUFBRTtZQUN2RSxJQUFJLGFBQWEsSUFBSSxhQUFhLEtBQUssMkJBQWEsQ0FBQyxPQUFPLElBQUksYUFBYSxLQUFLLDJCQUFhLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQ3ZHLE1BQU0sSUFBSSxLQUFLLENBQUMsMEZBQTBGLENBQUMsQ0FBQztZQUM5RyxDQUFDO1FBQ0gsQ0FBQyxDQUFDO1FBRUY7Ozs7V0FJRztRQUNLLHlCQUFvQixHQUFHLENBQUMsSUFBZ0MsRUFBWSxFQUFFO1lBQzVFLElBQUksTUFBTSxHQUFhLEVBQUUsQ0FBQztZQUMxQixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ1YsT0FBTyxNQUFNLENBQUMsQ0FBQyxvQkFBb0I7WUFDckMsQ0FBQztZQUVELGtDQUFrQztZQUNsQyxLQUFLLE1BQU0sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUNoRCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBQSw4Q0FBeUIsRUFBQztvQkFDdkMsS0FBSyxFQUFFLEdBQUc7b0JBQ1YsU0FBUyxFQUFFLFNBQVM7b0JBQ3BCLFNBQVMsRUFBRSxzQkFBc0I7b0JBQ2pDLFNBQVMsRUFBRSxzQkFBc0I7aUJBQ2xDLENBQUMsQ0FBQyxDQUFDO2dCQUVKLHFEQUFxRDtnQkFDckQsTUFBTSxlQUFlLEdBQUcsMEJBQTBCLENBQUM7Z0JBQ25ELE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFBLHlDQUFvQixFQUFDLEdBQUcsRUFBRSxTQUFTLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQztnQkFFdEUscUJBQXFCO2dCQUNyQixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBQSw4Q0FBeUIsRUFBQztvQkFDdkMsS0FBSyxFQUFFLEtBQUs7b0JBQ1osU0FBUyxFQUFFLFdBQVc7b0JBQ3RCLFNBQVMsRUFBRSxzQkFBc0I7b0JBQ2pDLFNBQVMsRUFBRSxzQkFBc0I7aUJBQ2xDLENBQUMsQ0FBQyxDQUFDO2dCQUVKLHVEQUF1RDtnQkFDdkQsTUFBTSxpQkFBaUIsR0FBRywwQkFBMEIsQ0FBQztnQkFDckQsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUEseUNBQW9CLEVBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7WUFDOUUsQ0FBQztZQUVELE9BQU8sTUFBTSxDQUFDO1FBQ2hCLENBQUMsQ0FBQztRQW5JQSx5REFBeUQ7UUFDekQsOEJBQThCO1FBQzlCLHlEQUF5RDtRQUN6RCxJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDdkIsSUFBSSxDQUFDLHFCQUFxQixHQUFHLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQztRQUN6RCxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFFbEMseURBQXlEO1FBQ3pELGFBQWE7UUFDYix5REFBeUQ7UUFDekQsSUFBSSxDQUFDLDhCQUE4QixDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ2hFLElBQUEsbUNBQWMsRUFBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFakQseURBQXlEO1FBQ3pELGdDQUFnQztRQUNoQyx5REFBeUQ7UUFDekQsTUFBTSxRQUFRLEdBQXlCO1lBQ3JDLHlCQUF5QixFQUFFLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxhQUFhLEtBQUssMkJBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUs7WUFDckcsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxNQUFNO1lBQzVDLHFCQUFxQixFQUFFLElBQUksQ0FBQyw0QkFBNEIsRUFBRTtZQUMxRCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO1NBQ2hHLENBQUM7UUFFRix5REFBeUQ7UUFDekQsc0JBQXNCO1FBQ3RCLHlEQUF5RDtRQUN6RCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRWxFLDJEQUEyRDtRQUMzRCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDO1FBQ2xELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQztRQUNyRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDO1FBQ2hELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUM7UUFDekMsSUFBSSxDQUFDLHNCQUFzQixHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsMEJBQTBCLENBQUM7SUFDM0UsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNLLDRCQUE0QjtRQUNsQyxPQUFPLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUM7WUFDbEMsUUFBUSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztZQUNqRixhQUFhLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGFBQWE7U0FDeEQsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQ2hCLENBQUM7O0FBcklILDBCQXdOQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IElSZXNvdXJjZSwgUmVzb3VyY2UsIEFybiwgQXJuRm9ybWF0LCBUb2tlbiwgUmVtb3ZhbFBvbGljeSB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGRzcWwgZnJvbSAnYXdzLWNkay1saWIvYXdzLWRzcWwnO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0ICogYXMga21zIGZyb20gJ2F3cy1jZGstbGliL2F3cy1rbXMnO1xuaW1wb3J0IHsgSUtleSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1rbXMnO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG4vLyBJbnRlcm5hbCBsaWJzXG5pbXBvcnQgKiBhcyBwZXJtcyBmcm9tICcuL3Blcm1zJztcbmltcG9ydCB7IHZhbGlkYXRlU3RyaW5nRmllbGRMZW5ndGgsIHZhbGlkYXRlRmllbGRQYXR0ZXJuLCB0aHJvd0lmSW52YWxpZCB9IGZyb20gJy4vdmFsaWRhdGlvbi1oZWxwZXJzJztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDT05TVEFOVFNcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogTWluaW11bSBsZW5ndGggZm9yIGNsdXN0ZXIgdGFnc1xuICogQGludGVybmFsXG4gKi9cbmNvbnN0IENMVVNURVJfVEFHX01JTl9MRU5HVEggPSAxO1xuXG4vKipcbiAqIE1heGltdW0gbGVuZ3RoIGZvciBicm93c2VyIHRhZ3NcbiAqIEBpbnRlcm5hbFxuICovXG5jb25zdCBDTFVTVEVSX1RBR19NQVhfTEVOR1RIID0gMjU2O1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW50ZXJmYWNlXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIEludGVyZmFjZSBmb3IgQXVyb3JhIERTUUwgY2x1c3RlciByZXNvdXJjZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJQ2x1c3RlciBleHRlbmRzIElSZXNvdXJjZSB7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBjbHVzdGVyXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHJlYWRvbmx5IGNsdXN0ZXJBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB0aW1lc3RhbXAgd2hlbiB0aGUgY2x1c3RlciB3YXMgY3JlYXRlZCwgaW4gSVNPIDg2MDEgZm9ybWF0LlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSBjcmVhdGlvblRpbWU/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgaWQgb2YgdGhlIGNsdXN0ZXIuXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHJlYWRvbmx5IGNsdXN0ZXJJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHN0YXR1cyBvZiB0aGUgY2x1c3Rlci5cbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgc3RhdHVzPzogc3RyaW5nO1xuICAvKlxuICAgICogVnBjRW5kcG9pbnRTZXJ2aWNlTmFtZSBvZiB0aGUgY2x1c3Rlci5cbiAgICAqIEBhdHRyaWJ1dGVcbiAgICAqL1xuICByZWFkb25seSB2cGNFbmRwb2ludFNlcnZpY2VOYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPcHRpb25hbCBLTVMgZW5jcnlwdGlvbiBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoaXMgYnVja2V0LlxuICAgKi9cbiAgcmVhZG9ubHkgZW5jcnlwdGlvbktleT86IGttcy5JS2V5O1xuICAvKipcbiAgICogR3JhbnRzIElBTSBhY3Rpb25zIHRvIHRoZSBJQU0gUHJpbmNpcGFsXG4gICAqL1xuICBncmFudChncmFudGVlOiBpYW0uSUdyYW50YWJsZSwgLi4uYWN0aW9uczogc3RyaW5nW10pOiBpYW0uR3JhbnQ7XG4gIC8qKlxuICAgKiBncmFudHMgY29ubmVjdGlvbiBhdXRob3JpemF0aW9uIGZvciBhIGN1c3RvbSBkYXRhYmFzZSByb2xlIHRvIHRoZSBJQU0gUHJpbmNpcGFsXG4gICAqL1xuICBncmFudENvbm5lY3QoZ3JhbnRlZTogaWFtLklHcmFudGFibGUpOiBpYW0uR3JhbnQ7XG4gIC8qKlxuICAgKiBHcmFudHMgY29ubmVjdGlvbiBhdXRob3JpemF0aW9uIGZvciB0aGUgYWRtaW4gcm9sZSB0byB0aGUgSUFNIFByaW5jaXBhbFxuICAgKi9cbiAgZ3JhbnRDb25uZWN0QWRtaW4oZ3JhbnRlZTogaWFtLklHcmFudGFibGUpOiBpYW0uR3JhbnQ7XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgQUJTVFJBQ1QgQkFTRSBDTEFTU1xuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBhIEF1cm9yYSBEU1FMIGNsdXN0ZXIuXG4gKiBDb250YWlucyBtZXRob2RzIGFuZCBhdHRyaWJ1dGVzIHZhbGlkIGZvciBBdXJvcmEgRFNRTCBjbHVzdGVycyBlaXRoZXIgY3JlYXRlZCB3aXRoIENESyBvciBpbXBvcnRlZC5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIENsdXN0ZXJCYXNlIGV4dGVuZHMgUmVzb3VyY2UgaW1wbGVtZW50cyBJQ2x1c3RlciB7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBjbHVzdGVyXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgY2x1c3RlckFybjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHRpbWVzdGFtcCB3aGVuIHRoZSBjbHVzdGVyIHdhcyBjcmVhdGVkLCBpbiBJU08gODYwMSBmb3JtYXQuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgY3JlYXRpb25UaW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGlkIG9mIHRoZSBjbHVzdGVyLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGNsdXN0ZXJJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHN0YXR1cyBvZiB0aGUgY2x1c3Rlci5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBzdGF0dXM/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgVnBjRW5kcG9pbnRTZXJ2aWNlTmFtZSBvZiB0aGUgY2x1c3Rlci5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSB2cGNFbmRwb2ludFNlcnZpY2VOYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPcHRpb25hbCBLTVMgZW5jcnlwdGlvbiBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoaXMgY2x1c3Rlci5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBlbmNyeXB0aW9uS2V5Pzoga21zLklLZXk7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG4gIH1cblxuICAvKipcbiAgICogR3JhbnRzIElBTSBhY3Rpb25zIHRvIHRoZSBJQU0gUHJpbmNpcGFsXG4gICAqIEBwYXJhbSBncmFudGVlIC0gVGhlIElBTSBwcmluY2lwYWwgdG8gZ3JhbnQgcGVybWlzc2lvbnMgdG9cbiAgICogQHBhcmFtIGFjdGlvbnMgLSBUaGUgYWN0aW9ucyB0byBncmFudFxuICAgKiBAcmV0dXJucyBBbiBJQU0gR3JhbnQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZ3JhbnRlZCBwZXJtaXNzaW9uc1xuICAgKi9cbiAgcHVibGljIGdyYW50KGdyYW50ZWU6IGlhbS5JR3JhbnRhYmxlLCAuLi5hY3Rpb25zOiBzdHJpbmdbXSk6IGlhbS5HcmFudCB7XG4gICAgcmV0dXJuIGlhbS5HcmFudC5hZGRUb1ByaW5jaXBhbCh7XG4gICAgICBncmFudGVlOiBncmFudGVlLFxuICAgICAgcmVzb3VyY2VBcm5zOiBbdGhpcy5jbHVzdGVyQXJuXSxcbiAgICAgIGFjdGlvbnM6IGFjdGlvbnMsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR3JhbnRzIGNvbm5lY3Rpb24gYXV0aG9yaXphdGlvbiB0byB0aGUgSUFNIFByaW5jaXBhbFxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9hdXJvcmEtZHNxbC9sYXRlc3QvdXNlcmd1aWRlL2F1dGhlbnRpY2F0aW9uLWF1dGhvcml6YXRpb24uaHRtbCNhdXRoZW50aWNhdGlvbi1hdXRob3JpemF0aW9uLWlhbS1wb2xpY3lcbiAgICogQHBhcmFtIGdyYW50ZWUgLSBUaGUgSUFNIHByaW5jaXBhbCB0byBncmFudCBwZXJtaXNzaW9ucyB0b1xuICAgKiBAZGVmYXVsdCAtIERlZmF1bHQgZ3JhbnQgY29uZmlndXJhdGlvbjpcbiAgICogLSBhY3Rpb25zOiBbJ2RzcWw6RGJDb25uZWN0J10gb24gdGhpcy5jbHVzdGVyQXJuXG4gICAqIEByZXR1cm5zIEFuIElBTSBHcmFudCBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBncmFudGVkIHBlcm1pc3Npb25zXG4gICAqL1xuICBwdWJsaWMgZ3JhbnRDb25uZWN0KGdyYW50ZWU6IGlhbS5JR3JhbnRhYmxlKTogaWFtLkdyYW50IHtcbiAgICByZXR1cm4gdGhpcy5ncmFudChncmFudGVlLCAuLi5wZXJtcy5BVVJPUkFfRFNRTF9DT05ORUNUX1BFUk1TKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHcmFudHMgY29ubmVjdGlvbiBhdXRob3JpemF0aW9uIHRvIHRoZSBJQU0gUHJpbmNpcGFsXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2F1cm9yYS1kc3FsL2xhdGVzdC91c2VyZ3VpZGUvYXV0aGVudGljYXRpb24tYXV0aG9yaXphdGlvbi5odG1sI2F1dGhlbnRpY2F0aW9uLWF1dGhvcml6YXRpb24taWFtLXBvbGljeVxuICAgKiBAcGFyYW0gZ3JhbnRlZSAtIFRoZSBJQU0gcHJpbmNpcGFsIHRvIGdyYW50IHBlcm1pc3Npb25zIHRvXG4gICAqIEBkZWZhdWx0IC0gRGVmYXVsdCBncmFudCBjb25maWd1cmF0aW9uOlxuICAgKiAtIGFjdGlvbnM6IFsnZHNxbDpEYkNvbm5lY3RBZG1pbiddIG9uIHRoaXMuY2x1c3RlckFyblxuICAgKiBAcmV0dXJucyBBbiBJQU0gR3JhbnQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZ3JhbnRlZCBwZXJtaXNzaW9uc1xuICAgKi9cbiAgcHVibGljIGdyYW50Q29ubmVjdEFkbWluKGdyYW50ZWU6IGlhbS5JR3JhbnRhYmxlKTogaWFtLkdyYW50IHtcbiAgICByZXR1cm4gdGhpcy5ncmFudChncmFudGVlLCAuLi5wZXJtcy5BVVJPUkFfRFNRTF9DT05ORUNUX0FETUlOX1BFUk1TKTtcbiAgfVxufVxuXG4vKipcbiAqIEludGVyZmFjZSBmb3IgbXVsdGktcmVnaW9uIGNsdXN0ZXIgcHJvcGVydGllc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIE11bHRpUmVnaW9uUHJvcGVydGllcyB7XG4gIC8qKlxuICAgKiBUaGUgc2V0IG9mIHBlZXJlZCBjbHVzdGVycyB0aGF0IGZvcm0gdGhlIG11bHRpLVJlZ2lvbiBjbHVzdGVyIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIEVhY2ggcGVlcmVkIGNsdXN0ZXIgcmVwcmVzZW50cyBhIGRhdGFiYXNlIGluc3RhbmNlIGluIGEgZGlmZmVyZW50IFJlZ2lvbi5cbiAgICogQGRlZmF1bHQgLSBObyBwZWVyZWQgY2x1c3RlcnMgKHNpbmdsZSByZWdpb24gY2x1c3RlcilcbiAgICogQHJlcXVpcmVkIC0gTm9cbiAgICovXG4gIHJlYWRvbmx5IGNsdXN0ZXJzPzogSUNsdXN0ZXJbXTtcbiAgLyoqXG4gICAqIFRoZSBSZWdpb24gdGhhdCBzZXJ2ZXMgYXMgdGhlIHdpdG5lc3MgUmVnaW9uIGZvciBhIG11bHRpLVJlZ2lvbiBjbHVzdGVyLlxuICAgKlxuICAgKiBUaGUgd2l0bmVzcyBSZWdpb24gaGVscHMgbWFpbnRhaW4gY2x1c3RlciBjb25zaXN0ZW5jeSBhbmQgcXVvcnVtLlxuICAgKiBUaGUgd2l0bmVzcyBSZWdpb24gcmVjZWl2ZXMgZGF0YSB3cml0dGVuIHRvIGFueSBSZWFkLVdyaXRlIFJlZ2lvblxuICAgKiBidXQgZG9lcyBub3QgaGF2ZSBhbiBlbmRwb2ludC5cbiAgICpcbiAgICogQHJlcXVpcmVkIC0gWWVzXG4gICAqL1xuICByZWFkb25seSB3aXRuZXNzUmVnaW9uOiBzdHJpbmc7XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgUFJPUFMgRk9SIE5FVyBDT05TVFJVQ1RcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogUHJvcGVydGllcyBmb3IgY3JlYXRpbmcgYSBBdXJvcmEgRFNRTCBjbHVzdGVyIHJlc291cmNlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2x1c3RlckN1c3RvbVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSByZW1vdmFsIHBvbGljeSBmb3IgdGhlIGNsdXN0ZXIuXG4gICAqIE9ubHkgUmVtb3ZhbFBvbGljeS5ERVNUUk9ZIGFuZCBSZW1vdmFsUG9saWN5LlJFVEFJTiBhcmUgYWxsb3dlZC5cbiAgICogQGRlZmF1bHQgLSBSZW1vdmFsUG9saWN5LkRFU1RST1lcbiAgICogQHJlcXVpcmVkIC0gTm9cbiAgICovXG4gIHJlYWRvbmx5IHJlbW92YWxQb2xpY3k/OiBSZW1vdmFsUG9saWN5O1xuICAvKipcbiAgICogS01TIGtleSB0byB1c2UgZm9yIHRoZSBjbHVzdGVyLlxuICAgKiBAZGVmYXVsdCAtIEEgbmV3IEtNUyBrZXkgaXMgY3JlYXRlZC5cbiAgICogQHJlcXVpcmVkIC0gTm9cbiAgICovXG4gIHJlYWRvbmx5IGttc0tleT86IElLZXk7XG4gIC8qKlxuICAgKiBEZWZpbmVzIHRoZSBzdHJ1Y3R1cmUgZm9yIG11bHRpLVJlZ2lvbiBjbHVzdGVyIGNvbmZpZ3VyYXRpb25zLCBjb250YWluaW5nIHRoZSB3aXRuZXNzIFJlZ2lvbiBhbmQgcGVlcmVkIGNsdXN0ZXIgc2V0dGluZ3MuXG4gICAqIElmIG5vdCBwcm92aWRlZCwgdGhlIGNsdXN0ZXIgd2lsbCBiZSBjcmVhdGVkIGluIHRoZSBzYW1lIHJlZ2lvbiBhcyB0aGUgc3RhY2sgKHNpbmdsZSByZWdpb24gY2x1c3RlcikuXG4gICAqIEBkZWZhdWx0IC0gTm8gbXVsdGktUmVnaW9uIGNsdXN0ZXIgY29uZmlndXJhdGlvbnMuXG4gICAqIEByZXF1aXJlZCAtIE5vXG4gICAqL1xuICByZWFkb25seSBtdWx0aVJlZ2lvblByb3BlcnRpZXM/OiBNdWx0aVJlZ2lvblByb3BlcnRpZXM7XG4gIC8qKlxuICAgKiBUYWdzIHRvIGFwcGx5IHRvIHRoZSBjbHVzdGVyLlxuICAgKiBAZGVmYXVsdCAtIE5vIHRhZ3MuXG4gICAqIEByZXF1aXJlZCAtIE5vXG4gICAqL1xuICByZWFkb25seSB0YWdzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgQVRUUlMgRk9SIElNUE9SVEVEIENPTlNUUlVDVFxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBBdHRyaWJ1dGVzIGZvciBzcGVjaWZ5aW5nIGFuIGltcG9ydGVkIEF1cm9yYSBEU1FMIGNsdXN0ZXIuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2x1c3RlckF0dHJpYnV0ZXMge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgY2x1c3RlclxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSBjbHVzdGVyQXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdGltZXN0YW1wIHdoZW4gdGhlIGNsdXN0ZXIgd2FzIGNyZWF0ZWQsIGluIElTTyA4NjAxIGZvcm1hdC5cbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkIC0gTm8gY3JlYXRpb24gdGltZSBpcyBwcm92aWRlZFxuICAgKi9cbiAgcmVhZG9ubHkgY3JlYXRpb25UaW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHN0YXR1cyBvZiB0aGUgY2x1c3Rlci5cbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkIC0gTm8gc3RhdHVzIGlzIHByb3ZpZGVkXG4gICAqL1xuICByZWFkb25seSBzdGF0dXM/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBWcGNFbmRwb2ludFNlcnZpY2VOYW1lIG9mIHRoZSBjbHVzdGVyLlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSB2cGNFbmRwb2ludFNlcnZpY2VOYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBLTVMgZW5jcnlwdGlvbiBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoaXMgY2x1c3Rlci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBlbmNyeXB0aW9uIGtleVxuICAgKi9cbiAgcmVhZG9ubHkgZW5jcnlwdGlvbktleT86IGttcy5JS2V5O1xufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3NcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQXVyb3JhIERTUUwgY2x1c3RlciByZXNvdXJjZSBmb3IgQVdTIEF1cm9yYSBEU1FMLlxuICogWW91IGNhbiB1c2UgdGhpcyByZXNvdXJjZSB0byBjcmVhdGUsIG1vZGlmeSwgYW5kIG1hbmFnZSBjbHVzdGVycy5cbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2F1cm9yYS1kc3FsL2xhdGVzdC91c2VyZ3VpZGUvd2hhdC1pcy1hdXJvcmEtZHNxbC5odG1sXG4gKiBAcmVzb3VyY2UgQVdTOjpEU1FMOjpDbHVzdGVyXG4gKi9cbmV4cG9ydCBjbGFzcyBDbHVzdGVyIGV4dGVuZHMgQ2x1c3RlckJhc2Uge1xuICAvKipcbiAgICogU3RhdGljIE1ldGhvZCBmb3IgaW1wb3J0aW5nIGFuIGV4aXN0aW5nIEF1cm9yYSBEU1FMIGNsdXN0ZXIuXG4gICAqL1xuICAvKipcbiAgICogQ3JlYXRlcyBhbiBBdXJvcmEgRFNRTCBjbHVzdGVyIHJlZmVyZW5jZSBmcm9tIGFuIGV4aXN0aW5nIGNsdXN0ZXIncyBhdHRyaWJ1dGVzLlxuICAgKlxuICAgKiBAcGFyYW0gc2NvcGUgLSBUaGUgY29uc3RydWN0IHNjb3BlXG4gICAqIEBwYXJhbSBpZCAtIElkZW50aWZpZXIgb2YgdGhlIGNvbnN0cnVjdFxuICAgKiBAcGFyYW0gYXR0cnMgLSBBdHRyaWJ1dGVzIG9mIHRoZSBleGlzdGluZyBjbHVzdGVyXG4gICAqIEByZXR1cm5zIEFuIElDbHVzdGVyIHJlZmVyZW5jZSB0byB0aGUgZXhpc3RpbmcgY2x1c3RlclxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBmcm9tQ2x1c3RlckF0dHJpYnV0ZXMoc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgYXR0cnM6IENsdXN0ZXJBdHRyaWJ1dGVzKTogSUNsdXN0ZXIge1xuICAgIGNsYXNzIEltcG9ydCBleHRlbmRzIENsdXN0ZXJCYXNlIHtcbiAgICAgIHB1YmxpYyByZWFkb25seSBjbHVzdGVyQXJuID0gYXR0cnMuY2x1c3RlckFybjtcbiAgICAgIHB1YmxpYyByZWFkb25seSBjbHVzdGVySWQgPSBBcm4uc3BsaXQoYXR0cnMuY2x1c3RlckFybiwgQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUpLnJlc291cmNlTmFtZSE7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgY3JlYXRpb25UaW1lID0gYXR0cnMuY3JlYXRpb25UaW1lO1xuICAgICAgcHVibGljIHJlYWRvbmx5IHN0YXR1cyA9IGF0dHJzLnN0YXR1cztcbiAgICAgIHB1YmxpYyByZWFkb25seSB2cGNFbmRwb2ludFNlcnZpY2VOYW1lID0gYXR0cnMudnBjRW5kcG9pbnRTZXJ2aWNlTmFtZTtcbiAgICAgIHB1YmxpYyByZWFkb25seSBlbmNyeXB0aW9uS2V5ID0gYXR0cnMuZW5jcnlwdGlvbktleTtcblxuICAgICAgY29uc3RydWN0b3IoczogQ29uc3RydWN0LCBpOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIocywgaSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIG5ldyBDbHVzdGVyXG4gICAgcmV0dXJuIG5ldyBJbXBvcnQoc2NvcGUsIGlkKTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBBdHRyaWJ1dGVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgY2x1c3RlclxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY2x1c3RlckFybjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHRpbWVzdGFtcCB3aGVuIHRoZSBjbHVzdGVyIHdhcyBjcmVhdGVkLCBpbiBJU08gODYwMSBmb3JtYXQuXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjcmVhdGlvblRpbWU/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgaWQgb2YgdGhlIGNsdXN0ZXIuXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjbHVzdGVySWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBzdGF0dXMgb2YgdGhlIGNsdXN0ZXIuXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBzdGF0dXM/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBWcGNFbmRwb2ludFNlcnZpY2VOYW1lIG9mIHRoZSBjbHVzdGVyLlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdnBjRW5kcG9pbnRTZXJ2aWNlTmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogS01TIGVuY3J5cHRpb24ga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGNsdXN0ZXIuXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBlbmNyeXB0aW9uS2V5Pzoga21zLklLZXk7XG4gIC8qXG4gICogTXVsdGktUmVnaW9uIGNsdXN0ZXIgcHJvcGVydGllcy5cbiAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG11bHRpUmVnaW9uUHJvcGVydGllcz86IE11bHRpUmVnaW9uUHJvcGVydGllcztcbiAgLyoqXG4gICAqIFRhZ3MgYXBwbGllZCB0byB0aGlzIGNsdXN0ZXIgcmVzb3VyY2VcbiAgICogQSBtYXAgb2Yga2V5LXZhbHVlIHBhaXJzIGZvciByZXNvdXJjZSB0YWdnaW5nXG4gICAqIEBkZWZhdWx0IC0gTm8gdGFncyBhcHBsaWVkXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdGFncz86IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH07XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBJbnRlcm5hbCBPbmx5XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBwcml2YXRlIHJlYWRvbmx5IF9fcmVzb3VyY2U6IGRzcWwuQ2ZuQ2x1c3RlcjtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ09OU1RSVUNUT1JcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBDbHVzdGVyQ3VzdG9tUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gU2V0IHByb3BlcnRpZXMgYW5kIGRlZmF1bHRzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy50YWdzID0gcHJvcHMudGFncztcbiAgICB0aGlzLm11bHRpUmVnaW9uUHJvcGVydGllcyA9IHByb3BzLm11bHRpUmVnaW9uUHJvcGVydGllcztcbiAgICB0aGlzLmVuY3J5cHRpb25LZXkgPSBwcm9wcy5rbXNLZXk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBWYWxpZGF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fdmFsaWRhdGVNdWx0aVJlZ2lvblByb3BlcnRpZXModGhpcy5tdWx0aVJlZ2lvblByb3BlcnRpZXMpO1xuICAgIHRocm93SWZJbnZhbGlkKHRoaXMuX3ZhbGlkYXRlQ2x1c3RlclRhZ3MsIHRoaXMudGFncyk7XG4gICAgdGhpcy5fdmFsaWRhdGVSZW1vdmFsUG9saWN5KHByb3BzLnJlbW92YWxQb2xpY3kpO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQ0ZOIFByb3BzIC0gV2l0aCBMYXp5IHN1cHBvcnRcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb25zdCBjZm5Qcm9wczogZHNxbC5DZm5DbHVzdGVyUHJvcHMgPSB7XG4gICAgICBkZWxldGlvblByb3RlY3Rpb25FbmFibGVkOiBwcm9wcy5yZW1vdmFsUG9saWN5ID8gcHJvcHMucmVtb3ZhbFBvbGljeSA9PT0gUmVtb3ZhbFBvbGljeS5SRVRBSU4gOiBmYWxzZSxcbiAgICAgIGttc0VuY3J5cHRpb25LZXk6IHRoaXMuZW5jcnlwdGlvbktleT8ua2V5QXJuLFxuICAgICAgbXVsdGlSZWdpb25Qcm9wZXJ0aWVzOiB0aGlzLl9yZW5kZXJNdWx0aVJlZ2lvblByb3BlcnRpZXMoKSxcbiAgICAgIHRhZ3M6IHRoaXMudGFncyA/IE9iamVjdC5lbnRyaWVzKHRoaXMudGFncykubWFwKChba2V5LCB2YWx1ZV0pID0+ICh7IGtleSwgdmFsdWUgfSkpIDogdW5kZWZpbmVkLFxuICAgIH07XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBDcmVhdGUgdGhlIHJlc291cmNlXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fX3Jlc291cmNlID0gbmV3IGRzcWwuQ2ZuQ2x1c3Rlcih0aGlzLCAnUmVzb3VyY2UnLCBjZm5Qcm9wcyk7XG5cbiAgICAvLyBHZXQgYXR0cmlidXRlcyBkaXJlY3RseSBmcm9tIHRoZSBDbG91ZEZvcm1hdGlvbiByZXNvdXJjZVxuICAgIHRoaXMuY2x1c3RlckFybiA9IHRoaXMuX19yZXNvdXJjZS5hdHRyUmVzb3VyY2VBcm47XG4gICAgdGhpcy5jcmVhdGlvblRpbWUgPSB0aGlzLl9fcmVzb3VyY2UuYXR0ckNyZWF0aW9uVGltZTtcbiAgICB0aGlzLmNsdXN0ZXJJZCA9IHRoaXMuX19yZXNvdXJjZS5hdHRySWRlbnRpZmllcjtcbiAgICB0aGlzLnN0YXR1cyA9IHRoaXMuX19yZXNvdXJjZS5hdHRyU3RhdHVzO1xuICAgIHRoaXMudnBjRW5kcG9pbnRTZXJ2aWNlTmFtZSA9IHRoaXMuX19yZXNvdXJjZS5hdHRyVnBjRW5kcG9pbnRTZXJ2aWNlTmFtZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgdGhlIG11bHRpLXJlZ2lvbiBwcm9wZXJ0aWVzLlxuICAgKlxuICAgKiBAcmV0dXJucyBNdWx0aVJlZ2lvblByb3BlcnRpZXNQcm9wZXJ0eSBvYmplY3QgaW4gQ2xvdWRGb3JtYXRpb24gZm9ybWF0LCBvciB1bmRlZmluZWQgaWYgbm8gbXVsdGktcmVnaW9uIHByb3BlcnRpZXMgYXJlIGRlZmluZWRcbiAgICogQGRlZmF1bHQgLSB1bmRlZmluZWQgaWYgbm8gbXVsdGktcmVnaW9uIHByb3BlcnRpZXMgYXJlIHByb3ZpZGVkXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBfcmVuZGVyTXVsdGlSZWdpb25Qcm9wZXJ0aWVzKCk6IGRzcWwuQ2ZuQ2x1c3Rlci5NdWx0aVJlZ2lvblByb3BlcnRpZXNQcm9wZXJ0eSB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMubXVsdGlSZWdpb25Qcm9wZXJ0aWVzID8ge1xuICAgICAgY2x1c3RlcnM6IHRoaXMubXVsdGlSZWdpb25Qcm9wZXJ0aWVzLmNsdXN0ZXJzPy5tYXAoY2x1c3RlciA9PiBjbHVzdGVyLmNsdXN0ZXJBcm4pLFxuICAgICAgd2l0bmVzc1JlZ2lvbjogdGhpcy5tdWx0aVJlZ2lvblByb3BlcnRpZXMud2l0bmVzc1JlZ2lvbixcbiAgICB9IDogdW5kZWZpbmVkO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFZhbGlkYXRvcnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBWYWxpZGF0ZXMgdGhlIG11bHRpLXJlZ2lvbiBwcm9wZXJ0aWVzXG4gICAqIEBwYXJhbSBwcm9wcyBUaGUgbXVsdGktcmVnaW9uIHByb3BlcnRpZXMgdG8gdmFsaWRhdGVcbiAgICogQHRocm93cyBFcnJvciBpZiB0aGUgbXVsdGktcmVnaW9uIHByb3BlcnRpZXMgYXJlIGludmFsaWRcbiAgICovXG4gIHByaXZhdGUgX3ZhbGlkYXRlTXVsdGlSZWdpb25Qcm9wZXJ0aWVzID0gKHByb3BzOiBNdWx0aVJlZ2lvblByb3BlcnRpZXMgfCB1bmRlZmluZWQpOiB2b2lkID0+IHtcbiAgICBpZiAoIXByb3BzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVGhlIHdpdG5lc3MgUmVnaW9uIHNwZWNpZmllZCBpbiBtdWx0aVJlZ2lvblByb3BlcnRpZXMud2l0bmVzc1JlZ2lvbiBjYW5ub3QgYmUgdGhlIHNhbWUgYXMgdGhlIGNsdXN0ZXIncyBSZWdpb24uXG4gICAgaWYgKHByb3BzLndpdG5lc3NSZWdpb24gJiYgIVRva2VuLmlzVW5yZXNvbHZlZCh0aGlzLnN0YWNrLnJlZ2lvbikpIHtcbiAgICAgIGlmIChwcm9wcy53aXRuZXNzUmVnaW9uID09PSB0aGlzLnN0YWNrLnJlZ2lvbikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1dpdG5lc3MgcmVnaW9uIGNhbm5vdCBiZSB0aGUgc2FtZSBhcyB0aGUgY2x1c3RlclxcJ3MgUmVnaW9uJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRm9yIHRoZSBwcm92aWRlZCBwZWVyZWQgY2x1c3RlcnMsIHRoZXkgbXVzdCBiZSBpbiBkaWZmZXJlbnQgUmVnaW9ucy5cbiAgICBpZiAocHJvcHMuY2x1c3RlcnMgJiYgIVRva2VuLmlzVW5yZXNvbHZlZCh0aGlzLnN0YWNrLnJlZ2lvbikpIHtcbiAgICAgIGZvciAoY29uc3QgY2x1c3RlciBvZiBwcm9wcy5jbHVzdGVycykge1xuICAgICAgICBjb25zdCByZWdpb24gPSBBcm4uc3BsaXQoY2x1c3Rlci5jbHVzdGVyQXJuLCBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSkucmVnaW9uO1xuICAgICAgICBpZiAocmVnaW9uID09PSB0aGlzLnN0YWNrLnJlZ2lvbikge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUGVlcmVkIGNsdXN0ZXIgJHtjbHVzdGVyLmNsdXN0ZXJBcm59IGNhbm5vdCBiZSBpbiB0aGUgc2FtZSBSZWdpb24gJHt0aGlzLnN0YWNrLnJlZ2lvbn0gYXMgdGhlIGNsdXN0ZXIncyBSZWdpb25gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogVmFsaWRhdGVzIHRoZSByZW1vdmFsIHBvbGljeVxuICAgKiBAcGFyYW0gcmVtb3ZhbFBvbGljeSBUaGUgcmVtb3ZhbCBwb2xpY3kgdG8gdmFsaWRhdGVcbiAgICogQHRocm93cyBFcnJvciBpZiB0aGUgcmVtb3ZhbCBwb2xpY3kgaXMgaW52YWxpZFxuICAgKi9cbiAgcHJpdmF0ZSBfdmFsaWRhdGVSZW1vdmFsUG9saWN5ID0gKHJlbW92YWxQb2xpY3k/OiBSZW1vdmFsUG9saWN5KTogdm9pZCA9PiB7XG4gICAgaWYgKHJlbW92YWxQb2xpY3kgJiYgcmVtb3ZhbFBvbGljeSAhPT0gUmVtb3ZhbFBvbGljeS5ERVNUUk9ZICYmIHJlbW92YWxQb2xpY3kgIT09IFJlbW92YWxQb2xpY3kuUkVUQUlOKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcmVtb3ZhbCBwb2xpY3kuIE9ubHkgUmVtb3ZhbFBvbGljeS5ERVNUUk9ZIGFuZCBSZW1vdmFsUG9saWN5LlJFVEFJTiBhcmUgYWxsb3dlZC4nKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlcyB0aGUgY2x1c3RlciB0YWdzIGZvcm1hdFxuICAgKiBAcGFyYW0gdGFncyBUaGUgdGFncyBvYmplY3QgdG8gdmFsaWRhdGVcbiAgICogQHJldHVybnMgQXJyYXkgb2YgdmFsaWRhdGlvbiBlcnJvciBtZXNzYWdlcywgZW1wdHkgaWYgdmFsaWRcbiAgICovXG4gIHByaXZhdGUgX3ZhbGlkYXRlQ2x1c3RlclRhZ3MgPSAodGFncz86IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pOiBzdHJpbmdbXSA9PiB7XG4gICAgbGV0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBpZiAoIXRhZ3MpIHtcbiAgICAgIHJldHVybiBlcnJvcnM7IC8vIFRhZ3MgYXJlIG9wdGlvbmFsXG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgZWFjaCB0YWcga2V5IGFuZCB2YWx1ZVxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHRhZ3MpKSB7XG4gICAgICBlcnJvcnMucHVzaCguLi52YWxpZGF0ZVN0cmluZ0ZpZWxkTGVuZ3RoKHtcbiAgICAgICAgdmFsdWU6IGtleSxcbiAgICAgICAgZmllbGROYW1lOiAnVGFnIGtleScsXG4gICAgICAgIG1pbkxlbmd0aDogQ0xVU1RFUl9UQUdfTUlOX0xFTkdUSCxcbiAgICAgICAgbWF4TGVuZ3RoOiBDTFVTVEVSX1RBR19NQVhfTEVOR1RILFxuICAgICAgfSkpO1xuXG4gICAgICAvLyBWYWxpZGF0ZSB0YWcga2V5IHBhdHRlcm46IF5bYS16QS1aMC05XFxzLl86Lz0rQC1dKiRcbiAgICAgIGNvbnN0IHZhbGlkS2V5UGF0dGVybiA9IC9eW2EtekEtWjAtOVxccy5fOi89K0AtXSokLztcbiAgICAgIGVycm9ycy5wdXNoKC4uLnZhbGlkYXRlRmllbGRQYXR0ZXJuKGtleSwgJ1RhZyBrZXknLCB2YWxpZEtleVBhdHRlcm4pKTtcblxuICAgICAgLy8gVmFsaWRhdGUgdGFnIHZhbHVlXG4gICAgICBlcnJvcnMucHVzaCguLi52YWxpZGF0ZVN0cmluZ0ZpZWxkTGVuZ3RoKHtcbiAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICBmaWVsZE5hbWU6ICdUYWcgdmFsdWUnLFxuICAgICAgICBtaW5MZW5ndGg6IENMVVNURVJfVEFHX01JTl9MRU5HVEgsXG4gICAgICAgIG1heExlbmd0aDogQ0xVU1RFUl9UQUdfTUFYX0xFTkdUSCxcbiAgICAgIH0pKTtcblxuICAgICAgLy8gVmFsaWRhdGUgdGFnIHZhbHVlIHBhdHRlcm46IF5bYS16QS1aMC05XFxzLl86Lz0rQC1dKiRcbiAgICAgIGNvbnN0IHZhbGlkVmFsdWVQYXR0ZXJuID0gL15bYS16QS1aMC05XFxzLl86Lz0rQC1dKiQvO1xuICAgICAgZXJyb3JzLnB1c2goLi4udmFsaWRhdGVGaWVsZFBhdHRlcm4odmFsdWUsICdUYWcgdmFsdWUnLCB2YWxpZFZhbHVlUGF0dGVybikpO1xuICAgIH1cblxuICAgIHJldHVybiBlcnJvcnM7XG4gIH07XG59XG4iXX0=