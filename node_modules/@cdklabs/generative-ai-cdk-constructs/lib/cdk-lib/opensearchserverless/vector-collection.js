"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.VectorCollection = exports.VectorCollectionType = exports.VectorCollectionStandbyReplicas = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const cdk = require("aws-cdk-lib");
const cloudwatch = require("aws-cdk-lib/aws-cloudwatch");
const iam = require("aws-cdk-lib/aws-iam");
const oss = require("aws-cdk-lib/aws-opensearchserverless");
const utils_1 = require("../../common/helpers/utils");
/**
 * Configuration for standby replicas in a vector collection.
 */
var VectorCollectionStandbyReplicas;
(function (VectorCollectionStandbyReplicas) {
    /**
     * Enable standby replicas for high availability
     */
    VectorCollectionStandbyReplicas["ENABLED"] = "ENABLED";
    /**
     * Disable standby replicas to reduce costs
     */
    VectorCollectionStandbyReplicas["DISABLED"] = "DISABLED";
})(VectorCollectionStandbyReplicas || (exports.VectorCollectionStandbyReplicas = VectorCollectionStandbyReplicas = {}));
/**
 * The type of collection.
 */
var VectorCollectionType;
(function (VectorCollectionType) {
    /**
     * Search – Full-text search that powers applications in your internal networks (content management systems, legal documents) and internet-facing applications,
     * such as ecommerce website search and content search.
     */
    VectorCollectionType["SEARCH"] = "SEARCH";
    /**
     * Time series – The log analytics segment that focuses on analyzing large volumes of semi-structured,
     * machine-generated data in real-time for operational, security, user behavior, and business insights.
     */
    VectorCollectionType["TIMESERIES"] = "TIMESERIES";
    /**
     * Vector search – Semantic search on vector embeddings that simplifies vector data management and powers machine learning (ML) augmented search experiences and generative AI applications,
     * such as chatbots, personal assistants, and fraud detection.
     */
    VectorCollectionType["VECTORSEARCH"] = "VECTORSEARCH";
})(VectorCollectionType || (exports.VectorCollectionType = VectorCollectionType = {}));
/**
 * A new or imported vector collection.
 */
class VectorCollectionBase extends cdk.Resource {
    metric(metricName, props) {
        return new cloudwatch.Metric({
            namespace: 'AWS/AOSS',
            metricName,
            dimensionsMap: {
                CollectionId: this.collectionId,
            },
            ...props,
        });
    }
    metricSearchRequestCount(props) {
        return this.metric('SearchRequestCount', props);
    }
    metricIndexRequestCount(props) {
        return this.metric('IndexRequestCount', props);
    }
    metricSearchLatency(props) {
        return this.metric('SearchLatency', { statistic: 'Average', ...props });
    }
    metricSearchLatencyP90(props) {
        return this.metric('SearchLatency', { statistic: 'p90', ...props });
    }
}
/**
 * Provides a vector search collection in Amazon OpenSearch Serverless.
 */
class VectorCollection extends VectorCollectionBase {
    /**
     * Return metrics for all vector collections.
     */
    static metricAll(metricName, props) {
        return new cloudwatch.Metric({
            namespace: 'AWS/AOSS',
            metricName,
            statistic: 'Sum',
            ...props,
        });
    }
    /**
     * Metric for the total number of search requests across all collections.
     */
    static metricAllSearchRequestCount(props) {
        return this.metricAll('SearchRequestCount', props);
    }
    /**
     * Metric for the total number of index requests across all collections.
     */
    static metricAllIndexRequestCount(props) {
        return this.metricAll('IndexRequestCount', props);
    }
    /**
     * Metric for average search latency across all collections.
     */
    static metricAllSearchLatency(props) {
        return this.metricAll('SearchLatency', {
            statistic: 'Average',
            ...props,
        });
    }
    /**
     * Import an existing collection using its attributes.
     * @param constructScope The parent creating construct.
     * @param constructId The construct's name.
     * @param attrs The collection attributes to use.
     */
    static fromCollectionAttributes(constructScope, constructId, attrs) {
        class Import extends VectorCollectionBase {
            constructor(scope, id) {
                super(scope, id);
                this.collectionArn = attrs.collectionArn;
                this.collectionId = attrs.collectionId;
                this.collectionName = attrs.collectionName;
                this.standbyReplicas = attrs.standbyReplicas;
                this.collectionType = attrs.collectionType;
                this.aossPolicy = new iam.ManagedPolicy(this, 'ImportedAOSSPolicy', {
                    statements: [
                        new iam.PolicyStatement({
                            effect: iam.Effect.ALLOW,
                            actions: ['aoss:APIAccessAll'],
                            resources: [this.collectionArn],
                        }),
                    ],
                });
                this.dataAccessPolicy = new oss.CfnAccessPolicy(this, 'ImportedDataAccessPolicy', {
                    name: (0, utils_1.generatePhysicalNameV2)(this, 'DataAccessPolicy', { maxLength: 32, lower: true }),
                    type: 'data',
                    policy: '[]',
                });
            }
        }
        return new Import(constructScope, constructId);
    }
    constructor(scope, id, props) {
        super(scope, id);
        /**
         * An OpenSearch Access Policy document that will become `dataAccessPolicy`.
         * @private
         */
        this.dataAccessPolicyDocument = [];
        this.collectionName = props?.collectionName ?? (0, utils_1.generatePhysicalNameV2)(this, 'VectorStore', { maxLength: 32, lower: true });
        this.standbyReplicas = props?.standbyReplicas ?? VectorCollectionStandbyReplicas.ENABLED;
        this.collectionType = props?.collectionType ?? VectorCollectionType.VECTORSEARCH;
        const encryptionPolicyName = (0, utils_1.generatePhysicalNameV2)(this, 'EncryptionPolicy', { maxLength: 32, lower: true });
        const encryptionPolicy = new oss.CfnSecurityPolicy(this, 'EncryptionPolicy', {
            name: encryptionPolicyName,
            type: 'encryption',
            policy: JSON.stringify({
                Rules: [
                    {
                        ResourceType: 'collection',
                        Resource: [`collection/${this.collectionName}`],
                    },
                ],
                AWSOwnedKey: true,
            }),
        });
        const networkPolicyName = (0, utils_1.generatePhysicalNameV2)(this, 'NetworkPolicy', { maxLength: 32, lower: true });
        const networkPolicy = new oss.CfnSecurityPolicy(this, 'NetworkPolicy', {
            name: networkPolicyName,
            type: 'network',
            policy: JSON.stringify([
                {
                    Rules: [
                        {
                            ResourceType: 'collection',
                            Resource: [`collection/${this.collectionName}`],
                        },
                        {
                            ResourceType: 'dashboard',
                            Resource: [`collection/${this.collectionName}`],
                        },
                    ],
                    AllowFromPublic: true,
                },
            ]),
        });
        this._resource = new oss.CfnCollection(this, 'VectorCollection', {
            name: this.collectionName,
            type: this.collectionType,
            standbyReplicas: this.standbyReplicas,
            description: props?.description,
            tags: props?.tags,
        });
        this.collectionArn = this._resource.attrArn;
        this.collectionId = this._resource.attrId;
        this.collectionEndpoint = this._resource.attrCollectionEndpoint;
        this.dashboardEndpoint = this._resource.attrDashboardEndpoint;
        if (props?.customAossPolicy) {
            this.aossPolicy = props.customAossPolicy;
        }
        else {
            this.aossPolicy = new iam.ManagedPolicy(this, 'AOSSApiAccessAll', {
                statements: [
                    new iam.PolicyStatement({
                        effect: iam.Effect.ALLOW,
                        actions: [
                            'aoss:APIAccessAll',
                        ],
                        resources: [this._resource.attrArn],
                    }),
                ],
            });
        }
        this._resource.node.addDependency(encryptionPolicy);
        this._resource.node.addDependency(networkPolicy);
        const isDataAccessPolicyNotEmpty = new cdk.CfnCondition(this, 'IsDataAccessPolicyNotEmpty', {
            expression: cdk.Fn.conditionNot(cdk.Fn.conditionEquals(0, cdk.Lazy.number({
                produce: () => this.dataAccessPolicyDocument.length,
            }))),
        });
        const dataAccessPolicyName = (0, utils_1.generatePhysicalNameV2)(this, 'DataAccessPolicy', { maxLength: 32, lower: true });
        this.dataAccessPolicy = new oss.CfnAccessPolicy(this, 'DataAccessPolicy', {
            name: dataAccessPolicyName,
            type: 'data',
            policy: cdk.Lazy.string({
                produce: () => JSON.stringify(this.dataAccessPolicyDocument),
            }),
        });
        this.dataAccessPolicy.cfnOptions.condition = isDataAccessPolicyNotEmpty;
        this.node.addValidation({
            validate: () => {
                const errors = [];
                if (this.collectionName) {
                    if (!/^[a-z0-9-]+$/.test(this.collectionName)) {
                        errors.push('Collection name must contain only lowercase letters, numbers, and hyphens');
                    }
                    if (this.collectionName.length < 3 || this.collectionName.length > 32) {
                        errors.push('Collection name must be between 3 and 32 characters');
                    }
                }
                return errors;
            },
        });
        cdk.Tags.of(this).add('Name', this.collectionName);
        cdk.Tags.of(this).add('Type', 'VectorCollection');
    }
    /**
     * Grants the specified role access to data in the collection.
     * @param grantee The role to grant access to.
     */
    grantDataAccess(grantee) {
        this.dataAccessPolicyDocument.push({
            Rules: [
                {
                    Resource: [`collection/${this.collectionName}`],
                    Permission: [
                        'aoss:DescribeCollectionItems',
                        'aoss:CreateCollectionItems',
                        'aoss:UpdateCollectionItems',
                    ],
                    ResourceType: 'collection',
                },
                {
                    Resource: [`index/${this.collectionName}/*`],
                    Permission: [
                        'aoss:UpdateIndex',
                        'aoss:DescribeIndex',
                        'aoss:ReadDocument',
                        'aoss:WriteDocument',
                        'aoss:CreateIndex',
                    ],
                    ResourceType: 'index',
                },
            ],
            Principal: [
                grantee.roleArn,
            ],
            Description: '',
        });
        grantee.addManagedPolicy(this.aossPolicy);
    }
}
exports.VectorCollection = VectorCollection;
_a = JSII_RTTI_SYMBOL_1;
VectorCollection[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.opensearchserverless.VectorCollection", version: "0.1.312" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVjdG9yLWNvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2RrLWxpYi9vcGVuc2VhcmNoc2VydmVybGVzcy92ZWN0b3ItY29sbGVjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBRUgsbUNBQW1DO0FBQ25DLHlEQUF5RDtBQUN6RCwyQ0FBMkM7QUFDM0MsNERBQTREO0FBRTVELHNEQUFvRTtBQUVwRTs7R0FFRztBQUNILElBQVksK0JBVVg7QUFWRCxXQUFZLCtCQUErQjtJQUN6Qzs7T0FFRztJQUNILHNEQUFtQixDQUFBO0lBRW5COztPQUVHO0lBQ0gsd0RBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQVZXLCtCQUErQiwrQ0FBL0IsK0JBQStCLFFBVTFDO0FBRUQ7O0dBRUc7QUFDSCxJQUFZLG9CQWtCWDtBQWxCRCxXQUFZLG9CQUFvQjtJQUM5Qjs7O09BR0c7SUFDSCx5Q0FBaUIsQ0FBQTtJQUVqQjs7O09BR0c7SUFDSCxpREFBeUIsQ0FBQTtJQUV6Qjs7O09BR0c7SUFDSCxxREFBNkIsQ0FBQTtBQUMvQixDQUFDLEVBbEJXLG9CQUFvQixvQ0FBcEIsb0JBQW9CLFFBa0IvQjtBQXNKRDs7R0FFRztBQUNILE1BQWUsb0JBQXFCLFNBQVEsR0FBRyxDQUFDLFFBQVE7SUFTL0MsTUFBTSxDQUFDLFVBQWtCLEVBQUUsS0FBZ0M7UUFDaEUsT0FBTyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDM0IsU0FBUyxFQUFFLFVBQVU7WUFDckIsVUFBVTtZQUNWLGFBQWEsRUFBRTtnQkFDYixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7YUFDaEM7WUFDRCxHQUFHLEtBQUs7U0FDVCxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sd0JBQXdCLENBQUMsS0FBZ0M7UUFDOUQsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFvQixFQUFFLEtBQUssQ0FBQyxDQUFDO0lB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Q0FBQztTQUNGLENBQUMsQ0FBQztRQUVILEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ25ELEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0gsZUFBZSxDQUFDLE9BQWtCO1FBQ2hDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUM7WUFDakMsS0FBSyxFQUFFO2dCQUNMO29CQUNFLFFBQVEsRUFBRSxDQUFDLGNBQWMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO29CQUMvQyxVQUFVLEVBQUU7d0JBQ1YsOEJBQThCO3dCQUM5Qiw0QkFBNEI7d0JBQzVCLDRCQUE0QjtxQkFDN0I7b0JBQ0QsWUFBWSxFQUFFLFlBQVk7aUJBQzNCO2dCQUNEO29CQUNFLFFBQVEsRUFBRSxDQUFDLFNBQVMsSUFBSSxDQUFDLGNBQWMsSUFBSSxDQUFDO29CQUM1QyxVQUFVLEVBQUU7d0JBQ1Ysa0JBQWtCO3dCQUNsQixvQkFBb0I7d0JBQ3BCLG1CQUFtQjt3QkFDbkIsb0JBQW9CO3dCQUNwQixrQkFBa0I7cUJBQ25CO29CQUNELFlBQVksRUFBRSxPQUFPO2lCQUN0QjthQUNGO1lBQ0QsU0FBUyxFQUFFO2dCQUNULE9BQU8sQ0FBQyxPQUFPO2FBQ2hCO1lBQ0QsV0FBVyxFQUFFLEVBQUU7U0FDaEIsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM1QyxDQUFDOztBQXRRSCw0Q0F1UUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgY2xvdWR3YXRjaCBmcm9tICdhd3MtY2RrLWxpYi9hd3MtY2xvdWR3YXRjaCc7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBvc3MgZnJvbSAnYXdzLWNkay1saWIvYXdzLW9wZW5zZWFyY2hzZXJ2ZXJsZXNzJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMiB9IGZyb20gJy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIGZvciBzdGFuZGJ5IHJlcGxpY2FzIGluIGEgdmVjdG9yIGNvbGxlY3Rpb24uXG4gKi9cbmV4cG9ydCBlbnVtIFZlY3RvckNvbGxlY3Rpb25TdGFuZGJ5UmVwbGljYXMge1xuICAvKipcbiAgICogRW5hYmxlIHN0YW5kYnkgcmVwbGljYXMgZm9yIGhpZ2ggYXZhaWxhYmlsaXR5XG4gICAqL1xuICBFTkFCTEVEID0gJ0VOQUJMRUQnLFxuXG4gIC8qKlxuICAgKiBEaXNhYmxlIHN0YW5kYnkgcmVwbGljYXMgdG8gcmVkdWNlIGNvc3RzXG4gICAqL1xuICBESVNBQkxFRCA9ICdESVNBQkxFRCcsXG59XG5cbi8qKlxuICogVGhlIHR5cGUgb2YgY29sbGVjdGlvbi5cbiAqL1xuZXhwb3J0IGVudW0gVmVjdG9yQ29sbGVjdGlvblR5cGUge1xuICAvKipcbiAgICogU2VhcmNoIOKAkyBGdWxsLXRleHQgc2VhcmNoIHRoYXQgcG93ZXJzIGFwcGxpY2F0aW9ucyBpbiB5b3VyIGludGVybmFsIG5ldHdvcmtzIChjb250ZW50IG1hbmFnZW1lbnQgc3lzdGVtcywgbGVnYWwgZG9jdW1lbnRzKSBhbmQgaW50ZXJuZXQtZmFjaW5nIGFwcGxpY2F0aW9ucyxcbiAgICogc3VjaCBhcyBlY29tbWVyY2Ugd2Vic2l0ZSBzZWFyY2ggYW5kIGNvbnRlbnQgc2VhcmNoLlxuICAgKi9cbiAgU0VBUkNIID0gJ1NFQVJDSCcsXG5cbiAgLyoqXG4gICAqIFRpbWUgc2VyaWVzIOKAkyBUaGUgbG9nIGFuYWx5dGljcyBzZWdtZW50IHRoYXQgZm9jdXNlcyBvbiBhbmFseXppbmcgbGFyZ2Ugdm9sdW1lcyBvZiBzZW1pLXN0cnVjdHVyZWQsXG4gICAqIG1hY2hpbmUtZ2VuZXJhdGVkIGRhdGEgaW4gcmVhbC10aW1lIGZvciBvcGVyYXRpb25hbCwgc2VjdXJpdHksIHVzZXIgYmVoYXZpb3IsIGFuZCBidXNpbmVzcyBpbnNpZ2h0cy5cbiAgICovXG4gIFRJTUVTRVJJRVMgPSAnVElNRVNFUklFUycsXG5cbiAgLyoqXG4gICAqIFZlY3RvciBzZWFyY2gg4oCTIFNlbWFudGljIHNlYXJjaCBvbiB2ZWN0b3IgZW1iZWRkaW5ncyB0aGF0IHNpbXBsaWZpZXMgdmVjdG9yIGRhdGEgbWFuYWdlbWVudCBhbmQgcG93ZXJzIG1hY2hpbmUgbGVhcm5pbmcgKE1MKSBhdWdtZW50ZWQgc2VhcmNoIGV4cGVyaWVuY2VzIGFuZCBnZW5lcmF0aXZlIEFJIGFwcGxpY2F0aW9ucyxcbiAgICogc3VjaCBhcyBjaGF0Ym90cywgcGVyc29uYWwgYXNzaXN0YW50cywgYW5kIGZyYXVkIGRldGVjdGlvbi5cbiAgICovXG4gIFZFQ1RPUlNFQVJDSCA9ICdWRUNUT1JTRUFSQ0gnLFxufVxuXG4vKipcbiAqIEF0dHJpYnV0ZXMgZm9yIGltcG9ydGluZyBhbiBleGlzdGluZyB2ZWN0b3IgY29sbGVjdGlvbi5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBWZWN0b3JDb2xsZWN0aW9uQXR0cmlidXRlcyB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgY29sbGVjdGlvblxuICAgKi9cbiAgcmVhZG9ubHkgY29sbGVjdGlvbk5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBjb2xsZWN0aW9uXG4gICAqL1xuICByZWFkb25seSBjb2xsZWN0aW9uSWQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgY29sbGVjdGlvblxuICAgKi9cbiAgcmVhZG9ubHkgY29sbGVjdGlvbkFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgc3RhbmRieSByZXBsaWNhcyBjb25maWd1cmF0aW9uXG4gICAqL1xuICByZWFkb25seSBzdGFuZGJ5UmVwbGljYXM6IFZlY3RvckNvbGxlY3Rpb25TdGFuZGJ5UmVwbGljYXM7XG5cbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIGNvbGxlY3Rpb25cbiAgICovXG4gIHJlYWRvbmx5IGNvbGxlY3Rpb25UeXBlOiBWZWN0b3JDb2xsZWN0aW9uVHlwZTtcbn1cblxuLyoqXG4gKiBQcm9wZXJ0aWVzIGZvciBjb25maWd1cmluZyB0aGUgdmVjdG9yIGNvbGxlY3Rpb24uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmVjdG9yQ29sbGVjdGlvblByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBjb2xsZWN0aW9uLiBNdXN0IGJlIGJldHdlZW4gMy0zMiBjaGFyYWN0ZXJzIGxvbmcgYW5kIGNvbnRhaW4gb25seVxuICAgKiBsb3dlcmNhc2UgbGV0dGVycywgbnVtYmVycywgYW5kIGh5cGhlbnMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBDREsgZ2VuZXJhdGVkIG5hbWUgd2lsbCBiZSB1c2VkXG4gICAqL1xuICByZWFkb25seSBjb2xsZWN0aW9uTmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogRGVzY3JpcHRpb24gZm9yIHRoZSBjb2xsZWN0aW9uXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogSW5kaWNhdGVzIHdoZXRoZXIgdG8gdXNlIHN0YW5kYnkgcmVwbGljYXMgZm9yIHRoZSBjb2xsZWN0aW9uLlxuICAgKlxuICAgKiBAZGVmYXVsdCBWZWN0b3JDb2xsZWN0aW9uU3RhbmRieVJlcGxpY2FzLkVOQUJMRURcbiAgICovXG4gIHJlYWRvbmx5IHN0YW5kYnlSZXBsaWNhcz86IFZlY3RvckNvbGxlY3Rpb25TdGFuZGJ5UmVwbGljYXM7XG5cbiAgLyoqXG4gICAqIEEgdXNlciBkZWZpbmVkIElBTSBwb2xpY3kgdGhhdCBhbGxvd3MgQVBJIGFjY2VzcyB0byB0aGUgY29sbGVjdGlvbi5cbiAgICovXG4gIHJlYWRvbmx5IGN1c3RvbUFvc3NQb2xpY3k/OiBpYW0uTWFuYWdlZFBvbGljeTtcblxuICAvKipcbiAgICogVHlwZSBvZiB2ZWN0b3IgY29sbGVjdGlvblxuICAgKlxuICAgKiBAZGVmYXVsdCAtIFZFQ1RPUlNFQVJDSFxuICAgKi9cbiAgcmVhZG9ubHkgY29sbGVjdGlvblR5cGU/OiBWZWN0b3JDb2xsZWN0aW9uVHlwZTtcblxuICAvKipcbiAgICogQSBsaXN0IG9mIHRhZ3MgYXNzb2NpYXRlZCB3aXRoIHRoZSBpbmZlcmVuY2UgcHJvZmlsZS5cbiAgICogKi9cbiAgcmVhZG9ubHkgdGFncz86IEFycmF5PGNkay5DZm5UYWc+O1xufVxuXG4vKipcbiAqIEludGVyZmFjZSByZXByZXNlbnRpbmcgYSB2ZWN0b3IgY29sbGVjdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIElWZWN0b3JDb2xsZWN0aW9uIGV4dGVuZHMgY2RrLklSZXNvdXJjZSB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgY29sbGVjdGlvbi5cbiAgICovXG4gIHJlYWRvbmx5IGNvbGxlY3Rpb25OYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgY29sbGVjdGlvbi5cbiAgICovXG4gIHJlYWRvbmx5IGNvbGxlY3Rpb25JZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBjb2xsZWN0aW9uLlxuICAgKi9cbiAgcmVhZG9ubHkgY29sbGVjdGlvbkFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgd2hldGhlciBzdGFuZGJ5IHJlcGxpY2FzIGFyZSBlbmFibGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgc3RhbmRieVJlcGxpY2FzOiBWZWN0b3JDb2xsZWN0aW9uU3RhbmRieVJlcGxpY2FzO1xuXG4gIC8qKlxuICAgKiBBbiBJQU0gcG9saWN5IHRoYXQgYWxsb3dzIEFQSSBhY2Nlc3MgdG8gdGhlIGNvbGxlY3Rpb24uXG4gICAqL1xuICByZWFkb25seSBhb3NzUG9saWN5OiBpYW0uTWFuYWdlZFBvbGljeTtcblxuICAvKipcbiAgICogQW4gT3BlblNlYXJjaCBBY2Nlc3MgUG9saWN5IHRoYXQgYWxsb3dzIGFjY2VzcyB0byB0aGUgaW5kZXguXG4gICAqL1xuICByZWFkb25seSBkYXRhQWNjZXNzUG9saWN5OiBvc3MuQ2ZuQWNjZXNzUG9saWN5O1xuXG4gIC8qKlxuICAgKiBUeXBlIG9mIGNvbGxlY3Rpb25cbiAgICovXG4gIHJlYWRvbmx5IGNvbGxlY3Rpb25UeXBlOiBWZWN0b3JDb2xsZWN0aW9uVHlwZTtcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBnaXZlbiBuYW1lZCBtZXRyaWMgZm9yIHRoaXMgVmVjdG9yQ29sbGVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIG1ldHJpY05hbWUgVGhlIG5hbWUgb2YgdGhlIG1ldHJpY1xuICAgKiBAcGFyYW0gcHJvcHMgUHJvcGVydGllcyBmb3IgdGhlIG1ldHJpY1xuICAgKi9cbiAgbWV0cmljKG1ldHJpY05hbWU6IHN0cmluZywgcHJvcHM/OiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMpOiBjbG91ZHdhdGNoLk1ldHJpYztcblxuICAvKipcbiAgICogTWV0cmljIGZvciB0aGUgbnVtYmVyIG9mIHNlYXJjaCByZXF1ZXN0cy5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIFByb3BlcnRpZXMgZm9yIHRoZSBtZXRyaWNcbiAgICovXG4gIG1ldHJpY1NlYXJjaFJlcXVlc3RDb3VudChwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljO1xuXG4gIC8qKlxuICAgKiBNZXRyaWMgZm9yIHRoZSBudW1iZXIgb2YgaW5kZXggcmVxdWVzdHMuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyBQcm9wZXJ0aWVzIGZvciB0aGUgbWV0cmljXG4gICAqL1xuICBtZXRyaWNJbmRleFJlcXVlc3RDb3VudChwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljO1xuXG4gIC8qKlxuICAgKiBNZXRyaWMgZm9yIHRoZSBzZWFyY2ggbGF0ZW5jeS5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIFByb3BlcnRpZXMgZm9yIHRoZSBtZXRyaWNcbiAgICovXG4gIG1ldHJpY1NlYXJjaExhdGVuY3kocHJvcHM/OiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMpOiBjbG91ZHdhdGNoLk1ldHJpYztcblxuICAvKipcbiAgICogTWV0cmljIGZvciB0aGUgOTB0aCBwZXJjZW50aWxlIHNlYXJjaCBsYXRlbmN5LlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgUHJvcGVydGllcyBmb3IgdGhlIG1ldHJpY1xuICAgKi9cbiAgbWV0cmljU2VhcmNoTGF0ZW5jeVA5MChwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljO1xufVxuXG4vKipcbiAqIEEgbmV3IG9yIGltcG9ydGVkIHZlY3RvciBjb2xsZWN0aW9uLlxuICovXG5hYnN0cmFjdCBjbGFzcyBWZWN0b3JDb2xsZWN0aW9uQmFzZSBleHRlbmRzIGNkay5SZXNvdXJjZSBpbXBsZW1lbnRzIElWZWN0b3JDb2xsZWN0aW9uIHtcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGNvbGxlY3Rpb25OYW1lOiBzdHJpbmc7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBjb2xsZWN0aW9uSWQ6IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGNvbGxlY3Rpb25Bcm46IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IHN0YW5kYnlSZXBsaWNhczogVmVjdG9yQ29sbGVjdGlvblN0YW5kYnlSZXBsaWNhcztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGFvc3NQb2xpY3k6IGlhbS5NYW5hZ2VkUG9saWN5O1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgZGF0YUFjY2Vzc1BvbGljeTogb3NzLkNmbkFjY2Vzc1BvbGljeTtcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGNvbGxlY3Rpb25UeXBlOiBWZWN0b3JDb2xsZWN0aW9uVHlwZTtcblxuICBwdWJsaWMgbWV0cmljKG1ldHJpY05hbWU6IHN0cmluZywgcHJvcHM/OiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMpOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgcmV0dXJuIG5ldyBjbG91ZHdhdGNoLk1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQU9TUycsXG4gICAgICBtZXRyaWNOYW1lLFxuICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICBDb2xsZWN0aW9uSWQ6IHRoaXMuY29sbGVjdGlvbklkLFxuICAgICAgfSxcbiAgICAgIC4uLnByb3BzLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIG1ldHJpY1NlYXJjaFJlcXVlc3RDb3VudChwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoJ1NlYXJjaFJlcXVlc3RDb3VudCcsIHByb3BzKTtcbiAgfVxuXG4gIHB1YmxpYyBtZXRyaWNJbmRleFJlcXVlc3RDb3VudChwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoJ0luZGV4UmVxdWVzdENvdW50JywgcHJvcHMpO1xuICB9XG5cbiAgcHVibGljIG1ldHJpY1NlYXJjaExhdGVuY3kocHJvcHM/OiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMpOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljKCdTZWFyY2hMYXRlbmN5JywgeyBzdGF0aXN0aWM6ICdBdmVyYWdlJywgLi4ucHJvcHMgfSk7XG4gIH1cblxuICBwdWJsaWMgbWV0cmljU2VhcmNoTGF0ZW5jeVA5MChwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoJ1NlYXJjaExhdGVuY3knLCB7IHN0YXRpc3RpYzogJ3A5MCcsIC4uLnByb3BzIH0pO1xuICB9XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYSB2ZWN0b3Igc2VhcmNoIGNvbGxlY3Rpb24gaW4gQW1hem9uIE9wZW5TZWFyY2ggU2VydmVybGVzcy5cbiAqL1xuZXhwb3J0IGNsYXNzIFZlY3RvckNvbGxlY3Rpb24gZXh0ZW5kcyBWZWN0b3JDb2xsZWN0aW9uQmFzZSB7XG4gIC8qKlxuICAgKiBSZXR1cm4gbWV0cmljcyBmb3IgYWxsIHZlY3RvciBjb2xsZWN0aW9ucy5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgbWV0cmljQWxsKG1ldHJpY05hbWU6IHN0cmluZywgcHJvcHM/OiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMpOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgcmV0dXJuIG5ldyBjbG91ZHdhdGNoLk1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQU9TUycsXG4gICAgICBtZXRyaWNOYW1lLFxuICAgICAgc3RhdGlzdGljOiAnU3VtJyxcbiAgICAgIC4uLnByb3BzLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE1ldHJpYyBmb3IgdGhlIHRvdGFsIG51bWJlciBvZiBzZWFyY2ggcmVxdWVzdHMgYWNyb3NzIGFsbCBjb2xsZWN0aW9ucy5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgbWV0cmljQWxsU2VhcmNoUmVxdWVzdENvdW50KHByb3BzPzogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zKTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgIHJldHVybiB0aGlzLm1ldHJpY0FsbCgnU2VhcmNoUmVxdWVzdENvdW50JywgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1ldHJpYyBmb3IgdGhlIHRvdGFsIG51bWJlciBvZiBpbmRleCByZXF1ZXN0cyBhY3Jvc3MgYWxsIGNvbGxlY3Rpb25zLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBtZXRyaWNBbGxJbmRleFJlcXVlc3RDb3VudChwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWNBbGwoJ0luZGV4UmVxdWVzdENvdW50JywgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1ldHJpYyBmb3IgYXZlcmFnZSBzZWFyY2ggbGF0ZW5jeSBhY3Jvc3MgYWxsIGNvbGxlY3Rpb25zLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBtZXRyaWNBbGxTZWFyY2hMYXRlbmN5KHByb3BzPzogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zKTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgIHJldHVybiB0aGlzLm1ldHJpY0FsbCgnU2VhcmNoTGF0ZW5jeScsIHtcbiAgICAgIHN0YXRpc3RpYzogJ0F2ZXJhZ2UnLFxuICAgICAgLi4ucHJvcHMsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSW1wb3J0IGFuIGV4aXN0aW5nIGNvbGxlY3Rpb24gdXNpbmcgaXRzIGF0dHJpYnV0ZXMuXG4gICAqIEBwYXJhbSBjb25zdHJ1Y3RTY29wZSBUaGUgcGFyZW50IGNyZWF0aW5nIGNvbnN0cnVjdC5cbiAgICogQHBhcmFtIGNvbnN0cnVjdElkIFRoZSBjb25zdHJ1Y3QncyBuYW1lLlxuICAgKiBAcGFyYW0gYXR0cnMgVGhlIGNvbGxlY3Rpb24gYXR0cmlidXRlcyB0byB1c2UuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZyb21Db2xsZWN0aW9uQXR0cmlidXRlcyhcbiAgICBjb25zdHJ1Y3RTY29wZTogQ29uc3RydWN0LFxuICAgIGNvbnN0cnVjdElkOiBzdHJpbmcsXG4gICAgYXR0cnM6IFZlY3RvckNvbGxlY3Rpb25BdHRyaWJ1dGVzLFxuICApOiBJVmVjdG9yQ29sbGVjdGlvbiB7XG4gICAgY2xhc3MgSW1wb3J0IGV4dGVuZHMgVmVjdG9yQ29sbGVjdGlvbkJhc2Uge1xuICAgICAgcHVibGljIHJlYWRvbmx5IGNvbGxlY3Rpb25Bcm4gPSBhdHRycy5jb2xsZWN0aW9uQXJuO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGNvbGxlY3Rpb25JZCA9IGF0dHJzLmNvbGxlY3Rpb25JZDtcbiAgICAgIHB1YmxpYyByZWFkb25seSBjb2xsZWN0aW9uTmFtZSA9IGF0dHJzLmNvbGxlY3Rpb25OYW1lO1xuICAgICAgcHVibGljIHJlYWRvbmx5IHN0YW5kYnlSZXBsaWNhcyA9IGF0dHJzLnN0YW5kYnlSZXBsaWNhcztcbiAgICAgIHB1YmxpYyByZWFkb25seSBjb2xsZWN0aW9uVHlwZSA9IGF0dHJzLmNvbGxlY3Rpb25UeXBlO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGFvc3NQb2xpY3k6IGlhbS5NYW5hZ2VkUG9saWN5O1xuICAgICAgcHVibGljIHJlYWRvbmx5IGRhdGFBY2Nlc3NQb2xpY3k6IG9zcy5DZm5BY2Nlc3NQb2xpY3k7XG5cbiAgICAgIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgICAgICB0aGlzLmFvc3NQb2xpY3kgPSBuZXcgaWFtLk1hbmFnZWRQb2xpY3kodGhpcywgJ0ltcG9ydGVkQU9TU1BvbGljeScsIHtcbiAgICAgICAgICBzdGF0ZW1lbnRzOiBbXG4gICAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICAgIGVmZmVjdDogaWFtLkVmZmVjdC5BTExPVyxcbiAgICAgICAgICAgICAgYWN0aW9uczogWydhb3NzOkFQSUFjY2Vzc0FsbCddLFxuICAgICAgICAgICAgICByZXNvdXJjZXM6IFt0aGlzLmNvbGxlY3Rpb25Bcm5dLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5kYXRhQWNjZXNzUG9saWN5ID0gbmV3IG9zcy5DZm5BY2Nlc3NQb2xpY3kodGhpcywgJ0ltcG9ydGVkRGF0YUFjY2Vzc1BvbGljeScsIHtcbiAgICAgICAgICBuYW1lOiBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsICdEYXRhQWNjZXNzUG9saWN5JywgeyBtYXhMZW5ndGg6IDMyLCBsb3dlcjogdHJ1ZSB9KSxcbiAgICAgICAgICB0eXBlOiAnZGF0YScsXG4gICAgICAgICAgcG9saWN5OiAnW10nLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ldyBJbXBvcnQoY29uc3RydWN0U2NvcGUsIGNvbnN0cnVjdElkKTtcbiAgfVxuXG4gIHB1YmxpYyByZWFkb25seSBjb2xsZWN0aW9uTmFtZTogc3RyaW5nO1xuICBwdWJsaWMgcmVhZG9ubHkgc3RhbmRieVJlcGxpY2FzOiBWZWN0b3JDb2xsZWN0aW9uU3RhbmRieVJlcGxpY2FzO1xuICBwdWJsaWMgcmVhZG9ubHkgY29sbGVjdGlvbklkOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBjb2xsZWN0aW9uQXJuOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBhb3NzUG9saWN5OiBpYW0uTWFuYWdlZFBvbGljeTtcbiAgcHVibGljIHJlYWRvbmx5IGRhdGFBY2Nlc3NQb2xpY3k6IG9zcy5DZm5BY2Nlc3NQb2xpY3k7XG4gIHB1YmxpYyByZWFkb25seSBjb2xsZWN0aW9uVHlwZTogVmVjdG9yQ29sbGVjdGlvblR5cGU7XG4gIHB1YmxpYyByZWFkb25seSBjb2xsZWN0aW9uRW5kcG9pbnQ6IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IGRhc2hib2FyZEVuZHBvaW50OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEluc3RhbmNlIG9mIENmbkNvbGxlY3Rpb24uXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9yZXNvdXJjZTogb3NzLkNmbkNvbGxlY3Rpb247XG5cbiAgLyoqXG4gICAqIEFuIE9wZW5TZWFyY2ggQWNjZXNzIFBvbGljeSBkb2N1bWVudCB0aGF0IHdpbGwgYmVjb21lIGBkYXRhQWNjZXNzUG9saWN5YC5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgZGF0YUFjY2Vzc1BvbGljeURvY3VtZW50OiBhbnlbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzPzogVmVjdG9yQ29sbGVjdGlvblByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIHRoaXMuY29sbGVjdGlvbk5hbWUgPSBwcm9wcz8uY29sbGVjdGlvbk5hbWUgPz8gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMihcbiAgICAgIHRoaXMsXG4gICAgICAnVmVjdG9yU3RvcmUnLFxuICAgICAgeyBtYXhMZW5ndGg6IDMyLCBsb3dlcjogdHJ1ZSB9LFxuICAgICk7XG5cbiAgICB0aGlzLnN0YW5kYnlSZXBsaWNhcyA9IHByb3BzPy5zdGFuZGJ5UmVwbGljYXMgPz8gVmVjdG9yQ29sbGVjdGlvblN0YW5kYnlSZXBsaWNhcy5FTkFCTEVEO1xuICAgIHRoaXMuY29sbGVjdGlvblR5cGUgPSBwcm9wcz8uY29sbGVjdGlvblR5cGUgPz8gVmVjdG9yQ29sbGVjdGlvblR5cGUuVkVDVE9SU0VBUkNIO1xuXG4gICAgY29uc3QgZW5jcnlwdGlvblBvbGljeU5hbWUgPSBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsXG4gICAgICAnRW5jcnlwdGlvblBvbGljeScsXG4gICAgICB7IG1heExlbmd0aDogMzIsIGxvd2VyOiB0cnVlIH0pO1xuICAgIGNvbnN0IGVuY3J5cHRpb25Qb2xpY3kgPSBuZXcgb3NzLkNmblNlY3VyaXR5UG9saWN5KHRoaXMsICdFbmNyeXB0aW9uUG9saWN5Jywge1xuICAgICAgbmFtZTogZW5jcnlwdGlvblBvbGljeU5hbWUsXG4gICAgICB0eXBlOiAnZW5jcnlwdGlvbicsXG4gICAgICBwb2xpY3k6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgUnVsZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBSZXNvdXJjZVR5cGU6ICdjb2xsZWN0aW9uJyxcbiAgICAgICAgICAgIFJlc291cmNlOiBbYGNvbGxlY3Rpb24vJHt0aGlzLmNvbGxlY3Rpb25OYW1lfWBdLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIEFXU093bmVkS2V5OiB0cnVlLFxuICAgICAgfSksXG4gICAgfSk7XG5cbiAgICBjb25zdCBuZXR3b3JrUG9saWN5TmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcyxcbiAgICAgICdOZXR3b3JrUG9saWN5JyxcbiAgICAgIHsgbWF4TGVuZ3RoOiAzMiwgbG93ZXI6IHRydWUgfSk7XG4gICAgY29uc3QgbmV0d29ya1BvbGljeSA9IG5ldyBvc3MuQ2ZuU2VjdXJpdHlQb2xpY3kodGhpcywgJ05ldHdvcmtQb2xpY3knLCB7XG4gICAgICBuYW1lOiBuZXR3b3JrUG9saWN5TmFtZSxcbiAgICAgIHR5cGU6ICduZXR3b3JrJyxcbiAgICAgIHBvbGljeTogSlNPTi5zdHJpbmdpZnkoW1xuICAgICAgICB7XG4gICAgICAgICAgUnVsZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgUmVzb3VyY2VUeXBlOiAnY29sbGVjdGlvbicsXG4gICAgICAgICAgICAgIFJlc291cmNlOiBbYGNvbGxlY3Rpb24vJHt0aGlzLmNvbGxlY3Rpb25OYW1lfWBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgUmVzb3VyY2VUeXBlOiAnZGFzaGJvYXJkJyxcbiAgICAgICAgICAgICAgUmVzb3VyY2U6IFtgY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbk5hbWV9YF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgQWxsb3dGcm9tUHVibGljOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgXSksXG4gICAgfSk7XG5cbiAgICB0aGlzLl9yZXNvdXJjZSA9IG5ldyBvc3MuQ2ZuQ29sbGVjdGlvbih0aGlzLCAnVmVjdG9yQ29sbGVjdGlvbicsIHtcbiAgICAgIG5hbWU6IHRoaXMuY29sbGVjdGlvbk5hbWUsXG4gICAgICB0eXBlOiB0aGlzLmNvbGxlY3Rpb25UeXBlLFxuICAgICAgc3RhbmRieVJlcGxpY2FzOiB0aGlzLnN0YW5kYnlSZXBsaWNhcyxcbiAgICAgIGRlc2NyaXB0aW9uOiBwcm9wcz8uZGVzY3JpcHRpb24sXG4gICAgICB0YWdzOiBwcm9wcz8udGFncyxcbiAgICB9KTtcblxuICAgIHRoaXMuY29sbGVjdGlvbkFybiA9IHRoaXMuX3Jlc291cmNlLmF0dHJBcm47XG4gICAgdGhpcy5jb2xsZWN0aW9uSWQgPSB0aGlzLl9yZXNvdXJjZS5hdHRySWQ7XG4gICAgdGhpcy5jb2xsZWN0aW9uRW5kcG9pbnQgPSB0aGlzLl9yZXNvdXJjZS5hdHRyQ29sbGVjdGlvbkVuZHBvaW50O1xuICAgIHRoaXMuZGFzaGJvYXJkRW5kcG9pbnQgPSB0aGlzLl9yZXNvdXJjZS5hdHRyRGFzaGJvYXJkRW5kcG9pbnQ7XG5cbiAgICBpZiAocHJvcHM/LmN1c3RvbUFvc3NQb2xpY3kpIHtcbiAgICAgIHRoaXMuYW9zc1BvbGljeSA9IHByb3BzLmN1c3RvbUFvc3NQb2xpY3k7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYW9zc1BvbGljeSA9IG5ldyBpYW0uTWFuYWdlZFBvbGljeShcbiAgICAgICAgdGhpcyxcbiAgICAgICAgJ0FPU1NBcGlBY2Nlc3NBbGwnLCB7XG4gICAgICAgICAgc3RhdGVtZW50czogW1xuICAgICAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICAgICAnYW9zczpBUElBY2Nlc3NBbGwnLFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICByZXNvdXJjZXM6IFt0aGlzLl9yZXNvdXJjZS5hdHRyQXJuXSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuX3Jlc291cmNlLm5vZGUuYWRkRGVwZW5kZW5jeShlbmNyeXB0aW9uUG9saWN5KTtcbiAgICB0aGlzLl9yZXNvdXJjZS5ub2RlLmFkZERlcGVuZGVuY3kobmV0d29ya1BvbGljeSk7XG5cbiAgICBjb25zdCBpc0RhdGFBY2Nlc3NQb2xpY3lOb3RFbXB0eSA9IG5ldyBjZGsuQ2ZuQ29uZGl0aW9uKHRoaXMsICdJc0RhdGFBY2Nlc3NQb2xpY3lOb3RFbXB0eScsIHtcbiAgICAgIGV4cHJlc3Npb246IGNkay5Gbi5jb25kaXRpb25Ob3QoY2RrLkZuLmNvbmRpdGlvbkVxdWFscygwLCBjZGsuTGF6eS5udW1iZXIoe1xuICAgICAgICBwcm9kdWNlOiAoKSA9PiB0aGlzLmRhdGFBY2Nlc3NQb2xpY3lEb2N1bWVudC5sZW5ndGgsXG4gICAgICB9KSkpLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZGF0YUFjY2Vzc1BvbGljeU5hbWUgPSBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsXG4gICAgICAnRGF0YUFjY2Vzc1BvbGljeScsXG4gICAgICB7IG1heExlbmd0aDogMzIsIGxvd2VyOiB0cnVlIH0pO1xuXG4gICAgdGhpcy5kYXRhQWNjZXNzUG9saWN5ID0gbmV3IG9zcy5DZm5BY2Nlc3NQb2xpY3kodGhpcywgJ0RhdGFBY2Nlc3NQb2xpY3knLCB7XG4gICAgICBuYW1lOiBkYXRhQWNjZXNzUG9saWN5TmFtZSxcbiAgICAgIHR5cGU6ICdkYXRhJyxcbiAgICAgIHBvbGljeTogY2RrLkxhenkuc3RyaW5nKHtcbiAgICAgICAgcHJvZHVjZTogKCkgPT4gSlNPTi5zdHJpbmdpZnkodGhpcy5kYXRhQWNjZXNzUG9saWN5RG9jdW1lbnQpLFxuICAgICAgfSksXG4gICAgfSk7XG5cbiAgICB0aGlzLmRhdGFBY2Nlc3NQb2xpY3kuY2ZuT3B0aW9ucy5jb25kaXRpb24gPSBpc0RhdGFBY2Nlc3NQb2xpY3lOb3RFbXB0eTtcblxuICAgIHRoaXMubm9kZS5hZGRWYWxpZGF0aW9uKHtcbiAgICAgIHZhbGlkYXRlOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uTmFtZSkge1xuICAgICAgICAgIGlmICghL15bYS16MC05LV0rJC8udGVzdCh0aGlzLmNvbGxlY3Rpb25OYW1lKSkge1xuICAgICAgICAgICAgZXJyb3JzLnB1c2goJ0NvbGxlY3Rpb24gbmFtZSBtdXN0IGNvbnRhaW4gb25seSBsb3dlcmNhc2UgbGV0dGVycywgbnVtYmVycywgYW5kIGh5cGhlbnMnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHRoaXMuY29sbGVjdGlvbk5hbWUubGVuZ3RoIDwgMyB8fCB0aGlzLmNvbGxlY3Rpb25OYW1lLmxlbmd0aCA+IDMyKSB7XG4gICAgICAgICAgICBlcnJvcnMucHVzaCgnQ29sbGVjdGlvbiBuYW1lIG11c3QgYmUgYmV0d2VlbiAzIGFuZCAzMiBjaGFyYWN0ZXJzJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVycm9ycztcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjZGsuVGFncy5vZih0aGlzKS5hZGQoJ05hbWUnLCB0aGlzLmNvbGxlY3Rpb25OYW1lKTtcbiAgICBjZGsuVGFncy5vZih0aGlzKS5hZGQoJ1R5cGUnLCAnVmVjdG9yQ29sbGVjdGlvbicpO1xuICB9XG4gIC8qKlxuICAgKiBHcmFudHMgdGhlIHNwZWNpZmllZCByb2xlIGFjY2VzcyB0byBkYXRhIGluIHRoZSBjb2xsZWN0aW9uLlxuICAgKiBAcGFyYW0gZ3JhbnRlZSBUaGUgcm9sZSB0byBncmFudCBhY2Nlc3MgdG8uXG4gICAqL1xuICBncmFudERhdGFBY2Nlc3MoZ3JhbnRlZTogaWFtLklSb2xlKSB7XG4gICAgdGhpcy5kYXRhQWNjZXNzUG9saWN5RG9jdW1lbnQucHVzaCh7XG4gICAgICBSdWxlczogW1xuICAgICAgICB7XG4gICAgICAgICAgUmVzb3VyY2U6IFtgY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbk5hbWV9YF0sXG4gICAgICAgICAgUGVybWlzc2lvbjogW1xuICAgICAgICAgICAgJ2Fvc3M6RGVzY3JpYmVDb2xsZWN0aW9uSXRlbXMnLFxuICAgICAgICAgICAgJ2Fvc3M6Q3JlYXRlQ29sbGVjdGlvbkl0ZW1zJyxcbiAgICAgICAgICAgICdhb3NzOlVwZGF0ZUNvbGxlY3Rpb25JdGVtcycsXG4gICAgICAgICAgXSxcbiAgICAgICAgICBSZXNvdXJjZVR5cGU6ICdjb2xsZWN0aW9uJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIFJlc291cmNlOiBbYGluZGV4LyR7dGhpcy5jb2xsZWN0aW9uTmFtZX0vKmBdLFxuICAgICAgICAgIFBlcm1pc3Npb246IFtcbiAgICAgICAgICAgICdhb3NzOlVwZGF0ZUluZGV4JyxcbiAgICAgICAgICAgICdhb3NzOkRlc2NyaWJlSW5kZXgnLFxuICAgICAgICAgICAgJ2Fvc3M6UmVhZERvY3VtZW50JyxcbiAgICAgICAgICAgICdhb3NzOldyaXRlRG9jdW1lbnQnLFxuICAgICAgICAgICAgJ2Fvc3M6Q3JlYXRlSW5kZXgnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgUmVzb3VyY2VUeXBlOiAnaW5kZXgnLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIFByaW5jaXBhbDogW1xuICAgICAgICBncmFudGVlLnJvbGVBcm4sXG4gICAgICBdLFxuICAgICAgRGVzY3JpcHRpb246ICcnLFxuICAgIH0pO1xuICAgIGdyYW50ZWUuYWRkTWFuYWdlZFBvbGljeSh0aGlzLmFvc3NQb2xpY3kpO1xuICB9XG59XG4iXX0=