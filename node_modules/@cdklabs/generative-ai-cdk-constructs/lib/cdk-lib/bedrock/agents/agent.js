"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Agent = exports.AgentBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const bedrock = require("aws-cdk-lib/aws-bedrock");
const iam = require("aws-cdk-lib/aws-iam");
const kms = require("aws-cdk-lib/aws-kms");
// Internal Libs
const action_group_1 = require("./action-group");
const agent_alias_1 = require("./agent-alias");
const utils_1 = require("../../../common/helpers/utils");
const validation = require("../../../common/helpers/validation-helpers");
/******************************************************************************
 *                        ABSTRACT BASE CLASS
 *****************************************************************************/
/**
 * Abstract base class for an Agent.
 * Contains methods and attributes valid for Agents either created with CDK or imported.
 */
class AgentBase extends aws_cdk_lib_1.Resource {
}
exports.AgentBase = AgentBase;
_a = JSII_RTTI_SYMBOL_1;
AgentBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.AgentBase", version: "0.1.312" };
/******************************************************************************
 *                        NEW CONSTRUCT DEFINITION
 *****************************************************************************/
/**
 * Class to create (or import) an Agent with CDK.
 * @cloudformationResource AWS::Bedrock::Agent
 */
class Agent extends AgentBase {
    /**
     * Static Method for importing an existing Bedrock Agent.
     */
    static fromAgentAttrs(scope, id, attrs) {
        class Import extends AgentBase {
            constructor() {
                super(...arguments);
                this.agentArn = attrs.agentArn;
                this.agentId = aws_cdk_lib_1.Arn.split(attrs.agentArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME).resourceName;
                this.role = iam.Role.fromRoleArn(scope, `${id}Role`, attrs.roleArn);
                this.kmsKey = attrs.kmsKeyArn ? kms.Key.fromKeyArn(scope, `${id}Key`, attrs.kmsKeyArn) : undefined;
                this.lastUpdated = attrs.lastUpdated;
                this.agentVersion = attrs.agentVersion ?? 'DRAFT';
            }
        }
        // Return new Agent
        return new Import(scope, id);
    }
    // ------------------------------------------------------
    // CONSTRUCTOR
    // ------------------------------------------------------
    constructor(scope, id, props) {
        super(scope, id);
        // ------------------------------------------------------
        // Validators
        // ------------------------------------------------------
        /**
         * Checks if the KB Association is valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateKnowledgeBase = (knowledgeBase) => {
            const MAX_LENGTH = 200;
            const description = knowledgeBase.instruction ?? knowledgeBase.description;
            const errors = [];
            // If at least one of the previous has been defined
            if (description) {
                errors.push(...validation.validateStringFieldLength({
                    value: description,
                    fieldName: 'description',
                    minLength: 0,
                    maxLength: MAX_LENGTH,
                }));
            }
            else {
                errors.push('If instructionForAgents is not provided, the description property of the KnowledgeBase ' +
                    `${knowledgeBase.knowledgeBaseId} must be provided.`);
            }
            return errors;
        };
        /**
         * Checks if the KB Associations are valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateKnowledgeBaseAssocations = () => {
            const MAX_KB_ASSOCIATIONS = 10;
            const errors = [];
            if (this.knowledgeBases.length > MAX_KB_ASSOCIATIONS) {
                errors.push(`The maximum number of knowledge bases associations is ${MAX_KB_ASSOCIATIONS}.`);
            }
            for (const kb of this.knowledgeBases) {
                this.validateKnowledgeBase(kb);
            }
            return errors;
        };
        /**
         * Checks if the Guardrail is valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateGuardrail = (guardrail) => {
            const errors = [];
            if (this.guardrail) {
                errors.push(`Cannot add Guardrail ${guardrail.guardrailId}. ` +
                    `Guardrail ${this.guardrail.guardrailId} has already been specified for this agent.`);
            }
            errors.push(...validation.validateFieldPattern(guardrail.guardrailVersion, 'version', /^(([0-9]{1,8})|(DRAFT))$/));
            return errors;
        };
        /**
         * Check if the action group is valid
         */
        this.validateActionGroup = (actionGroup) => {
            let errors = [];
            // Find if there is a conflicting action group name
            if (this.actionGroups?.find(ag => ag.name === actionGroup.name)) {
                errors.push(`An action group with name: ${actionGroup.name} has already been defined`);
            }
            return errors;
        };
        // ------------------------------------------------------
        // Set properties and defaults
        // ------------------------------------------------------
        this.name =
            props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'bedrock-agent', { maxLength: 64, lower: true, separator: '-' });
        this.idleSessionTTL = props.idleSessionTTL ?? aws_cdk_lib_1.Duration.hours(1);
        this.shouldPrepareAgent = props.shouldPrepareAgent ?? false;
        this.userInputEnabled = props.userInputEnabled ?? false;
        this.codeInterpreterEnabled = props.codeInterpreterEnabled ?? false;
        this.foundationModel = props.foundationModel;
        this.forceDelete = props.forceDelete ?? false;
        // Optional
        this.description = props.description;
        this.instruction = props.instruction;
        this.promptOverrideConfiguration = props.promptOverrideConfiguration;
        this.kmsKey = props.kmsKey;
        this.memory = props.memory;
        this.agentCollaboration = props.agentCollaboration;
        this.customOrchestration = props.customOrchestration;
        this.orchestrationType = props.orchestrationType;
        // ------------------------------------------------------
        // Role
        // ------------------------------------------------------
        // If existing role is provided, use it.
        if (props.existingRole) {
            this.role = props.existingRole;
            // Otherwise, create a new one
        }
        else {
            this.role = new iam.Role(this, 'Role', {
                // generate a role name
                roleName: (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForAgents_', { maxLength: 64, lower: false }),
                // ensure the role has a trust policy that allows the Bedrock service to assume the role
                assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com').withConditions({
                    StringEquals: {
                        'aws:SourceAccount': aws_cdk_lib_1.Stack.of(this).account,
                    },
                    ArnLike: {
                        'aws:SourceArn': aws_cdk_lib_1.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'agent',
                            resourceName: '*',
                            arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    },
                }),
            });
        }
        // ------------------------------------------------------
        // Set Lazy Props initial values
        // ------------------------------------------------------
        this.knowledgeBases = [];
        this.actionGroups = [];
        this.agentCollaborators = [];
        // Add Default Action Groups
        this.addActionGroup(action_group_1.AgentActionGroup.userInput(this.userInputEnabled));
        this.addActionGroup(action_group_1.AgentActionGroup.codeInterpreter(this.codeInterpreterEnabled));
        // Add specified elems through methods to handle permissions
        // this needs to happen after role creation / assignment
        props.knowledgeBases?.forEach(kb => {
            this.addKnowledgeBase(kb);
        });
        props.actionGroups?.forEach(ag => {
            this.addActionGroup(ag);
        });
        props.agentCollaborators?.forEach(ac => {
            this.addAgentCollaborator(ac);
        });
        if (props.guardrail) {
            this.addGuardrail(props.guardrail);
        }
        // Grant permissions for custom orchestration if provided
        if (this.customOrchestration?.executor?.lambdaFunction) {
            this.customOrchestration.executor.lambdaFunction.grantInvoke(this.role);
            this.customOrchestration.executor.lambdaFunction.addPermission(`OrchestrationLambdaInvocationPolicy-${this.node.addr.slice(0, 16)}`, {
                principal: new iam.ServicePrincipal('bedrock.amazonaws.com'),
                sourceArn: aws_cdk_lib_1.Lazy.string({ produce: () => this.agentArn }),
                sourceAccount: aws_cdk_lib_1.Stack.of(this).account,
            });
        }
        // ------------------------------------------------------
        // Set Lazy Validations
        // ------------------------------------------------------
        this.node.addValidation({
            validate: () => this.validateKnowledgeBaseAssocations(),
        });
        // ------------------------------------------------------
        // CFN Props - With Lazy support
        // ------------------------------------------------------
        const cfnProps = {
            actionGroups: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderActionGroups() }, { omitEmptyArray: true }),
            agentName: this.name,
            agentResourceRoleArn: this.role.roleArn,
            autoPrepare: this.shouldPrepareAgent,
            customerEncryptionKeyArn: props.kmsKey?.keyArn,
            description: props.description,
            foundationModel: this.foundationModel.invokableArn,
            guardrailConfiguration: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderGuardrail() }),
            idleSessionTtlInSeconds: this.idleSessionTTL.toSeconds(),
            instruction: props.instruction,
            knowledgeBases: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderKnowledgeBases() }, { omitEmptyArray: true }),
            memoryConfiguration: props.memory,
            promptOverrideConfiguration: this.promptOverrideConfiguration?._render(),
            skipResourceInUseCheckOnDelete: this.forceDelete,
            agentCollaboration: this.agentCollaboration,
            agentCollaborators: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderAgentCollaborators() }, { omitEmptyArray: true }),
            customOrchestration: this.renderCustomOrchestration(),
            orchestrationType: this.orchestrationType,
        };
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new bedrock.CfnAgent(this, 'AgentResource', cfnProps);
        this.agentId = this.__resource.attrAgentId;
        this.agentArn = this.__resource.attrAgentArn;
        this.agentVersion = this.__resource.attrAgentVersion;
        this.lastUpdated = this.__resource.attrUpdatedAt;
        // Add explicit dependency between the agent resource and the agent's role default policy
        // See https://github.com/awslabs/generative-ai-cdk-constructs/issues/899
        if (!props.existingRole) {
            // add the appropriate permissions to use the FM
            const grant = this.foundationModel.grantInvoke(this.role);
            grant.applyBefore(this.__resource);
        }
        this.testAlias = agent_alias_1.AgentAlias.fromAttributes(this, 'DefaultAlias', {
            aliasId: 'TSTALIASID',
            aliasName: 'AgentTestAlias',
            agentVersion: 'DRAFT',
            agent: this,
        });
    }
    // ------------------------------------------------------
    // HELPER METHODS - addX()
    // ------------------------------------------------------
    /**
     * Add knowledge base to the agent.
     */
    addKnowledgeBase(knowledgeBase) {
        // Do some checks
        validation.throwIfInvalid(this.validateKnowledgeBase, knowledgeBase);
        // Add it to the array
        this.knowledgeBases.push(knowledgeBase);
        // Add the appropriate Permissions to query the Knowledge Base
        knowledgeBase.grantQuery(this.role);
    }
    /**
     * Add guardrail to the agent.
     */
    addGuardrail(guardrail) {
        // Do some checks
        validation.throwIfInvalid(this.validateGuardrail, guardrail);
        // Add it to the construct
        this.guardrail = guardrail;
        // Handle permissions
        guardrail.grantApply(this.role);
    }
    /**
     * Add an action group to the agent.
     */
    addActionGroup(actionGroup) {
        // Do some checks
        validation.throwIfInvalid(this.validateActionGroup, actionGroup);
        // Add it to the array
        this.actionGroups.push(actionGroup);
        // Handle permissions to invoke the lambda function
        actionGroup.executor?.lambdaFunction?.grantInvoke(this.role);
        actionGroup.executor?.lambdaFunction?.addPermission(`LambdaInvocationPolicy-${this.node.addr.slice(0, 16)}`, {
            principal: new iam.ServicePrincipal('bedrock.amazonaws.com'),
            sourceArn: this.agentArn,
            sourceAccount: aws_cdk_lib_1.Stack.of(this).account,
        });
        // Handle permissions to access the schema file from S3
        if (actionGroup.apiSchema?.s3File) {
            this.role.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: ['s3:GetObject'],
                resources: [`arn:${aws_cdk_lib_1.Aws.PARTITION}:s3:::${actionGroup.apiSchema.s3File.bucketName}/${actionGroup.apiSchema.s3File.objectKey}`],
                conditions: {
                    StringEquals: {
                        'aws:ResourceAccount': aws_cdk_lib_1.Stack.of(this).account,
                    },
                },
            }));
        }
    }
    /**
     * Add an agent collaborator to the agent.
     */
    addAgentCollaborator(agentCollaborator) {
        this.agentCollaborators?.push(agentCollaborator);
        agentCollaborator.grant(this.role);
    }
    /**
     * Add multiple action groups to the agent.
     */
    addActionGroups(...actionGroups) {
        actionGroups.forEach(ag => this.addActionGroup(ag));
    }
    // ------------------------------------------------------
    // Lazy Renderers
    // ------------------------------------------------------
    /**
     * Render the guardrail configuration.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderGuardrail() {
        return this.guardrail
            ? {
                guardrailIdentifier: this.guardrail.guardrailId,
                guardrailVersion: this.guardrail.guardrailVersion,
            }
            : undefined;
    }
    /**
     * Render the knowledge base associations.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderKnowledgeBases() {
        const knowledgeBaseAssociationsCfn = [];
        // Build the associations in the CFN format
        this.knowledgeBases.forEach(kb => {
            knowledgeBaseAssociationsCfn.push({
                knowledgeBaseId: kb.knowledgeBaseId,
                knowledgeBaseState: 'ENABLED',
                // at least one is defined as it has been validated when adding the kb
                description: kb.instruction ?? kb.description,
            });
        });
        return knowledgeBaseAssociationsCfn;
    }
    /**
     * Render the action groups
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderActionGroups() {
        const actionGroupsCfn = [];
        // Build the associations in the CFN format
        this.actionGroups.forEach(ag => {
            actionGroupsCfn.push(ag._render());
        });
        return actionGroupsCfn;
    }
    /**
     * Render the agent collaborators.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderAgentCollaborators() {
        if (!this.agentCollaborators || this.agentCollaborators.length === 0) {
            return undefined;
        }
        const agentCollaboratorsCfn = [];
        this.agentCollaborators.forEach(ac => {
            agentCollaboratorsCfn.push(ac._render());
        });
        return agentCollaboratorsCfn;
    }
    /**
     * Render the custom orchestration.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderCustomOrchestration() {
        if (!this.customOrchestration) {
            return undefined;
        }
        return {
            executor: {
                lambda: this.customOrchestration.executor.lambdaFunction.functionArn,
            },
        };
    }
}
exports.Agent = Agent;
_b = JSII_RTTI_SYMBOL_1;
Agent[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Agent", version: "0.1.312" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWdlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2FnZW50cy9hZ2VudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBRUgsNkNBQThGO0FBQzlGLG1EQUFtRDtBQUNuRCwyQ0FBMkM7QUFDM0MsMkNBQTJDO0FBRTNDLGdCQUFnQjtBQUNoQixpREFBa0Q7QUFDbEQsK0NBQXdEO0FBR3hELHlEQUF1RTtBQUN2RSx5RUFBeUU7QUFzQ3pFOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBc0IsU0FBVSxTQUFRLHNCQUFROztBQUFoRCw4QkFPQzs7O0FBa0tEOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBYSxLQUFNLFNBQVEsU0FBUztJQUNsQzs7T0FFRztJQUNJLE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBc0I7UUFDL0UsTUFBTSxNQUFPLFNBQVEsU0FBUztZQUE5Qjs7Z0JBQ2tCLGFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO2dCQUMxQixZQUFPLEdBQUcsaUJBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSx1QkFBUyxDQUFDLG1CQUFtQixDQUFDLENBQUMsWUFBYSxDQUFDO2dCQUNqRixTQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUMvRCxXQUFNLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQzlGLGdCQUFXLEdBQUcsS0FB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O1FBQ25CLENBQUM7UUFFRCxPQUFPO1lBQ0wsUUFBUSxFQUFFO2dCQUNSLE1BQU0sRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXO2FBQ3JFO1NBQ0YsQ0FBQztJQUNKLENBQUM7O0FBM2JILHNCQXNnQkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBBcm4sIEFybkZvcm1hdCwgRHVyYXRpb24sIElSZXNvdXJjZSwgTGF6eSwgUmVzb3VyY2UsIFN0YWNrLCBBd3MgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBiZWRyb2NrIGZyb20gJ2F3cy1jZGstbGliL2F3cy1iZWRyb2NrJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIGttcyBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuLy8gSW50ZXJuYWwgTGlic1xuaW1wb3J0IHsgQWdlbnRBY3Rpb25Hcm91cCB9IGZyb20gJy4vYWN0aW9uLWdyb3VwJztcbmltcG9ydCB7IEFnZW50QWxpYXMsIElBZ2VudEFsaWFzIH0gZnJvbSAnLi9hZ2VudC1hbGlhcyc7XG5pbXBvcnQgeyBBZ2VudENvbGxhYm9yYXRvciwgQWdlbnRDb2xsYWJvcmF0b3JUeXBlIH0gZnJvbSAnLi9hZ2VudC1jb2xsYWJvcmF0b3InO1xuaW1wb3J0IHsgUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uIH0gZnJvbSAnLi9wcm9tcHQtb3ZlcnJpZGUnO1xuaW1wb3J0IHsgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMiB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcbmltcG9ydCAqIGFzIHZhbGlkYXRpb24gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdmFsaWRhdGlvbi1oZWxwZXJzJztcbmltcG9ydCB7IElHdWFyZHJhaWwgfSBmcm9tICcuLi9ndWFyZHJhaWxzL2d1YXJkcmFpbHMnO1xuaW1wb3J0IHsgSUtub3dsZWRnZUJhc2UgfSBmcm9tICcuLi9rbm93bGVkZ2UtYmFzZXMva25vd2xlZGdlLWJhc2UnO1xuaW1wb3J0IHsgSUludm9rYWJsZSB9IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBNZW1vcnkgfSBmcm9tICcuL21lbW9yeSc7XG5pbXBvcnQgeyBPcmNoZXN0cmF0aW9uVHlwZSwgQ3VzdG9tT3JjaGVzdHJhdGlvbiB9IGZyb20gJy4vb3JjaGVzdHJhdGlvbic7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ09NTU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFJlcHJlc2VudHMgYW4gQWdlbnQsIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgSUFnZW50IGV4dGVuZHMgSVJlc291cmNlIHtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGFnZW50LlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSBhZ2VudEFybjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBBZ2VudC5cbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIElBTSByb2xlIGFzc29jaWF0ZWQgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcmVhZG9ubHkgcm9sZTogaWFtLklSb2xlO1xuICAvKipcbiAgICogT3B0aW9uYWwgS01TIGVuY3J5cHRpb24ga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGFnZW50XG4gICAqL1xuICByZWFkb25seSBrbXNLZXk/OiBrbXMuSUtleTtcbiAgLyoqXG4gICAqIFdoZW4gdGhpcyBhZ2VudCB3YXMgbGFzdCB1cGRhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgbGFzdFVwZGF0ZWQ/OiBzdHJpbmc7XG59XG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIEFCU1RSQUNUIEJBU0UgQ0xBU1NcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQWJzdHJhY3QgYmFzZSBjbGFzcyBmb3IgYW4gQWdlbnQuXG4gKiBDb250YWlucyBtZXRob2RzIGFuZCBhdHRyaWJ1dGVzIHZhbGlkIGZvciBBZ2VudHMgZWl0aGVyIGNyZWF0ZWQgd2l0aCBDREsgb3IgaW1wb3J0ZWQuXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBZ2VudEJhc2UgZXh0ZW5kcyBSZXNvdXJjZSBpbXBsZW1lbnRzIElBZ2VudCB7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBhZ2VudEFybjogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgYWdlbnRJZDogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgcm9sZTogaWFtLklSb2xlO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBsYXN0VXBkYXRlZD86IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IGFnZW50VmVyc2lvbjogc3RyaW5nO1xufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIFBST1BTIEZPUiBORVcgQ09OU1RSVUNUXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGNyZWF0aW5nIGEgQ0RLIG1hbmFnZWQgQmVkcm9jayBBZ2VudC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBZ2VudFByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBIG5hbWUgaXMgZ2VuZXJhdGVkIGJ5IENESy5cbiAgICovXG4gIHJlYWRvbmx5IG5hbWU/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgaW5zdHJ1Y3Rpb24gdXNlZCBieSB0aGUgYWdlbnQuIFRoaXMgZGV0ZXJtaW5lcyBob3cgdGhlIGFnZW50IHdpbGwgcGVyZm9ybSBoaXMgdGFzay5cbiAgICogVGhpcyBpbnN0cnVjdGlvbiBtdXN0IGhhdmUgYSBtaW5pbXVtIG9mIDQwIGNoYXJhY3RlcnMuXG4gICAqL1xuICByZWFkb25seSBpbnN0cnVjdGlvbjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGZvdW5kYXRpb24gbW9kZWwgdXNlZCBmb3Igb3JjaGVzdHJhdGlvbiBieSB0aGUgYWdlbnQuXG4gICAqL1xuICByZWFkb25seSBmb3VuZGF0aW9uTW9kZWw6IElJbnZva2FibGU7XG4gIC8qKlxuICAgKiBUaGUgZXhpc3RpbmcgSUFNIFJvbGUgZm9yIHRoZSBhZ2VudCB0byB1c2UuXG4gICAqIEVuc3VyZSB0aGUgcm9sZSBoYXMgYSB0cnVzdCBwb2xpY3kgdGhhdCBhbGxvd3MgdGhlIEJlZHJvY2sgc2VydmljZSB0byBhc3N1bWUgdGhlIHJvbGUuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuZXcgcm9sZSBpcyBjcmVhdGVkIGZvciB5b3UuXG4gICAqL1xuICByZWFkb25seSBleGlzdGluZ1JvbGU/OiBpYW0uSVJvbGU7XG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0byBhdXRvbWF0aWNhbGx5IHVwZGF0ZSB0aGUgYERSQUZUYCB2ZXJzaW9uIG9mIHRoZSBhZ2VudCBhZnRlclxuICAgKiBtYWtpbmcgY2hhbmdlcyB0byB0aGUgYWdlbnQuIFRoZSBgRFJBRlRgIHZlcnNpb24gY2FuIGJlIGNvbnRpbnVhbGx5IGl0ZXJhdGVkXG4gICAqIHVwb24gZHVyaW5nIGludGVybmFsIGRldmVsb3BtZW50LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSBzaG91bGRQcmVwYXJlQWdlbnQ/OiBib29sZWFuO1xuICAvKipcbiAgICogSG93IGxvbmcgc2Vzc2lvbnMgc2hvdWxkIGJlIGtlcHQgb3BlbiBmb3IgdGhlIGFnZW50LiBJZiBubyBjb252ZXJzYXRpb24gb2NjdXJzXG4gICAqIGR1cmluZyB0aGlzIHRpbWUsIHRoZSBzZXNzaW9uIGV4cGlyZXMgYW5kIEFtYXpvbiBCZWRyb2NrIGRlbGV0ZXMgYW55IGRhdGFcbiAgICogcHJvdmlkZWQgYmVmb3JlIHRoZSB0aW1lb3V0LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIDEgaG91clxuICAgKi9cbiAgcmVhZG9ubHkgaWRsZVNlc3Npb25UVEw/OiBEdXJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSBLTVMga2V5IG9mIHRoZSBhZ2VudCBpZiBjdXN0b20gZW5jcnlwdGlvbiBpcyBjb25maWd1cmVkLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEFuIEFXUyBtYW5hZ2VkIGtleSBpcyB1c2VkLlxuICAgKi9cbiAgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG4gIC8qKlxuICAgKiBBIGRlc2NyaXB0aW9uIG9mIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBkZXNjcmlwdGlvbiBpcyBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEtub3dsZWRnZUJhc2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWdlbnQuXG4gICAqL1xuICByZWFkb25seSBrbm93bGVkZ2VCYXNlcz86IElLbm93bGVkZ2VCYXNlW107XG4gIC8qKlxuICAgKiBUaGUgQWN0aW9uIEdyb3VwcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFnZW50LlxuICAgKi9cbiAgcmVhZG9ubHkgYWN0aW9uR3JvdXBzPzogQWdlbnRBY3Rpb25Hcm91cFtdO1xuICAvKipcbiAgICogVGhlIGd1YXJkcmFpbCB0aGF0IHdpbGwgYmUgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICovXG4gIHJlYWRvbmx5IGd1YXJkcmFpbD86IElHdWFyZHJhaWw7XG4gIC8qKlxuICAgKiBPdmVycmlkZXMgc29tZSBwcm9tcHQgdGVtcGxhdGVzIGluIGRpZmZlcmVudCBwYXJ0cyBvZiBhbiBhZ2VudCBzZXF1ZW5jZSBjb25maWd1cmF0aW9uLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIG92ZXJyaWRlcyBhcmUgcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24/OiBQcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb247XG4gIC8qKlxuICAgKiBTZWxlY3Qgd2hldGhlciB0aGUgYWdlbnQgY2FuIHByb21wdCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGZyb20gdGhlIHVzZXIgd2hlbiBpdCBkb2VzIG5vdCBoYXZlXG4gICAqIGVub3VnaCBpbmZvcm1hdGlvbiB0byByZXNwb25kIHRvIGFuIHV0dGVyYW5jZVxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSB1c2VySW5wdXRFbmFibGVkPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFNlbGVjdCB3aGV0aGVyIHRoZSBhZ2VudCBjYW4gZ2VuZXJhdGUsIHJ1biwgYW5kIHRyb3VibGVzaG9vdCBjb2RlIHdoZW4gdHJ5aW5nIHRvIGNvbXBsZXRlIGEgdGFza1xuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSBjb2RlSW50ZXJwcmV0ZXJFbmFibGVkPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gZGVsZXRlIHRoZSByZXNvdXJjZSBldmVuIGlmIGl0J3MgaW4gdXNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHRydWVcbiAgICovXG4gIHJlYWRvbmx5IGZvcmNlRGVsZXRlPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFRoZSB0eXBlIGFuZCBjb25maWd1cmF0aW9uIG9mIHRoZSBtZW1vcnkgdG8gbWFpbnRhaW4gY29udGV4dCBhY3Jvc3MgbXVsdGlwbGUgc2Vzc2lvbnMgYW5kIHJlY2FsbCBwYXN0IGludGVyYWN0aW9ucy5cbiAgICogVGhpcyBjYW4gYmUgdXNlZnVsIGZvciBtYWludGFpbmluZyBjb250aW51aXR5IGluIG11bHRpLXR1cm4gY29udmVyc2F0aW9ucyBhbmQgcmVjYWxsaW5nIHVzZXIgcHJlZmVyZW5jZXNcbiAgICogb3IgcGFzdCBpbnRlcmFjdGlvbnMuXG4gICAqXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2JlZHJvY2svbGF0ZXN0L3VzZXJndWlkZS9hZ2VudHMtbWVtb3J5Lmh0bWxcbiAgICogQGRlZmF1bHQgLSBObyBtZW1vcnkgd2lsbCBiZSB1c2VkLiBBZ2VudHMgd2lsbCByZXRhaW4gY29udGV4dCBmcm9tIHRoZSBjdXJyZW50IHNlc3Npb24gb25seS5cbiAgICovXG4gIHJlYWRvbmx5IG1lbW9yeT86IE1lbW9yeTtcbiAgLyoqXG4gICAqIFRoZSBjb2xsYWJvcmF0aW9uIHR5cGUgZm9yIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBjb2xsYWJvcmF0aW9uIChBZ2VudENvbGxhYm9yYXRvclR5cGUuRElTQUJMRUQpLlxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRDb2xsYWJvcmF0aW9uPzogQWdlbnRDb2xsYWJvcmF0b3JUeXBlO1xuICAvKipcbiAgICogQ29sbGFib3JhdG9ycyB0aGF0IHRoaXMgYWdlbnQgd2lsbCB3b3JrIHdpdGguXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gY29sbGFib3JhdG9ycy5cbiAgICovXG4gIHJlYWRvbmx5IGFnZW50Q29sbGFib3JhdG9ycz86IEFnZW50Q29sbGFib3JhdG9yW107XG4gIC8qKlxuICAgKiBEZXRhaWxzIG9mIGN1c3RvbSBvcmNoZXN0cmF0aW9uIGZvciB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gU3RhbmRhcmQgb3JjaGVzdHJhdGlvbi5cbiAgICovXG4gIHJlYWRvbmx5IGN1c3RvbU9yY2hlc3RyYXRpb24/OiBDdXN0b21PcmNoZXN0cmF0aW9uO1xuICAvKipcbiAgICogVGhlIHR5cGUgb2Ygb3JjaGVzdHJhdGlvbiB0byB1c2UgZm9yIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBTVEFOREFSRFxuICAgKi9cbiAgcmVhZG9ubHkgb3JjaGVzdHJhdGlvblR5cGU/OiBPcmNoZXN0cmF0aW9uVHlwZTtcbn1cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgIEFUVFJTIEZPUiBJTVBPUlRFRCBDT05TVFJVQ1RcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQXR0cmlidXRlcyBmb3Igc3BlY2lmeWluZyBhbiBpbXBvcnRlZCBCZWRyb2NrIEFnZW50LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50QXR0cmlidXRlcyB7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBhZ2VudC5cbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIElBTSByb2xlIGFzc29jaWF0ZWQgdG8gdGhlIGFnZW50LlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSByb2xlQXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPcHRpb25hbCBLTVMgZW5jcnlwdGlvbiBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoaXMgYWdlbnRcbiAgICovXG4gIHJlYWRvbmx5IGttc0tleUFybj86IHN0cmluZztcbiAgLyoqXG4gICAqIFdoZW4gdGhpcyBhZ2VudCB3YXMgbGFzdCB1cGRhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgbGFzdFVwZGF0ZWQ/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgYWdlbnQgdmVyc2lvbi4gSWYgbm8gZXhwbGljaXQgdmVyc2lvbnMgaGF2ZSBiZWVuIGNyZWF0ZWQsXG4gICAqIGxlYXZlIHRoaXMgIGVtcHR5IHRvIHVzZSB0aGUgRFJBRlQgdmVyc2lvbi4gT3RoZXJ3aXNlLCB1c2UgdGhlXG4gICAqIHZlcnNpb24gbnVtYmVyIChlLmcuIDEpLlxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRWZXJzaW9uPzogc3RyaW5nO1xufVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICBORVcgQ09OU1RSVUNUIERFRklOSVRJT05cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQ2xhc3MgdG8gY3JlYXRlIChvciBpbXBvcnQpIGFuIEFnZW50IHdpdGggQ0RLLlxuICogQGNsb3VkZm9ybWF0aW9uUmVzb3VyY2UgQVdTOjpCZWRyb2NrOjpBZ2VudFxuICovXG5leHBvcnQgY2xhc3MgQWdlbnQgZXh0ZW5kcyBBZ2VudEJhc2Uge1xuICAvKipcbiAgICogU3RhdGljIE1ldGhvZCBmb3IgaW1wb3J0aW5nIGFuIGV4aXN0aW5nIEJlZHJvY2sgQWdlbnQuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZyb21BZ2VudEF0dHJzKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIGF0dHJzOiBBZ2VudEF0dHJpYnV0ZXMpOiBJQWdlbnQge1xuICAgIGNsYXNzIEltcG9ydCBleHRlbmRzIEFnZW50QmFzZSB7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRBcm4gPSBhdHRycy5hZ2VudEFybjtcbiAgICAgIHB1YmxpYyByZWFkb25seSBhZ2VudElkID0gQXJuLnNwbGl0KGF0dHJzLmFnZW50QXJuLCBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSkucmVzb3VyY2VOYW1lITtcbiAgICAgIHB1YmxpYyByZWFkb25seSByb2xlID0gaWFtLlJvbGUuZnJvbVJvbGVBcm4oc2NvcGUsIGAke2lkfVJvbGVgLCBhdHRycy5yb2xlQXJuKTtcbiAgICAgIHB1YmxpYyByZWFkb25seSBrbXNLZXkgPSBhdHRycy5rbXNLZXlBcm4gPyBrbXMuS2V5LmZyb21LZXlBcm4oc2NvcGUsIGAke2lkfUtleWAsIGF0dHJzLmttc0tleUFybikgOiB1bmRlZmluZWQ7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgbGFzdFVwZGF0ZWQgPSBhdHRycy5sYXN0VXBkYXRlZDtcbiAgICAgIHB1YmxpYyByZWFkb25seSBhZ2VudFZlcnNpb24gPSBhdHRycy5hZ2VudFZlcnNpb24gPz8gJ0RSQUZUJztcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gbmV3IEFnZW50XG4gICAgcmV0dXJuIG5ldyBJbXBvcnQoc2NvcGUsIGlkKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQmFzZSBhdHRyaWJ1dGVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgYWdlbnRcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBhZ2VudElkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBhZ2VudEFybjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHZlcnNpb24gb2YgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFnZW50VmVyc2lvbjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIElBTSByb2xlIGFzc29jaWF0ZWQgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHJvbGU6IGlhbS5JUm9sZTtcbiAgLyoqXG4gICAqIE9wdGlvbmFsIEtNUyBlbmNyeXB0aW9uIGtleSBhc3NvY2lhdGVkIHdpdGggdGhpcyBhZ2VudFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGttc0tleT86IGttcy5JS2V5O1xuICAvKipcbiAgICogV2hlbiB0aGlzIGFnZW50IHdhcyBsYXN0IHVwZGF0ZWQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgbGFzdFVwZGF0ZWQ/OiBzdHJpbmc7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDREstb25seSBhdHRyaWJ1dGVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGFnZW50IHdpbGwgYXV0b21hdGljYWxseSB1cGRhdGUgdGhlIERSQUZUIHZlcnNpb24gb2YgdGhlIGFnZW50IGFmdGVyXG4gICAqIG1ha2luZyBjaGFuZ2VzIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBzaG91bGRQcmVwYXJlQWdlbnQ6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBIb3cgbG9uZyBzZXNzaW9ucyBzaG91bGQgYmUga2VwdCBvcGVuIGZvciB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgaWRsZVNlc3Npb25UVEw6IER1cmF0aW9uO1xuICAvKipcbiAgICogVGhlIGZvdW5kYXRpb24gbW9kZWwgdXNlZCBmb3Igb3JjaGVzdHJhdGlvbiBieSB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZm91bmRhdGlvbk1vZGVsOiBJSW52b2thYmxlO1xuICAvKipcbiAgICogVGhlIGRlZmF1bHQgdGVzdCBhbGlhcyBmb3IgdGhpcyBhZ2VudC4gVGhpcyBjb3JyZXNwb25kcyB0byB0aGUgdGVzdCBhbGlhc1xuICAgKiAoYFRTVEFMSUFTSURgKSB0aGF0IHBvaW50cyB0byB0aGUgd29ya2luZyAoYERSQUZUYCkgdmVyc2lvbi5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB0ZXN0QWxpYXM6IElBZ2VudEFsaWFzO1xuICAvKipcbiAgICogV2hldGhlciB0aGUgYWdlbnQgY2FuIHByb21wdCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGZyb20gdGhlIHVzZXIgd2hlbiBpdCBkb2VzIG5vdCBoYXZlXG4gICAqIGVub3VnaCBpbmZvcm1hdGlvbiB0byByZXNwb25kIHRvIGFuIHV0dGVyYW5jZVxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHVzZXJJbnB1dEVuYWJsZWQ6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBhZ2VudCBjYW4gZ2VuZXJhdGUsIHJ1biwgYW5kIHRyb3VibGVzaG9vdCBjb2RlIHdoZW4gdHJ5aW5nIHRvIGNvbXBsZXRlIGEgdGFzay5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjb2RlSW50ZXJwcmV0ZXJFbmFibGVkOiBib29sZWFuO1xuICAvKipcbiAgICogV2hldGhlciB0aGUgcmVzb3VyY2Ugd2lsbCBiZSBkZWxldGVkIGV2ZW4gaWYgaXQncyBpbiB1c2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZm9yY2VEZWxldGU6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBBZ2VudCBjb2xsYWJvcmF0aW9uIHR5cGUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRDb2xsYWJvcmF0aW9uPzogQWdlbnRDb2xsYWJvcmF0b3JUeXBlO1xuICAvKipcbiAgICogQWdlbnQgY29sbGFib3JhdG9ycy5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBhZ2VudENvbGxhYm9yYXRvcnM/OiBBZ2VudENvbGxhYm9yYXRvcltdO1xuICAvKipcbiAgICogQ3VzdG9tIG9yY2hlc3RyYXRpb24gY29uZmlndXJhdGlvbi5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjdXN0b21PcmNoZXN0cmF0aW9uPzogQ3VzdG9tT3JjaGVzdHJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIG9yY2hlc3RyYXRpb24gZm9yIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBvcmNoZXN0cmF0aW9uVHlwZT86IE9yY2hlc3RyYXRpb25UeXBlO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ0RLLW9ubHkgYXR0cmlidXRlcyAob3B0aW9uYWwpXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIGRlc2NyaXB0aW9uIGZvciB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgaW5zdHJ1Y3Rpb24gdXNlZCBieSB0aGUgYWdlbnQuIFRoaXMgZGV0ZXJtaW5lcyBob3cgdGhlIGFnZW50IHdpbGwgcGVyZm9ybSBoaXMgdGFzay5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBpbnN0cnVjdGlvbj86IHN0cmluZztcbiAgLyoqXG4gICAqIE92ZXJyaWRlcyBzb21lIHByb21wdCB0ZW1wbGF0ZXMgaW4gZGlmZmVyZW50IHBhcnRzIG9mIGFuIGFnZW50IHNlcXVlbmNlIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gb3ZlcnJpZGVzIGFyZSBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbj86IFByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSBtZW1vcnkgY29uZmlndXJhdGlvbiBmb3IgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG1lbW9yeT86IE1lbW9yeTtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIExhenkgQXR0cmlidXRlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBhY3Rpb24gZ3JvdXBzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgYWN0aW9uR3JvdXBzOiBBZ2VudEFjdGlvbkdyb3VwW107XG4gIC8qKlxuICAgKiBUaGUgS25vd2xlZGdlQmFzZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBrbm93bGVkZ2VCYXNlczogSUtub3dsZWRnZUJhc2VbXTtcbiAgLyoqXG4gICAqIFRoZSBndWFyZHJhaWwgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBndWFyZHJhaWw/OiBJR3VhcmRyYWlsO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSW50ZXJuYWwgT25seVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBMMSByZXByZXNlbnRhdGlvbiBvZiB0aGUgYWdlbnRcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX19yZXNvdXJjZTogYmVkcm9jay5DZm5BZ2VudDtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ09OU1RSVUNUT1JcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBBZ2VudFByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNldCBwcm9wZXJ0aWVzIGFuZCBkZWZhdWx0c1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMubmFtZSA9XG4gICAgICBwcm9wcy5uYW1lID8/IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ2JlZHJvY2stYWdlbnQnLCB7IG1heExlbmd0aDogNjQsIGxvd2VyOiB0cnVlLCBzZXBhcmF0b3I6ICctJyB9KTtcbiAgICB0aGlzLmlkbGVTZXNzaW9uVFRMID0gcHJvcHMuaWRsZVNlc3Npb25UVEwgPz8gRHVyYXRpb24uaG91cnMoMSk7XG4gICAgdGhpcy5zaG91bGRQcmVwYXJlQWdlbnQgPSBwcm9wcy5zaG91bGRQcmVwYXJlQWdlbnQgPz8gZmFsc2U7XG4gICAgdGhpcy51c2VySW5wdXRFbmFibGVkID0gcHJvcHMudXNlcklucHV0RW5hYmxlZCA/PyBmYWxzZTtcbiAgICB0aGlzLmNvZGVJbnRlcnByZXRlckVuYWJsZWQgPSBwcm9wcy5jb2RlSW50ZXJwcmV0ZXJFbmFibGVkID8/IGZhbHNlO1xuICAgIHRoaXMuZm91bmRhdGlvbk1vZGVsID0gcHJvcHMuZm91bmRhdGlvbk1vZGVsO1xuICAgIHRoaXMuZm9yY2VEZWxldGUgPSBwcm9wcy5mb3JjZURlbGV0ZSA/PyBmYWxzZTtcblxuICAgIC8vIE9wdGlvbmFsXG4gICAgdGhpcy5kZXNjcmlwdGlvbiA9IHByb3BzLmRlc2NyaXB0aW9uO1xuICAgIHRoaXMuaW5zdHJ1Y3Rpb24gPSBwcm9wcy5pbnN0cnVjdGlvbjtcbiAgICB0aGlzLnByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbiA9IHByb3BzLnByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbjtcbiAgICB0aGlzLmttc0tleSA9IHByb3BzLmttc0tleTtcbiAgICB0aGlzLm1lbW9yeSA9IHByb3BzLm1lbW9yeTtcbiAgICB0aGlzLmFnZW50Q29sbGFib3JhdGlvbiA9IHByb3BzLmFnZW50Q29sbGFib3JhdGlvbjtcbiAgICB0aGlzLmN1c3RvbU9yY2hlc3RyYXRpb24gPSBwcm9wcy5jdXN0b21PcmNoZXN0cmF0aW9uO1xuICAgIHRoaXMub3JjaGVzdHJhdGlvblR5cGUgPSBwcm9wcy5vcmNoZXN0cmF0aW9uVHlwZTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFJvbGVcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBJZiBleGlzdGluZyByb2xlIGlzIHByb3ZpZGVkLCB1c2UgaXQuXG4gICAgaWYgKHByb3BzLmV4aXN0aW5nUm9sZSkge1xuICAgICAgdGhpcy5yb2xlID0gcHJvcHMuZXhpc3RpbmdSb2xlO1xuICAgICAgLy8gT3RoZXJ3aXNlLCBjcmVhdGUgYSBuZXcgb25lXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAnUm9sZScsIHtcbiAgICAgICAgLy8gZ2VuZXJhdGUgYSByb2xlIG5hbWVcbiAgICAgICAgcm9sZU5hbWU6IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ0FtYXpvbkJlZHJvY2tFeGVjdXRpb25Sb2xlRm9yQWdlbnRzXycsIHsgbWF4TGVuZ3RoOiA2NCwgbG93ZXI6IGZhbHNlIH0pLFxuICAgICAgICAvLyBlbnN1cmUgdGhlIHJvbGUgaGFzIGEgdHJ1c3QgcG9saWN5IHRoYXQgYWxsb3dzIHRoZSBCZWRyb2NrIHNlcnZpY2UgdG8gYXNzdW1lIHRoZSByb2xlXG4gICAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdiZWRyb2NrLmFtYXpvbmF3cy5jb20nKS53aXRoQ29uZGl0aW9ucyh7XG4gICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAnYXdzOlNvdXJjZUFjY291bnQnOiBTdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgQXJuTGlrZToge1xuICAgICAgICAgICAgJ2F3czpTb3VyY2VBcm4nOiBTdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgIHJlc291cmNlOiAnYWdlbnQnLFxuICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcqJyxcbiAgICAgICAgICAgICAgYXJuRm9ybWF0OiBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNldCBMYXp5IFByb3BzIGluaXRpYWwgdmFsdWVzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlcyA9IFtdO1xuICAgIHRoaXMuYWN0aW9uR3JvdXBzID0gW107XG4gICAgdGhpcy5hZ2VudENvbGxhYm9yYXRvcnMgPSBbXTtcbiAgICAvLyBBZGQgRGVmYXVsdCBBY3Rpb24gR3JvdXBzXG4gICAgdGhpcy5hZGRBY3Rpb25Hcm91cChBZ2VudEFjdGlvbkdyb3VwLnVzZXJJbnB1dCh0aGlzLnVzZXJJbnB1dEVuYWJsZWQpKTtcbiAgICB0aGlzLmFkZEFjdGlvbkdyb3VwKEFnZW50QWN0aW9uR3JvdXAuY29kZUludGVycHJldGVyKHRoaXMuY29kZUludGVycHJldGVyRW5hYmxlZCkpO1xuXG4gICAgLy8gQWRkIHNwZWNpZmllZCBlbGVtcyB0aHJvdWdoIG1ldGhvZHMgdG8gaGFuZGxlIHBlcm1pc3Npb25zXG4gICAgLy8gdGhpcyBuZWVkcyB0byBoYXBwZW4gYWZ0ZXIgcm9sZSBjcmVhdGlvbiAvIGFzc2lnbm1lbnRcbiAgICBwcm9wcy5rbm93bGVkZ2VCYXNlcz8uZm9yRWFjaChrYiA9PiB7XG4gICAgICB0aGlzLmFkZEtub3dsZWRnZUJhc2Uoa2IpO1xuICAgIH0pO1xuICAgIHByb3BzLmFjdGlvbkdyb3Vwcz8uZm9yRWFjaChhZyA9PiB7XG4gICAgICB0aGlzLmFkZEFjdGlvbkdyb3VwKGFnKTtcbiAgICB9KTtcbiAgICBwcm9wcy5hZ2VudENvbGxhYm9yYXRvcnM/LmZvckVhY2goYWMgPT4ge1xuICAgICAgdGhpcy5hZGRBZ2VudENvbGxhYm9yYXRvcihhYyk7XG4gICAgfSk7XG4gICAgaWYgKHByb3BzLmd1YXJkcmFpbCkge1xuICAgICAgdGhpcy5hZGRHdWFyZHJhaWwocHJvcHMuZ3VhcmRyYWlsKTtcbiAgICB9XG5cbiAgICAvLyBHcmFudCBwZXJtaXNzaW9ucyBmb3IgY3VzdG9tIG9yY2hlc3RyYXRpb24gaWYgcHJvdmlkZWRcbiAgICBpZiAodGhpcy5jdXN0b21PcmNoZXN0cmF0aW9uPy5leGVjdXRvcj8ubGFtYmRhRnVuY3Rpb24pIHtcbiAgICAgIHRoaXMuY3VzdG9tT3JjaGVzdHJhdGlvbi5leGVjdXRvci5sYW1iZGFGdW5jdGlvbi5ncmFudEludm9rZSh0aGlzLnJvbGUpO1xuICAgICAgdGhpcy5jdXN0b21PcmNoZXN0cmF0aW9uLmV4ZWN1dG9yLmxhbWJkYUZ1bmN0aW9uLmFkZFBlcm1pc3Npb24oYE9yY2hlc3RyYXRpb25MYW1iZGFJbnZvY2F0aW9uUG9saWN5LSR7dGhpcy5ub2RlLmFkZHIuc2xpY2UoMCwgMTYpfWAsIHtcbiAgICAgICAgcHJpbmNpcGFsOiBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2JlZHJvY2suYW1hem9uYXdzLmNvbScpLFxuICAgICAgICBzb3VyY2VBcm46IExhenkuc3RyaW5nKHsgcHJvZHVjZTogKCkgPT4gdGhpcy5hZ2VudEFybiB9KSxcbiAgICAgICAgc291cmNlQWNjb3VudDogU3RhY2sub2YodGhpcykuYWNjb3VudCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNldCBMYXp5IFZhbGlkYXRpb25zXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5ub2RlLmFkZFZhbGlkYXRpb24oe1xuICAgICAgdmFsaWRhdGU6ICgpID0+IHRoaXMudmFsaWRhdGVLbm93bGVkZ2VCYXNlQXNzb2NhdGlvbnMoKSxcbiAgICB9KTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIENGTiBQcm9wcyAtIFdpdGggTGF6eSBzdXBwb3J0XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29uc3QgY2ZuUHJvcHM6IGJlZHJvY2suQ2ZuQWdlbnRQcm9wcyA9IHtcbiAgICAgIGFjdGlvbkdyb3VwczogTGF6eS5hbnkoeyBwcm9kdWNlOiAoKSA9PiB0aGlzLnJlbmRlckFjdGlvbkdyb3VwcygpIH0sIHsgb21pdEVtcHR5QXJyYXk6IHRydWUgfSksXG4gICAgICBhZ2VudE5hbWU6IHRoaXMubmFtZSxcbiAgICAgIGFnZW50UmVzb3VyY2VSb2xlQXJuOiB0aGlzLnJvbGUucm9sZUFybixcbiAgICAgIGF1dG9QcmVwYXJlOiB0aGlzLnNob3VsZFByZXBhcmVBZ2VudCxcbiAgICAgIGN1c3RvbWVyRW5jcnlwdGlvbktleUFybjogcHJvcHMua21zS2V5Py5rZXlBcm4sXG4gICAgICBkZXNjcmlwdGlvbjogcHJvcHMuZGVzY3JpcHRpb24sXG4gICAgICBmb3VuZGF0aW9uTW9kZWw6IHRoaXMuZm91bmRhdGlvbk1vZGVsLmludm9rYWJsZUFybixcbiAgICAgIGd1YXJkcmFpbENvbmZpZ3VyYXRpb246IExhenkuYW55KHsgcHJvZHVjZTogKCkgPT4gdGhpcy5yZW5kZXJHdWFyZHJhaWwoKSB9KSxcbiAgICAgIGlkbGVTZXNzaW9uVHRsSW5TZWNvbmRzOiB0aGlzLmlkbGVTZXNzaW9uVFRMLnRvU2Vjb25kcygpLFxuICAgICAgaW5zdHJ1Y3Rpb246IHByb3BzLmluc3RydWN0aW9uLFxuICAgICAga25vd2xlZGdlQmFzZXM6IExhenkuYW55KHsgcHJvZHVjZTogKCkgPT4gdGhpcy5yZW5kZXJLbm93bGVkZ2VCYXNlcygpIH0sIHsgb21pdEVtcHR5QXJyYXk6IHRydWUgfSksXG4gICAgICBtZW1vcnlDb25maWd1cmF0aW9uOiBwcm9wcy5tZW1vcnksXG4gICAgICBwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb246IHRoaXMucHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uPy5fcmVuZGVyKCksXG4gICAgICBza2lwUmVzb3VyY2VJblVzZUNoZWNrT25EZWxldGU6IHRoaXMuZm9yY2VEZWxldGUsXG4gICAgICBhZ2VudENvbGxhYm9yYXRpb246IHRoaXMuYWdlbnRDb2xsYWJvcmF0aW9uLFxuICAgICAgYWdlbnRDb2xsYWJvcmF0b3JzOiBMYXp5LmFueSh7IHByb2R1Y2U6ICgpID0+IHRoaXMucmVuZGVyQWdlbnRDb2xsYWJvcmF0b3JzKCkgfSwgeyBvbWl0RW1wdHlBcnJheTogdHJ1ZSB9KSxcbiAgICAgIGN1c3RvbU9yY2hlc3RyYXRpb246IHRoaXMucmVuZGVyQ3VzdG9tT3JjaGVzdHJhdGlvbigpLFxuICAgICAgb3JjaGVzdHJhdGlvblR5cGU6IHRoaXMub3JjaGVzdHJhdGlvblR5cGUsXG4gICAgfTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEwxIEluc3RhbnRpYXRpb25cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLl9fcmVzb3VyY2UgPSBuZXcgYmVkcm9jay5DZm5BZ2VudCh0aGlzLCAnQWdlbnRSZXNvdXJjZScsIGNmblByb3BzKTtcblxuICAgIHRoaXMuYWdlbnRJZCA9IHRoaXMuX19yZXNvdXJjZS5hdHRyQWdlbnRJZDtcbiAgICB0aGlzLmFnZW50QXJuID0gdGhpcy5fX3Jlc291cmNlLmF0dHJBZ2VudEFybjtcbiAgICB0aGlzLmFnZW50VmVyc2lvbiA9IHRoaXMuX19yZXNvdXJjZS5hdHRyQWdlbnRWZXJzaW9uO1xuICAgIHRoaXMubGFzdFVwZGF0ZWQgPSB0aGlzLl9fcmVzb3VyY2UuYXR0clVwZGF0ZWRBdDtcblxuICAgIC8vIEFkZCBleHBsaWNpdCBkZXBlbmRlbmN5IGJldHdlZW4gdGhlIGFnZW50IHJlc291cmNlIGFuZCB0aGUgYWdlbnQncyByb2xlIGRlZmF1bHQgcG9saWN5XG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hd3NsYWJzL2dlbmVyYXRpdmUtYWktY2RrLWNvbnN0cnVjdHMvaXNzdWVzLzg5OVxuICAgIGlmICghcHJvcHMuZXhpc3RpbmdSb2xlKSB7XG4gICAgICAvLyBhZGQgdGhlIGFwcHJvcHJpYXRlIHBlcm1pc3Npb25zIHRvIHVzZSB0aGUgRk1cbiAgICAgIGNvbnN0IGdyYW50ID0gdGhpcy5mb3VuZGF0aW9uTW9kZWwuZ3JhbnRJbnZva2UodGhpcy5yb2xlKTtcbiAgICAgIGdyYW50LmFwcGx5QmVmb3JlKHRoaXMuX19yZXNvdXJjZSk7XG4gICAgfVxuXG4gICAgdGhpcy50ZXN0QWxpYXMgPSBBZ2VudEFsaWFzLmZyb21BdHRyaWJ1dGVzKHRoaXMsICdEZWZhdWx0QWxpYXMnLCB7XG4gICAgICBhbGlhc0lkOiAnVFNUQUxJQVNJRCcsXG4gICAgICBhbGlhc05hbWU6ICdBZ2VudFRlc3RBbGlhcycsXG4gICAgICBhZ2VudFZlcnNpb246ICdEUkFGVCcsXG4gICAgICBhZ2VudDogdGhpcyxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBIRUxQRVIgTUVUSE9EUyAtIGFkZFgoKVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIEFkZCBrbm93bGVkZ2UgYmFzZSB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgYWRkS25vd2xlZGdlQmFzZShrbm93bGVkZ2VCYXNlOiBJS25vd2xlZGdlQmFzZSkge1xuICAgIC8vIERvIHNvbWUgY2hlY2tzXG4gICAgdmFsaWRhdGlvbi50aHJvd0lmSW52YWxpZCh0aGlzLnZhbGlkYXRlS25vd2xlZGdlQmFzZSwga25vd2xlZGdlQmFzZSk7XG4gICAgLy8gQWRkIGl0IHRvIHRoZSBhcnJheVxuICAgIHRoaXMua25vd2xlZGdlQmFzZXMucHVzaChrbm93bGVkZ2VCYXNlKTtcbiAgICAvLyBBZGQgdGhlIGFwcHJvcHJpYXRlIFBlcm1pc3Npb25zIHRvIHF1ZXJ5IHRoZSBLbm93bGVkZ2UgQmFzZVxuICAgIGtub3dsZWRnZUJhc2UuZ3JhbnRRdWVyeSh0aGlzLnJvbGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBndWFyZHJhaWwgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEd1YXJkcmFpbChndWFyZHJhaWw6IElHdWFyZHJhaWwpIHtcbiAgICAvLyBEbyBzb21lIGNoZWNrc1xuICAgIHZhbGlkYXRpb24udGhyb3dJZkludmFsaWQodGhpcy52YWxpZGF0ZUd1YXJkcmFpbCwgZ3VhcmRyYWlsKTtcbiAgICAvLyBBZGQgaXQgdG8gdGhlIGNvbnN0cnVjdFxuICAgIHRoaXMuZ3VhcmRyYWlsID0gZ3VhcmRyYWlsO1xuICAgIC8vIEhhbmRsZSBwZXJtaXNzaW9uc1xuICAgIGd1YXJkcmFpbC5ncmFudEFwcGx5KHRoaXMucm9sZSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGFuIGFjdGlvbiBncm91cCB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgYWRkQWN0aW9uR3JvdXAoYWN0aW9uR3JvdXA6IEFnZW50QWN0aW9uR3JvdXApIHtcbiAgICAvLyBEbyBzb21lIGNoZWNrc1xuICAgIHZhbGlkYXRpb24udGhyb3dJZkludmFsaWQodGhpcy52YWxpZGF0ZUFjdGlvbkdyb3VwLCBhY3Rpb25Hcm91cCk7XG4gICAgLy8gQWRkIGl0IHRvIHRoZSBhcnJheVxuICAgIHRoaXMuYWN0aW9uR3JvdXBzLnB1c2goYWN0aW9uR3JvdXApO1xuICAgIC8vIEhhbmRsZSBwZXJtaXNzaW9ucyB0byBpbnZva2UgdGhlIGxhbWJkYSBmdW5jdGlvblxuICAgIGFjdGlvbkdyb3VwLmV4ZWN1dG9yPy5sYW1iZGFGdW5jdGlvbj8uZ3JhbnRJbnZva2UodGhpcy5yb2xlKTtcbiAgICBhY3Rpb25Hcm91cC5leGVjdXRvcj8ubGFtYmRhRnVuY3Rpb24/LmFkZFBlcm1pc3Npb24oYExhbWJkYUludm9jYXRpb25Qb2xpY3ktJHt0aGlzLm5vZGUuYWRkci5zbGljZSgwLCAxNil9YCwge1xuICAgICAgcHJpbmNpcGFsOiBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2JlZHJvY2suYW1hem9uYXdzLmNvbScpLFxuICAgICAgc291cmNlQXJuOiB0aGlzLmFnZW50QXJuLFxuICAgICAgc291cmNlQWNjb3VudDogU3RhY2sub2YodGhpcykuYWNjb3VudCxcbiAgICB9KTtcbiAgICAvLyBIYW5kbGUgcGVybWlzc2lvbnMgdG8gYWNjZXNzIHRoZSBzY2hlbWEgZmlsZSBmcm9tIFMzXG4gICAgaWYgKGFjdGlvbkdyb3VwLmFwaVNjaGVtYT8uczNGaWxlKSB7XG4gICAgICB0aGlzLnJvbGUuYWRkVG9QcmluY2lwYWxQb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBhY3Rpb25zOiBbJ3MzOkdldE9iamVjdCddLFxuICAgICAgICByZXNvdXJjZXM6IFtgYXJuOiR7QXdzLlBBUlRJVElPTn06czM6Ojoke2FjdGlvbkdyb3VwLmFwaVNjaGVtYS5zM0ZpbGUuYnVja2V0TmFtZX0vJHthY3Rpb25Hcm91cC5hcGlTY2hlbWEuczNGaWxlLm9iamVjdEtleX1gXSxcbiAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgIFN0cmluZ0VxdWFsczoge1xuICAgICAgICAgICAgJ2F3czpSZXNvdXJjZUFjY291bnQnOiBTdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBhZ2VudCBjb2xsYWJvcmF0b3IgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEFnZW50Q29sbGFib3JhdG9yKGFnZW50Q29sbGFib3JhdG9yOiBBZ2VudENvbGxhYm9yYXRvcikge1xuICAgIHRoaXMuYWdlbnRDb2xsYWJvcmF0b3JzPy5wdXNoKGFnZW50Q29sbGFib3JhdG9yKTtcbiAgICBhZ2VudENvbGxhYm9yYXRvci5ncmFudCh0aGlzLnJvbGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBtdWx0aXBsZSBhY3Rpb24gZ3JvdXBzIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRBY3Rpb25Hcm91cHMoLi4uYWN0aW9uR3JvdXBzOiBBZ2VudEFjdGlvbkdyb3VwW10pIHtcbiAgICBhY3Rpb25Hcm91cHMuZm9yRWFjaChhZyA9PiB0aGlzLmFkZEFjdGlvbkdyb3VwKGFnKSk7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gTGF6eSBSZW5kZXJlcnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBSZW5kZXIgdGhlIGd1YXJkcmFpbCBjb25maWd1cmF0aW9uLlxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgcmVuZGVyR3VhcmRyYWlsKCk6IGJlZHJvY2suQ2ZuQWdlbnQuR3VhcmRyYWlsQ29uZmlndXJhdGlvblByb3BlcnR5IHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5ndWFyZHJhaWxcbiAgICAgID8ge1xuICAgICAgICBndWFyZHJhaWxJZGVudGlmaWVyOiB0aGlzLmd1YXJkcmFpbC5ndWFyZHJhaWxJZCxcbiAgICAgICAgZ3VhcmRyYWlsVmVyc2lvbjogdGhpcy5ndWFyZHJhaWwuZ3VhcmRyYWlsVmVyc2lvbixcbiAgICAgIH1cbiAgICAgIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciB0aGUga25vd2xlZGdlIGJhc2UgYXNzb2NpYXRpb25zLlxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgcmVuZGVyS25vd2xlZGdlQmFzZXMoKTogYmVkcm9jay5DZm5BZ2VudC5BZ2VudEtub3dsZWRnZUJhc2VQcm9wZXJ0eVtdIHtcbiAgICBjb25zdCBrbm93bGVkZ2VCYXNlQXNzb2NpYXRpb25zQ2ZuOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5W10gPSBbXTtcbiAgICAvLyBCdWlsZCB0aGUgYXNzb2NpYXRpb25zIGluIHRoZSBDRk4gZm9ybWF0XG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlcy5mb3JFYWNoKGtiID0+IHtcbiAgICAgIGtub3dsZWRnZUJhc2VBc3NvY2lhdGlvbnNDZm4ucHVzaCh7XG4gICAgICAgIGtub3dsZWRnZUJhc2VJZDoga2Iua25vd2xlZGdlQmFzZUlkLFxuICAgICAgICBrbm93bGVkZ2VCYXNlU3RhdGU6ICdFTkFCTEVEJyxcbiAgICAgICAgLy8gYXQgbGVhc3Qgb25lIGlzIGRlZmluZWQgYXMgaXQgaGFzIGJlZW4gdmFsaWRhdGVkIHdoZW4gYWRkaW5nIHRoZSBrYlxuICAgICAgICBkZXNjcmlwdGlvbjoga2IuaW5zdHJ1Y3Rpb24gPz8ga2IuZGVzY3JpcHRpb24hLFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGtub3dsZWRnZUJhc2VBc3NvY2lhdGlvbnNDZm47XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSBhY3Rpb24gZ3JvdXBzXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSByZW5kZXJBY3Rpb25Hcm91cHMoKTogYmVkcm9jay5DZm5BZ2VudC5BZ2VudEFjdGlvbkdyb3VwUHJvcGVydHlbXSB7XG4gICAgY29uc3QgYWN0aW9uR3JvdXBzQ2ZuOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50QWN0aW9uR3JvdXBQcm9wZXJ0eVtdID0gW107XG4gICAgLy8gQnVpbGQgdGhlIGFzc29jaWF0aW9ucyBpbiB0aGUgQ0ZOIGZvcm1hdFxuICAgIHRoaXMuYWN0aW9uR3JvdXBzLmZvckVhY2goYWcgPT4ge1xuICAgICAgYWN0aW9uR3JvdXBzQ2ZuLnB1c2goYWcuX3JlbmRlcigpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gYWN0aW9uR3JvdXBzQ2ZuO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciB0aGUgYWdlbnQgY29sbGFib3JhdG9ycy5cbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIHJlbmRlckFnZW50Q29sbGFib3JhdG9ycygpOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50Q29sbGFib3JhdG9yUHJvcGVydHlbXSB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKCF0aGlzLmFnZW50Q29sbGFib3JhdG9ycyB8fCB0aGlzLmFnZW50Q29sbGFib3JhdG9ycy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3QgYWdlbnRDb2xsYWJvcmF0b3JzQ2ZuOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50Q29sbGFib3JhdG9yUHJvcGVydHlbXSA9IFtdO1xuXG4gICAgdGhpcy5hZ2VudENvbGxhYm9yYXRvcnMuZm9yRWFjaChhYyA9PiB7XG4gICAgICBhZ2VudENvbGxhYm9yYXRvcnNDZm4ucHVzaChhYy5fcmVuZGVyKCkpO1xuICAgIH0pO1xuICAgIHJldHVybiBhZ2VudENvbGxhYm9yYXRvcnNDZm47XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSBjdXN0b20gb3JjaGVzdHJhdGlvbi5cbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIHJlbmRlckN1c3RvbU9yY2hlc3RyYXRpb24oKTogYmVkcm9jay5DZm5BZ2VudC5DdXN0b21PcmNoZXN0cmF0aW9uUHJvcGVydHkgfCB1bmRlZmluZWQge1xuICAgIGlmICghdGhpcy5jdXN0b21PcmNoZXN0cmF0aW9uKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBleGVjdXRvcjoge1xuICAgICAgICBsYW1iZGE6IHRoaXMuY3VzdG9tT3JjaGVzdHJhdGlvbi5leGVjdXRvci5sYW1iZGFGdW5jdGlvbi5mdW5jdGlvbkFybixcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBWYWxpZGF0b3JzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogQ2hlY2tzIGlmIHRoZSBLQiBBc3NvY2lhdGlvbiBpcyB2YWxpZFxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVLbm93bGVkZ2VCYXNlID0gKGtub3dsZWRnZUJhc2U6IElLbm93bGVkZ2VCYXNlKTogc3RyaW5nW10gPT4ge1xuICAgIGNvbnN0IE1BWF9MRU5HVEggPSAyMDA7XG4gICAgY29uc3QgZGVzY3JpcHRpb24gPSBrbm93bGVkZ2VCYXNlLmluc3RydWN0aW9uID8/IGtub3dsZWRnZUJhc2UuZGVzY3JpcHRpb247XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIC8vIElmIGF0IGxlYXN0IG9uZSBvZiB0aGUgcHJldmlvdXMgaGFzIGJlZW4gZGVmaW5lZFxuICAgIGlmIChkZXNjcmlwdGlvbikge1xuICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgIC4uLnZhbGlkYXRpb24udmFsaWRhdGVTdHJpbmdGaWVsZExlbmd0aCh7XG4gICAgICAgICAgdmFsdWU6IGRlc2NyaXB0aW9uLFxuICAgICAgICAgIGZpZWxkTmFtZTogJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICBtaW5MZW5ndGg6IDAsXG4gICAgICAgICAgbWF4TGVuZ3RoOiBNQVhfTEVOR1RILFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVycm9ycy5wdXNoKFxuICAgICAgICAnSWYgaW5zdHJ1Y3Rpb25Gb3JBZ2VudHMgaXMgbm90IHByb3ZpZGVkLCB0aGUgZGVzY3JpcHRpb24gcHJvcGVydHkgb2YgdGhlIEtub3dsZWRnZUJhc2UgJyArXG4gICAgICAgICAgYCR7a25vd2xlZGdlQmFzZS5rbm93bGVkZ2VCYXNlSWR9IG11c3QgYmUgcHJvdmlkZWQuYCxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBlcnJvcnM7XG4gIH07XG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIEtCIEFzc29jaWF0aW9ucyBhcmUgdmFsaWRcbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlS25vd2xlZGdlQmFzZUFzc29jYXRpb25zID0gKCk6IHN0cmluZ1tdID0+IHtcbiAgICBjb25zdCBNQVhfS0JfQVNTT0NJQVRJT05TID0gMTA7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGlmICh0aGlzLmtub3dsZWRnZUJhc2VzLmxlbmd0aCA+IE1BWF9LQl9BU1NPQ0lBVElPTlMpIHtcbiAgICAgIGVycm9ycy5wdXNoKGBUaGUgbWF4aW11bSBudW1iZXIgb2Yga25vd2xlZGdlIGJhc2VzIGFzc29jaWF0aW9ucyBpcyAke01BWF9LQl9BU1NPQ0lBVElPTlN9LmApO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGtiIG9mIHRoaXMua25vd2xlZGdlQmFzZXMpIHtcbiAgICAgIHRoaXMudmFsaWRhdGVLbm93bGVkZ2VCYXNlKGtiKTtcbiAgICB9XG4gICAgcmV0dXJuIGVycm9ycztcbiAgfTtcbiAgLyoqXG4gICAqIENoZWNrcyBpZiB0aGUgR3VhcmRyYWlsIGlzIHZhbGlkXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZUd1YXJkcmFpbCA9IChndWFyZHJhaWw6IElHdWFyZHJhaWwpOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGlmICh0aGlzLmd1YXJkcmFpbCkge1xuICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgIGBDYW5ub3QgYWRkIEd1YXJkcmFpbCAke2d1YXJkcmFpbC5ndWFyZHJhaWxJZH0uIGAgK1xuICAgICAgICAgIGBHdWFyZHJhaWwgJHt0aGlzLmd1YXJkcmFpbC5ndWFyZHJhaWxJZH0gaGFzIGFscmVhZHkgYmVlbiBzcGVjaWZpZWQgZm9yIHRoaXMgYWdlbnQuYCxcbiAgICAgICk7XG4gICAgfVxuICAgIGVycm9ycy5wdXNoKC4uLnZhbGlkYXRpb24udmFsaWRhdGVGaWVsZFBhdHRlcm4oZ3VhcmRyYWlsLmd1YXJkcmFpbFZlcnNpb24sICd2ZXJzaW9uJywgL14oKFswLTldezEsOH0pfChEUkFGVCkpJC8pKTtcbiAgICByZXR1cm4gZXJyb3JzO1xuICB9O1xuICAvKipcbiAgICogQ2hlY2sgaWYgdGhlIGFjdGlvbiBncm91cCBpcyB2YWxpZFxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZUFjdGlvbkdyb3VwID0gKGFjdGlvbkdyb3VwOiBBZ2VudEFjdGlvbkdyb3VwKSA9PiB7XG4gICAgbGV0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICAvLyBGaW5kIGlmIHRoZXJlIGlzIGEgY29uZmxpY3RpbmcgYWN0aW9uIGdyb3VwIG5hbWVcbiAgICBpZiAodGhpcy5hY3Rpb25Hcm91cHM/LmZpbmQoYWcgPT4gYWcubmFtZSA9PT0gYWN0aW9uR3JvdXAubmFtZSkpIHtcbiAgICAgIGVycm9ycy5wdXNoKGBBbiBhY3Rpb24gZ3JvdXAgd2l0aCBuYW1lOiAke2FjdGlvbkdyb3VwLm5hbWV9IGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZGApO1xuICAgIH1cbiAgICByZXR1cm4gZXJyb3JzO1xuICB9O1xufVxuIl19