"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.VectorKnowledgeBase = exports.VectorKnowledgeBaseBase = exports.VectorStoreType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const iam = require("aws-cdk-lib/aws-iam");
const nag_suppressions_1 = require("cdk-nag/lib/nag-suppressions");
const knowledge_base_1 = require("./knowledge-base");
const utils_1 = require("../../../common/helpers/utils");
const amazonaurora_1 = require("../../amazonaurora");
const mongodb_atlas_1 = require("../../mongodb-atlas");
const opensearch_vectorindex_1 = require("../../opensearch-vectorindex");
const opensearchmanagedcluster_1 = require("../../opensearchmanagedcluster");
const opensearchserverless_1 = require("../../opensearchserverless");
const pinecone_1 = require("../../pinecone");
const confluence_data_source_1 = require("../data-sources/confluence-data-source");
const context_enrichment_1 = require("../data-sources/context-enrichment");
const custom_data_source_1 = require("../data-sources/custom-data-source");
const s3_data_source_1 = require("../data-sources/s3-data-source");
const salesforce_data_source_1 = require("../data-sources/salesforce-data-source");
const sharepoint_data_source_1 = require("../data-sources/sharepoint-data-source");
const web_crawler_data_source_1 = require("../data-sources/web-crawler-data-source");
const models_1 = require("../models");
/******************************************************************************
 *                                  ENUMS
 *****************************************************************************/
/**
 * Knowledge base can be backed by different vector databases.
 * This enum represents the different vector databases that can be used.
 *
 * `OPENSEARCH_SERVERLESS` is the default vector database.
 * `PINECONE` is the vector database for Pinecone.
 * `AMAZON_AURORA` is the vector database for Amazon Aurora PostgreSQL.
 */
var VectorStoreType;
(function (VectorStoreType) {
    /**
     * `OPENSEARCH_SERVERLESS` is the vector store for OpenSearch Serverless.
     */
    VectorStoreType["OPENSEARCH_SERVERLESS"] = "OPENSEARCH_SERVERLESS";
    /**
     * `OPENSEARCH_MANAGED_CLUSTER` is the vector store for OpenSearch Managed Cluster.
     */
    VectorStoreType["OPENSEARCH_MANAGED_CLUSTER"] = "OPENSEARCH_MANAGED_CLUSTER";
    /**
     * `PINECONE` is the vector store for Pinecone.
     */
    VectorStoreType["PINECONE"] = "PINECONE";
    /**
     * `RDS` is the vector store for Amazon Aurora.
     */
    VectorStoreType["AMAZON_AURORA"] = "RDS";
    /**
     * `MONGO_DB_ATLAS` is the vector store for MongoDB Atlas.
     */
    VectorStoreType["MONGO_DB_ATLAS"] = "MONGO_DB_ATLAS";
    /**
     * `NEPTUNE_ANALYTICS` is the vector store for Amazon Neptune Analytics.
     */
    VectorStoreType["NEPTUNE_ANALYTICS"] = "NEPTUNE_ANALYTICS";
})(VectorStoreType || (exports.VectorStoreType = VectorStoreType = {}));
/******************************************************************************
 *                              ABSTRACT CLASS
 *****************************************************************************/
/**
 * Abstract base class for Vector Knowledge Base.
 * Contains methods valid for KBs either created with CDK or imported.
 */
class VectorKnowledgeBaseBase extends knowledge_base_1.KnowledgeBaseBase {
    constructor(scope, id) {
        super(scope, id);
        this.type = knowledge_base_1.KnowledgeBaseType.VECTOR;
    }
    // ------------------------------------------------------
    // Helper methods to add Data Sources
    // ------------------------------------------------------
    /**
     * Adds an S3 data source to the knowledge base.
     */
    addS3DataSource(props) {
        // Validate context enrichment is only used with Neptune Analytics
        const isNeptuneKB = this.vectorStoreType === VectorStoreType.NEPTUNE_ANALYTICS;
        if (props.contextEnrichment && !isNeptuneKB) {
            throw new Error('Context enrichment is only supported for Neptune/GraphRAG KnowledgeBases');
        }
        // Set context enrichment - use provided value or default for Neptune
        let contextEnrichment = props.contextEnrichment;
        if (isNeptuneKB) {
            contextEnrichment =
                props.contextEnrichment ??
                    context_enrichment_1.ContextEnrichment.foundationModel({
                        enrichmentModel: models_1.BedrockFoundationModel.ANTHROPIC_CLAUDE_HAIKU_V1_0,
                    });
        }
        // Create and return the S3 data source
        return new s3_data_source_1.S3DataSource(this, `s3-${props.bucket.node.addr}`, {
            knowledgeBase: this,
            ...props,
            contextEnrichment: contextEnrichment,
        });
    }
    addWebCrawlerDataSource(props) {
        const url = new URL(props.sourceUrls[0]);
        return new web_crawler_data_source_1.WebCrawlerDataSource(this, `web-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this,
            ...props,
        });
    }
    addSharePointDataSource(props) {
        const url = new URL(props.siteUrls[0]);
        return new sharepoint_data_source_1.SharePointDataSource(this, `sp-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this,
            ...props,
        });
    }
    addConfluenceDataSource(props) {
        const url = new URL(props.confluenceUrl);
        return new confluence_data_source_1.ConfluenceDataSource(this, `cf-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this,
            ...props,
        });
    }
    addSalesforceDataSource(props) {
        const url = new URL(props.endpoint);
        return new salesforce_data_source_1.SalesforceDataSource(this, `sf-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this,
            ...props,
        });
    }
    addCustomDataSource(props) {
        return new custom_data_source_1.CustomDataSource(this, `custom-${props.dataSourceName}`, {
            knowledgeBase: this,
            ...props,
        });
    }
}
exports.VectorKnowledgeBaseBase = VectorKnowledgeBaseBase;
_a = JSII_RTTI_SYMBOL_1;
VectorKnowledgeBaseBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.VectorKnowledgeBaseBase", version: "0.1.312" };
/**
 * Deploys a Bedrock Knowledge Base and configures a backend by OpenSearch Serverless,
 * Pinecone, Redis Enterprise Cloud or Amazon Aurora PostgreSQL.
 *
 */
class VectorKnowledgeBase extends VectorKnowledgeBaseBase {
    // ------------------------------------------------------
    // Import Methods
    // ------------------------------------------------------
    static fromKnowledgeBaseAttributes(scope, id, attrs) {
        const stack = aws_cdk_lib_1.Stack.of(scope);
        class Import extends VectorKnowledgeBaseBase {
            constructor() {
                super(...arguments);
                this.role = iam.Role.fromRoleArn(this, `kb-${attrs.knowledgeBaseId}-role`, attrs.executionRoleArn);
                this.description = attrs.description;
                this.instruction = attrs.instruction;
                this.knowledgeBaseId = attrs.knowledgeBaseId;
                this.vectorStoreType = attrs.vectorStoreType;
                this.knowledgeBaseArn = stack.formatArn({
                    service: 'bedrock',
                    resource: 'knowledge-base',
                    resourceName: attrs.knowledgeBaseId,
                    arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                });
            }
        }
        return new Import(scope, id);
    }
    constructor(scope, id, props) {
        super(scope, id);
        // ------------------------------------------------------
        // Set properties or defaults
        // ------------------------------------------------------
        const embeddingsModel = props.embeddingsModel;
        const vectorType = props.vectorType ?? models_1.VectorType.FLOATING_POINT;
        const indexName = props.indexName ?? 'bedrock-knowledge-base-default-index';
        const vectorField = props.vectorField ?? 'bedrock-knowledge-base-default-vector';
        const textField = 'AMAZON_BEDROCK_TEXT_CHUNK';
        const metadataField = 'AMAZON_BEDROCK_METADATA';
        this.description = props.description ?? 'CDK deployed Knowledge base'; // even though this prop is optional, if no value is provided it will fail to deploy
        // this.knowledgeBaseState = props.knowledgeBaseState ?? 'ENABLED';
        this.instruction = props.instruction;
        this.name = props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'KB', { maxLength: 32 });
        // ------------------------------------------------------
        // Validations
        // ------------------------------------------------------
        validateModel(embeddingsModel, vectorType);
        validateVectorIndex(props.vectorStore, props.vectorIndex, props.vectorField, props.indexName);
        if (props.vectorIndex) {
            validateIndexParameters(props.vectorIndex, indexName, vectorField);
        }
        // ------------------------------------------------------
        // Role
        // ------------------------------------------------------
        // Use existing role if provided, otherwise create a new one
        this.role = props.existingRole ?? (0, knowledge_base_1.createKnowledgeBaseServiceRole)(this);
        if (!props.existingRole) {
            embeddingsModel.grantInvoke(this.role);
            // Add CDK Nag suppression for bedrock:InvokeModel* wildcard permission
            nag_suppressions_1.NagSuppressions.addResourceSuppressions(this.role, [
                {
                    id: 'AwsSolutions-IAM5',
                    reason: 'Bedrock Knowledge Base requires wildcard permissions to invoke embedding models',
                },
            ], true);
        }
        // ------------------------------------------------------
        // Vector Store
        // ------------------------------------------------------
        /**
         * Create the vector store if the vector store was provided by the user.
         * Otherwise check againts all possible vector datastores.
         * If none was provided create default OpenSearch Serverless Collection.
         */
        if (props.vectorStore instanceof opensearchserverless_1.VectorCollection) {
            this.vectorStoreType = VectorStoreType.OPENSEARCH_SERVERLESS;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleOpenSearchCollection(props));
        }
        else if (props.vectorStore instanceof pinecone_1.PineconeVectorStore) {
            this.vectorStoreType = VectorStoreType.PINECONE;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handlePineconeVectorStore(props));
        }
        else if (props.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
            props.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore) {
            this.vectorStoreType = VectorStoreType.AMAZON_AURORA;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleAmazonAuroraVectorStore(props));
        }
        else if (props.vectorStore instanceof mongodb_atlas_1.MongoDBAtlasVectorStore) {
            this.vectorStoreType = VectorStoreType.MONGO_DB_ATLAS;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleMongoDBAtlasVectorStore(props));
        }
        else if (props.vectorStore instanceof opensearchmanagedcluster_1.OpenSearchManagedClusterVectorStore) {
            this.vectorStoreType = VectorStoreType.OPENSEARCH_MANAGED_CLUSTER;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleOpenSearchManagedClusterVectorStore(props));
        }
        else {
            this.vectorStoreType = VectorStoreType.OPENSEARCH_SERVERLESS;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleOpenSearchDefaultVectorCollection());
        }
        // perform this validation after the vector store is handled since if the user
        // doesn't provide one, the method above will create it
        validateVectorType(this.vectorStore, vectorType);
        /**
         * We need to add `secretsmanager:GetSecretValue` to the role
         * of the knowledge base if we use vector stores
         * other than OpenSearch Serverless.
         */
        if (!(this.vectorStore instanceof opensearchserverless_1.VectorCollection) && !(this.vectorStore instanceof opensearchmanagedcluster_1.OpenSearchManagedClusterVectorStore)) {
            this.role.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: ['secretsmanager:GetSecretValue'],
                resources: [this.vectorStore.credentialsSecretArn],
            }));
        }
        /**
         * We need to add `rds-data:ExecuteStatement`,
         * `rds-data:BatchExecuteStatement` and
         * `rds:DescribeDBClusters` to the role
         * of the knowledge base if we use Amazon Aurora as
         * a data source.
         */
        if (this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
            this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore) {
            this.role.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: [
                    'rds-data:ExecuteStatement',
                    'rds-data:BatchExecuteStatement',
                    'rds:DescribeDBClusters',
                ],
                resources: [this.vectorStore.resourceArn],
            }));
        }
        /**
         * Create the vector index if the vector store is OpenSearch Serverless
         * and it was not provided. Otherwise use the provided vector index.
         */
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS) {
            if (!props.vectorIndex) {
                this.vectorIndex = new opensearch_vectorindex_1.VectorIndex(this, 'KBIndex', {
                    collection: this.vectorStore,
                    indexName,
                    vectorField,
                    vectorDimensions: embeddingsModel.vectorDimensions,
                    precision: props.vectorType === models_1.VectorType.BINARY ? 'Binary' : 'float',
                    distanceType: props.vectorType === models_1.VectorType.BINARY ? 'hamming' : 'l2',
                    mappings: [
                        {
                            mappingField: 'AMAZON_BEDROCK_TEXT_CHUNK',
                            dataType: 'text',
                            filterable: true,
                        },
                        {
                            mappingField: 'AMAZON_BEDROCK_METADATA',
                            dataType: 'text',
                            filterable: false,
                        },
                    ],
                });
                this.vectorIndex.node.addDependency(this.vectorStore);
            }
            else {
                this.vectorIndex = props.vectorIndex;
            }
        }
        /**
         * Create storage configuraion. If it is of type of
         * `AmazonAuroraVectorStore` or `ExistingAmazonAuroraVectorStore`,
         * then get textField, metadataField and vectorField from
         * the arguments. Otherwise use default values.
         */
        const storageConfiguration = {
            indexName: indexName,
            vectorStore: this.vectorStore,
            vectorStoreType: this.vectorStoreType,
            vectorField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore
                ? this.vectorStore.vectorField
                : vectorField,
            textField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.textField
                : textField,
            metadataField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.metadataField
                : metadataField,
        };
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        const knowledgeBase = new aws_cdk_lib_1.aws_bedrock.CfnKnowledgeBase(this, 'MyCfnKnowledgeBase', {
            knowledgeBaseConfiguration: {
                type: knowledge_base_1.KnowledgeBaseType.VECTOR,
                vectorKnowledgeBaseConfiguration: {
                    embeddingModelArn: embeddingsModel.asArn(this),
                    // Used this approach as if property is specified on models that do not
                    // support configurable dimensions CloudFormation throws an error at runtime
                    embeddingModelConfiguration: {
                        bedrockEmbeddingModelConfiguration: embeddingsModel.modelId === 'amazon.titan-embed-text-v2:0'
                            ? {
                                dimensions: embeddingsModel.vectorDimensions,
                                embeddingDataType: vectorType,
                            }
                            : { embeddingDataType: vectorType },
                    },
                    ...(props.supplementalDataStorageLocations && props.supplementalDataStorageLocations.length > 0
                        ? {
                            supplementalDataStorageConfiguration: {
                                supplementalDataStorageLocations: props.supplementalDataStorageLocations.map(location => location.__render()),
                            },
                        }
                        : {}),
                },
            },
            name: this.name,
            roleArn: this.role.roleArn,
            storageConfiguration: getStorageConfiguration(storageConfiguration),
            description: props.description,
        });
        this.knowledgeBaseInstance = knowledgeBase;
        const kbCRPolicy = new iam.Policy(this, 'KBCRPolicy', {
            // roles: [crProvider.role],
            roles: [this.role],
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:CreateKnowledgeBase',
                        /**
                         * We need to add `bedrock:AssociateThirdPartyKnowledgeBase` if
                         * we are deploying Redis or Pinecone data sources
                         */
                        // ...(this.vectorStoreType === VectorStoreType.REDIS_ENTERPRISE_CLOUD ||
                        ...(this.vectorStoreType === VectorStoreType.PINECONE
                            ? ['bedrock:AssociateThirdPartyKnowledgeBase']
                            : []),
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:UpdateKnowledgeBase',
                        'bedrock:DeleteKnowledgeBase',
                        'bedrock:TagResource',
                    ],
                    resources: [
                        aws_cdk_lib_1.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'knowledge-base',
                            resourceName: '*',
                            arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    ],
                }),
                new iam.PolicyStatement({
                    actions: ['iam:PassRole'],
                    resources: [this.role.roleArn],
                }),
            ],
        });
        knowledgeBase.node.addDependency(this.role);
        knowledgeBase.node.addDependency(kbCRPolicy);
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS && this.vectorIndex) {
            knowledgeBase.node.addDependency(this.vectorIndex);
        }
        if (this.vectorStoreType === VectorStoreType.AMAZON_AURORA) {
            knowledgeBase.node.addDependency(this.vectorStore);
        }
        nag_suppressions_1.NagSuppressions.addResourceSuppressions(kbCRPolicy, [
            {
                id: 'AwsSolutions-IAM5',
                reason: "Bedrock CreateKnowledgeBase can't be restricted by resource.",
            },
        ], true);
        this.knowledgeBaseArn = knowledgeBase.attrKnowledgeBaseArn;
        this.knowledgeBaseId = knowledgeBase.attrKnowledgeBaseId;
    }
    /**
     * Handle VectorCollection type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchCollection(props) {
        const vectorStore = props.vectorStore;
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Handle PineconeVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of PineconeVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handlePineconeVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.PINECONE,
        };
    }
    /**
     * Handle AmazonAuroraVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of AmazonAuroraVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleAmazonAuroraVectorStore(props) {
        const vectorStore = props.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore
            ? props.vectorStore
            : props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.AMAZON_AURORA,
        };
    }
    /**
     * Handle OpenSearchManagedClusterVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of OpenSearchManagedClusterVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchManagedClusterVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_MANAGED_CLUSTER,
        };
    }
    /**
     * Handle MongoDBAtlasVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of MongoDBAtlasVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleMongoDBAtlasVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.MONGO_DB_ATLAS,
        };
    }
    /**
     * Handle the default VectorStore type.
     *
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchDefaultVectorCollection() {
        const vectorStore = new opensearchserverless_1.VectorCollection(this, 'KBVectors');
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Associate knowledge base with an agent
     */
    associateToAgent(agent) {
        agent.addKnowledgeBase(this);
    }
}
exports.VectorKnowledgeBase = VectorKnowledgeBase;
_b = JSII_RTTI_SYMBOL_1;
VectorKnowledgeBase[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.VectorKnowledgeBase", version: "0.1.312" };
/**
 * Validate that Bedrock Knowledge Base can use the selected model.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateModel(foundationModel, vectorType) {
    if (!foundationModel.supportsKnowledgeBase) {
        throw new Error(`The model ${foundationModel} is not supported by Bedrock Knowledge Base.`);
    }
    if (foundationModel.supportedVectorType &&
        !foundationModel.supportedVectorType.includes(vectorType)) {
        throw new Error(`The vector type ${vectorType} is not supported by the model ${foundationModel}.`);
    }
}
/**
 * Validate that the storage configuration can use the selected vector type.
 * It prevents the use of vector types with vector stores that do not support them,
 * thereby avoiding potential runtime errors.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateVectorType(vectorStore, vectorType) {
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorType == models_1.VectorType.BINARY) {
        throw new Error('Amazon OpenSearch Serverless is currently the only vector store that supports storing binary vectors.');
    }
}
/**
 * Validate if VectorIndex was provided for a VectorStore of type
 * other than `VectorCollection`.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateVectorIndex(vectorStore, vectorIndex, vectorField, indexName) {
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorIndex) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorIndex should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && indexName) {
        throw new Error('If vectorStore is not of type VectorCollection, indexName should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorField) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorField should not be provided ' +
            'in KnowledgeBase construct.');
    }
}
/**
 * Validate that indexName and vectorField parameters are identical
 * in KnowledgeBase construct if VectorIndex was created manually.
 *
 * By default we assign `vectorIndex` to `bedrock-knowledge-base-default-index`
 * value and if user provides `vectorIndex` manually, we need to make sure
 * they also provide it in KnowledgeBase construct if the value is not
 * `bedrock-knowledge-base-default-index`. Same for vectorField.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateIndexParameters(vectorIndex, indexName, vectorField) {
    if (vectorIndex.indexName !== 'bedrock-knowledge-base-default-index') {
        if (vectorIndex.indexName !== indexName) {
            throw new Error('Default value of indexName is `bedrock-knowledge-base-default-index`.' +
                ' If you create VectorIndex manually and assign vectorIndex to value other than' +
                ' `bedrock-knowledge-base-default-index` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-index`' +
                ' then do not assign indexName in KnowledgeBase construct.');
        }
    }
    if (vectorIndex.vectorField !== 'bedrock-knowledge-base-default-vector') {
        if (vectorIndex.vectorField !== vectorField) {
            throw new Error('Default value of vectorField is `bedrock-knowledge-base-default-vector`.' +
                ' If you create VectorIndex manually and assign vectorField to value other than' +
                ' `bedrock-knowledge-base-default-field` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-vector`' +
                ' then do not assign vectorField in KnowledgeBase construct.');
        }
    }
}
/**
 * Determine storage configuration based on vector store type.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function getStorageConfiguration(params) {
    switch (params.vectorStoreType) {
        case VectorStoreType.OPENSEARCH_SERVERLESS:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.OPENSEARCH_SERVERLESS,
                opensearchServerlessConfiguration: {
                    collectionArn: params.vectorStore.collectionArn,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                    vectorIndexName: params.indexName,
                },
            };
        case VectorStoreType.PINECONE:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.PINECONE,
                pineconeConfiguration: {
                    namespace: params.vectorStore.namespace || undefined,
                    connectionString: params.vectorStore.connectionString,
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    fieldMapping: {
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                },
            };
        case VectorStoreType.AMAZON_AURORA:
            params.vectorStore =
                params.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore
                    ? params.vectorStore
                    : params.vectorStore;
            return {
                type: VectorStoreType.AMAZON_AURORA,
                rdsConfiguration: {
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    databaseName: params.vectorStore.databaseName,
                    resourceArn: params.vectorStore.resourceArn,
                    tableName: `${params.vectorStore.schemaName}.${params.vectorStore.tableName}`,
                    fieldMapping: {
                        vectorField: params.vectorField.replace(/-/g, '_'),
                        primaryKeyField: params.vectorStore.primaryKeyField,
                        textField: params.textField.toLowerCase(),
                        metadataField: params.metadataField.toLowerCase(),
                    },
                },
            };
        case VectorStoreType.MONGO_DB_ATLAS:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.MONGO_DB_ATLAS,
                mongoDbAtlasConfiguration: {
                    collectionName: params.vectorStore.collectionName,
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    databaseName: params.vectorStore.databaseName,
                    endpoint: params.vectorStore.endpoint,
                    endpointServiceName: params.vectorStore.endpointServiceName,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                    vectorIndexName: params.indexName,
                    textIndexName: params.vectorStore.textIndexName,
                },
            };
        case VectorStoreType.OPENSEARCH_MANAGED_CLUSTER:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.OPENSEARCH_MANAGED_CLUSTER,
                opensearchManagedClusterConfiguration: {
                    domainArn: params.vectorStore.domainArn,
                    domainEndpoint: params.vectorStore.domainEndpoint,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                    vectorIndexName: params.indexName,
                },
            };
        default:
            throw new Error(`Unsupported vector store type: ${params.vectorStoreType}`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVjdG9yLWtub3dsZWRnZS1iYXNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2Nkay1saWIvYmVkcm9jay9rbm93bGVkZ2UtYmFzZXMvdmVjdG9yLWtub3dsZWRnZS1iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCw2Q0FBdUU7QUFDdkUsMkNBQTJDO0FBQzNDLG1FQUErRDtBQUUvRCxxREFPMEI7QUFFMUIseURBQXVFO0FBQ3ZFLHFEQUE4RjtBQUM5Rix1REFBOEQ7QUFDOUQseUVBQTJEO0FBQzNELDZFQUFxRjtBQUNyRixxRUFBOEQ7QUFDOUQsNkNBQXFEO0FBRXJELG1GQUdnRDtBQUNoRCwyRUFBdUU7QUFDdkUsMkVBRzRDO0FBQzVDLG1FQUE0RjtBQUM1RixtRkFHZ0Q7QUFDaEQsbUZBR2dEO0FBQ2hELHFGQUdpRDtBQUNqRCxzQ0FBK0Q7QUFFL0Q7OytFQUUrRTtBQUMvRTs7Ozs7OztHQU9HO0FBQ0gsSUFBWSxlQXlCWDtBQXpCRCxXQUFZLGVBQWU7SUFDekI7O09BRUc7SUFDSCxrRUFBK0MsQ0FBQTtJQUMvQzs7T0FFRztJQUNILDRFQUF5RCxDQUFBO0lBQ3pEOztPQUVHO0lBQ0gsd0NBQXFCLENBQUE7SUFDckI7O09BRUc7SUFDSCx3Q0FBcUIsQ0FBQTtJQUNyQjs7T0FFRztJQUNILG9EQUFpQyxDQUFBO0lBQ2pDOztPQUVHO0lBQ0gsMERBQXVDLENBQUE7QUFDekMsQ0FBQyxFQXpCVyxlQUFlLCtCQUFmLGVBQWUsUUF5QjFCO0FBaUdEOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBc0IsdUJBQ3BCLFNBQVEsa0NBQWlCO0lBV3pCLFlBQVksS0FBZ0IsRUFBRSxFQUFVO1FBQ3RDLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFISCxTQUFJLEdBQXNCLGtDQUFpQixDQUFDLE1BQU0sQ0FBQztJQUluRSxDQUFDO0lBRUQs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RUFBRTt3QkFDWixXQUFXLEVBQUUsTUFBTSxDQUFDLFdBQVc7d0JBQy9CLFNBQVMsRUFBRSxNQUFNLENBQUMsU0FBUzt3QkFDM0IsYUFBYSxFQUFFLE1BQU0sQ0FBQyxhQUFhO3FCQUNwQztvQkFDRCxlQUFlLEVBQUUsTUFBTSxDQUFDLFNBQVM7b0JBQ2pDLGFBQWEsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLGFBQWE7aUJBQ2hEO2FBQ0YsQ0FBQztRQUNKLEtBQUssZUFBZSxDQUFDLDBCQUEwQjtZQUM3QyxNQUFNLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxXQUFrRCxDQUFDO1lBQy9FLE9BQU87Z0JBQ0wsSUFBSSxFQUFFLGVBQWUsQ0FBQywwQkFBMEI7Z0JBQ2hELHFDQUFxQyxFQUFFO29CQUNyQyxTQUFTLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTO29CQUN2QyxjQUFjLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxjQUFjO29CQUNqRCxZQUFZLEVBQUU7d0JBQ1osV0FBVyxFQUFFLE1BQU0sQ0FBQyxXQUFXO3dCQUMvQixTQUFTLEVBQUUsTUFBTSxDQUFDLFNBQVM7d0JBQzNCLGFBQWEsRUFBRSxNQUFNLENBQUMsYUFBYTtxQkFDcEM7b0JBQ0QsZUFBZSxFQUFFLE1BQU0sQ0FBQyxTQUFTO2lCQUNsQzthQUNGLENBQUM7UUFDSjtZQUNFLE1BQU0sSUFBSSxLQUFLLENBQUMsa0NBQWtDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDO0lBQ2hGLENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQXJuRm9ybWF0LCBhd3NfYmVkcm9jayBhcyBiZWRyb2NrLCBTdGFjayB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCB7IE5hZ1N1cHByZXNzaW9ucyB9IGZyb20gJ2Nkay1uYWcvbGliL25hZy1zdXBwcmVzc2lvbnMnO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQge1xuICBDb21tb25Lbm93bGVkZ2VCYXNlQXR0cmlidXRlcyxcbiAgQ29tbW9uS25vd2xlZGdlQmFzZVByb3BzLFxuICBjcmVhdGVLbm93bGVkZ2VCYXNlU2VydmljZVJvbGUsXG4gIElLbm93bGVkZ2VCYXNlLFxuICBLbm93bGVkZ2VCYXNlQmFzZSxcbiAgS25vd2xlZGdlQmFzZVR5cGUsXG59IGZyb20gJy4va25vd2xlZGdlLWJhc2UnO1xuaW1wb3J0IHsgU3VwcGxlbWVudGFsRGF0YVN0b3JhZ2VMb2NhdGlvbiB9IGZyb20gJy4vc3VwcGxlbWVudGFsLWRhdGEtc3RvcmFnZSc7XG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuaW1wb3J0IHsgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSwgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfSBmcm9tICcuLi8uLi9hbWF6b25hdXJvcmEnO1xuaW1wb3J0IHsgTW9uZ29EQkF0bGFzVmVjdG9yU3RvcmUgfSBmcm9tICcuLi8uLi9tb25nb2RiLWF0bGFzJztcbmltcG9ydCB7IFZlY3RvckluZGV4IH0gZnJvbSAnLi4vLi4vb3BlbnNlYXJjaC12ZWN0b3JpbmRleCc7XG5pbXBvcnQgeyBPcGVuU2VhcmNoTWFuYWdlZENsdXN0ZXJWZWN0b3JTdG9yZSB9IGZyb20gJy4uLy4uL29wZW5zZWFyY2htYW5hZ2VkY2x1c3Rlcic7XG5pbXBvcnQgeyBWZWN0b3JDb2xsZWN0aW9uIH0gZnJvbSAnLi4vLi4vb3BlbnNlYXJjaHNlcnZlcmxlc3MnO1xuaW1wb3J0IHsgUGluZWNvbmVWZWN0b3JTdG9yZSB9IGZyb20gJy4uLy4uL3BpbmVjb25lJztcbmltcG9ydCB7IEFnZW50IH0gZnJvbSAnLi4vYWdlbnRzL2FnZW50JztcbmltcG9ydCB7XG4gIENvbmZsdWVuY2VEYXRhU291cmNlLFxuICBDb25mbHVlbmNlRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMsXG59IGZyb20gJy4uL2RhdGEtc291cmNlcy9jb25mbHVlbmNlLWRhdGEtc291cmNlJztcbmltcG9ydCB7IENvbnRleHRFbnJpY2htZW50IH0gZnJvbSAnLi4vZGF0YS1zb3VyY2VzL2NvbnRleHQtZW5yaWNobWVudCc7XG5pbXBvcnQge1xuICBDdXN0b21EYXRhU291cmNlLFxuICBDdXN0b21EYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbn0gZnJvbSAnLi4vZGF0YS1zb3VyY2VzL2N1c3RvbS1kYXRhLXNvdXJjZSc7XG5pbXBvcnQgeyBTM0RhdGFTb3VyY2UsIFMzRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMgfSBmcm9tICcuLi9kYXRhLXNvdXJjZXMvczMtZGF0YS1zb3VyY2UnO1xuaW1wb3J0IHtcbiAgU2FsZXNmb3JjZURhdGFTb3VyY2UsXG4gIFNhbGVzZm9yY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbn0gZnJvbSAnLi4vZGF0YS1zb3VyY2VzL3NhbGVzZm9yY2UtZGF0YS1zb3VyY2UnO1xuaW1wb3J0IHtcbiAgU2hhcmVQb2ludERhdGFTb3VyY2UsXG4gIFNoYXJlUG9pbnREYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbn0gZnJvbSAnLi4vZGF0YS1zb3VyY2VzL3NoYXJlcG9pbnQtZGF0YS1zb3VyY2UnO1xuaW1wb3J0IHtcbiAgV2ViQ3Jhd2xlckRhdGFTb3VyY2UsXG4gIFdlYkNyYXdsZXJEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbn0gZnJvbSAnLi4vZGF0YS1zb3VyY2VzL3dlYi1jcmF3bGVyLWRhdGEtc291cmNlJztcbmltcG9ydCB7IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWwsIFZlY3RvclR5cGUgfSBmcm9tICcuLi9tb2RlbHMnO1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFTlVNU1xuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBLbm93bGVkZ2UgYmFzZSBjYW4gYmUgYmFja2VkIGJ5IGRpZmZlcmVudCB2ZWN0b3IgZGF0YWJhc2VzLlxuICogVGhpcyBlbnVtIHJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCB2ZWN0b3IgZGF0YWJhc2VzIHRoYXQgY2FuIGJlIHVzZWQuXG4gKlxuICogYE9QRU5TRUFSQ0hfU0VSVkVSTEVTU2AgaXMgdGhlIGRlZmF1bHQgdmVjdG9yIGRhdGFiYXNlLlxuICogYFBJTkVDT05FYCBpcyB0aGUgdmVjdG9yIGRhdGFiYXNlIGZvciBQaW5lY29uZS5cbiAqIGBBTUFaT05fQVVST1JBYCBpcyB0aGUgdmVjdG9yIGRhdGFiYXNlIGZvciBBbWF6b24gQXVyb3JhIFBvc3RncmVTUUwuXG4gKi9cbmV4cG9ydCBlbnVtIFZlY3RvclN0b3JlVHlwZSB7XG4gIC8qKlxuICAgKiBgT1BFTlNFQVJDSF9TRVJWRVJMRVNTYCBpcyB0aGUgdmVjdG9yIHN0b3JlIGZvciBPcGVuU2VhcmNoIFNlcnZlcmxlc3MuXG4gICAqL1xuICBPUEVOU0VBUkNIX1NFUlZFUkxFU1MgPSAnT1BFTlNFQVJDSF9TRVJWRVJMRVNTJyxcbiAgLyoqXG4gICAqIGBPUEVOU0VBUkNIX01BTkFHRURfQ0xVU1RFUmAgaXMgdGhlIHZlY3RvciBzdG9yZSBmb3IgT3BlblNlYXJjaCBNYW5hZ2VkIENsdXN0ZXIuXG4gICAqL1xuICBPUEVOU0VBUkNIX01BTkFHRURfQ0xVU1RFUiA9ICdPUEVOU0VBUkNIX01BTkFHRURfQ0xVU1RFUicsXG4gIC8qKlxuICAgKiBgUElORUNPTkVgIGlzIHRoZSB2ZWN0b3Igc3RvcmUgZm9yIFBpbmVjb25lLlxuICAgKi9cbiAgUElORUNPTkUgPSAnUElORUNPTkUnLFxuICAvKipcbiAgICogYFJEU2AgaXMgdGhlIHZlY3RvciBzdG9yZSBmb3IgQW1hem9uIEF1cm9yYS5cbiAgICovXG4gIEFNQVpPTl9BVVJPUkEgPSAnUkRTJyxcbiAgLyoqXG4gICAqIGBNT05HT19EQl9BVExBU2AgaXMgdGhlIHZlY3RvciBzdG9yZSBmb3IgTW9uZ29EQiBBdGxhcy5cbiAgICovXG4gIE1PTkdPX0RCX0FUTEFTID0gJ01PTkdPX0RCX0FUTEFTJyxcbiAgLyoqXG4gICAqIGBORVBUVU5FX0FOQUxZVElDU2AgaXMgdGhlIHZlY3RvciBzdG9yZSBmb3IgQW1hem9uIE5lcHR1bmUgQW5hbHl0aWNzLlxuICAgKi9cbiAgTkVQVFVORV9BTkFMWVRJQ1MgPSAnTkVQVFVORV9BTkFMWVRJQ1MnLFxufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ09NTU9OIElOVEVSRkFDRVNcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogSW50ZXJmYWNlIGZvciB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgc3RvcmFnZSBmb3Iga25vd2xlZGdlIGJhc2UuXG4gKi9cbmludGVyZmFjZSBTdG9yYWdlQ29uZmlndXJhdGlvbiB7XG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIHN0b3JlLCB3aGljaCBjYW4gYmUgb2YgYFZlY3RvckNvbGxlY3Rpb25gLCBgUGluZWNvbmVWZWN0b3JTdG9yZWAsXG4gICAqIGBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZWAsIG9yIGBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZWAgdHlwZXMuXG4gICAqL1xuICB2ZWN0b3JTdG9yZTpcbiAgICB8IFZlY3RvckNvbGxlY3Rpb25cbiAgICB8IFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgICB8IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgfCBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgfCBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZVxuICAgIHwgT3BlblNlYXJjaE1hbmFnZWRDbHVzdGVyVmVjdG9yU3RvcmU7XG5cbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIHRoZSB2ZWN0b3Igc3RvcmUuXG4gICAqL1xuICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGluZGV4LlxuICAgKi9cbiAgaW5kZXhOYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBvZiB0aGUgdmVjdG9yIGZpZWxkIGZvciB2ZWN0b3IgbWFwcGluZy5cbiAgICovXG4gIHZlY3RvckZpZWxkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBvZiB0aGUgdGV4dCBmaWVsZCBmb3IgdmVjdG9yIG1hcHBpbmcuXG4gICAqL1xuICB0ZXh0RmllbGQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG9mIHRoZSBtZXRhZGF0YS5cbiAgICovXG4gIG1ldGFkYXRhRmllbGQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgS25vd2xlZGdlIEJhc2UsIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElWZWN0b3JLbm93bGVkZ2VCYXNlIGV4dGVuZHMgSUtub3dsZWRnZUJhc2Uge1xuICAvKipcbiAgICogVGhlIHN0b3JhZ2UgdHlwZSBmb3IgdGhlIFZlY3RvciBFbWJlZGRpbmdzLlxuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBTMyBkYXRhIHNvdXJjZSB0byB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBhZGRTM0RhdGFTb3VyY2UocHJvcHM6IFMzRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBTM0RhdGFTb3VyY2U7XG5cbiAgLyoqXG4gICAqIEFkZCBhIHdlYiBjcmF3bGVyIGRhdGEgc291cmNlIHRvIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIGFkZFdlYkNyYXdsZXJEYXRhU291cmNlKHByb3BzOiBXZWJDcmF3bGVyRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBXZWJDcmF3bGVyRGF0YVNvdXJjZTtcblxuICAvKipcbiAgICogQWRkIGEgU2hhcmVQb2ludCBkYXRhIHNvdXJjZSB0byB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBhZGRTaGFyZVBvaW50RGF0YVNvdXJjZShwcm9wczogU2hhcmVQb2ludERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzKTogU2hhcmVQb2ludERhdGFTb3VyY2U7XG5cbiAgLyoqXG4gICAqIEFkZCBhIENvbmZsdWVuY2UgZGF0YSBzb3VyY2UgdG8gdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgYWRkQ29uZmx1ZW5jZURhdGFTb3VyY2UocHJvcHM6IENvbmZsdWVuY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IENvbmZsdWVuY2VEYXRhU291cmNlO1xuXG4gIC8qKlxuICAgKiBBZGQgYSBTYWxlc2ZvcmNlIGRhdGEgc291cmNlIHRvIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIGFkZFNhbGVzZm9yY2VEYXRhU291cmNlKHByb3BzOiBTYWxlc2ZvcmNlRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBTYWxlc2ZvcmNlRGF0YVNvdXJjZTtcblxuICAvKipcbiAgICogQWRkIGEgQ3VzdG9tIGRhdGEgc291cmNlIHRvIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIGFkZEN1c3RvbURhdGFTb3VyY2UocHJvcHM6IEN1c3RvbURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzKTogQ3VzdG9tRGF0YVNvdXJjZTtcblxuICAvKipcbiAgICogR3JhbnQgdGhlIGdpdmVuIGlkZW50aXR5IHBlcm1pc3Npb25zIHRvIHJldHJpZXZlIGNvbnRlbnQgZnJvbSB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBncmFudFJldHJpZXZlKGdyYW50ZWU6IGlhbS5JR3JhbnRhYmxlKTogaWFtLkdyYW50O1xuXG4gIC8qKlxuICAgKiBHcmFudCB0aGUgZ2l2ZW4gaWRlbnRpdHkgcGVybWlzc2lvbnMgdG8gcmV0cmlldmUgY29udGVudCBmcm9tIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIGdyYW50UmV0cmlldmVBbmRHZW5lcmF0ZShncmFudGVlOiBpYW0uSUdyYW50YWJsZSk6IGlhbS5HcmFudDtcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBQlNUUkFDVCBDTEFTU1xuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBWZWN0b3IgS25vd2xlZGdlIEJhc2UuXG4gKiBDb250YWlucyBtZXRob2RzIHZhbGlkIGZvciBLQnMgZWl0aGVyIGNyZWF0ZWQgd2l0aCBDREsgb3IgaW1wb3J0ZWQuXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBWZWN0b3JLbm93bGVkZ2VCYXNlQmFzZVxuICBleHRlbmRzIEtub3dsZWRnZUJhc2VCYXNlXG4gIGltcGxlbWVudHMgSVZlY3Rvcktub3dsZWRnZUJhc2Uge1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga25vd2xlZGdlQmFzZUFybjogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga25vd2xlZGdlQmFzZUlkOiBzdHJpbmc7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSByb2xlOiBpYW0uSVJvbGU7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgaW5zdHJ1Y3Rpb24/OiBzdHJpbmc7XG5cbiAgcHVibGljIHJlYWRvbmx5IHR5cGU6IEtub3dsZWRnZUJhc2VUeXBlID0gS25vd2xlZGdlQmFzZVR5cGUuVkVDVE9SO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEhlbHBlciBtZXRob2RzIHRvIGFkZCBEYXRhIFNvdXJjZXNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBBZGRzIGFuIFMzIGRhdGEgc291cmNlIHRvIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyBhZGRTM0RhdGFTb3VyY2UocHJvcHM6IFMzRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBTM0RhdGFTb3VyY2Uge1xuICAgIC8vIFZhbGlkYXRlIGNvbnRleHQgZW5yaWNobWVudCBpcyBvbmx5IHVzZWQgd2l0aCBOZXB0dW5lIEFuYWx5dGljc1xuICAgIGNvbnN0IGlzTmVwdHVuZUtCID0gdGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5ORVBUVU5FX0FOQUxZVElDUztcbiAgICBpZiAocHJvcHMuY29udGV4dEVucmljaG1lbnQgJiYgIWlzTmVwdHVuZUtCKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnRleHQgZW5yaWNobWVudCBpcyBvbmx5IHN1cHBvcnRlZCBmb3IgTmVwdHVuZS9HcmFwaFJBRyBLbm93bGVkZ2VCYXNlcycpO1xuICAgIH1cblxuICAgIC8vIFNldCBjb250ZXh0IGVucmljaG1lbnQgLSB1c2UgcHJvdmlkZWQgdmFsdWUgb3IgZGVmYXVsdCBmb3IgTmVwdHVuZVxuICAgIGxldCBjb250ZXh0RW5yaWNobWVudCA9IHByb3BzLmNvbnRleHRFbnJpY2htZW50O1xuICAgIGlmIChpc05lcHR1bmVLQikge1xuICAgICAgY29udGV4dEVucmljaG1lbnQgPVxuICAgICAgICBwcm9wcy5jb250ZXh0RW5yaWNobWVudCA/P1xuICAgICAgICBDb250ZXh0RW5yaWNobWVudC5mb3VuZGF0aW9uTW9kZWwoe1xuICAgICAgICAgIGVucmljaG1lbnRNb2RlbDogQmVkcm9ja0ZvdW5kYXRpb25Nb2RlbC5BTlRIUk9QSUNfQ0xBVURFX0hBSUtVX1YxXzAsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBhbmQgcmV0dXJuIHRoZSBTMyBkYXRhIHNvdXJjZVxuICAgIHJldHVybiBuZXcgUzNEYXRhU291cmNlKHRoaXMsIGBzMy0ke3Byb3BzLmJ1Y2tldC5ub2RlLmFkZHJ9YCwge1xuICAgICAga25vd2xlZGdlQmFzZTogdGhpcyxcbiAgICAgIC4uLnByb3BzLFxuICAgICAgY29udGV4dEVucmljaG1lbnQ6IGNvbnRleHRFbnJpY2htZW50LFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGFkZFdlYkNyYXdsZXJEYXRhU291cmNlKFxuICAgIHByb3BzOiBXZWJDcmF3bGVyRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMsXG4gICk6IFdlYkNyYXdsZXJEYXRhU291cmNlIHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHByb3BzLnNvdXJjZVVybHNbMF0pO1xuICAgIHJldHVybiBuZXcgV2ViQ3Jhd2xlckRhdGFTb3VyY2UodGhpcywgYHdlYi0ke3VybC5ob3N0bmFtZS5yZXBsYWNlKCcuJywgJy0nKX1gLCB7XG4gICAgICBrbm93bGVkZ2VCYXNlOiB0aGlzLFxuICAgICAgLi4ucHJvcHMsXG4gICAgfSk7XG4gIH1cbiAgcHVibGljIGFkZFNoYXJlUG9pbnREYXRhU291cmNlKFxuICAgIHByb3BzOiBTaGFyZVBvaW50RGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMsXG4gICk6IFNoYXJlUG9pbnREYXRhU291cmNlIHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHByb3BzLnNpdGVVcmxzWzBdKTtcbiAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnREYXRhU291cmNlKHRoaXMsIGBzcC0ke3VybC5ob3N0bmFtZS5yZXBsYWNlKCcuJywgJy0nKX1gLCB7XG4gICAgICBrbm93bGVkZ2VCYXNlOiB0aGlzLFxuICAgICAgLi4ucHJvcHMsXG4gICAgfSk7XG4gIH1cbiAgcHVibGljIGFkZENvbmZsdWVuY2VEYXRhU291cmNlKFxuICAgIHByb3BzOiBDb25mbHVlbmNlRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMsXG4gICk6IENvbmZsdWVuY2VEYXRhU291cmNlIHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHByb3BzLmNvbmZsdWVuY2VVcmwpO1xuICAgIHJldHVybiBuZXcgQ29uZmx1ZW5jZURhdGFTb3VyY2UodGhpcywgYGNmLSR7dXJsLmhvc3RuYW1lLnJlcGxhY2UoJy4nLCAnLScpfWAsIHtcbiAgICAgIGtub3dsZWRnZUJhc2U6IHRoaXMsXG4gICAgICAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxuICBwdWJsaWMgYWRkU2FsZXNmb3JjZURhdGFTb3VyY2UoXG4gICAgcHJvcHM6IFNhbGVzZm9yY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbiAgKTogU2FsZXNmb3JjZURhdGFTb3VyY2Uge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocHJvcHMuZW5kcG9pbnQpO1xuICAgIHJldHVybiBuZXcgU2FsZXNmb3JjZURhdGFTb3VyY2UodGhpcywgYHNmLSR7dXJsLmhvc3RuYW1lLnJlcGxhY2UoJy4nLCAnLScpfWAsIHtcbiAgICAgIGtub3dsZWRnZUJhc2U6IHRoaXMsXG4gICAgICAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxuICBwdWJsaWMgYWRkQ3VzdG9tRGF0YVNvdXJjZShwcm9wczogQ3VzdG9tRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBDdXN0b21EYXRhU291cmNlIHtcbiAgICByZXR1cm4gbmV3IEN1c3RvbURhdGFTb3VyY2UodGhpcywgYGN1c3RvbS0ke3Byb3BzLmRhdGFTb3VyY2VOYW1lfWAsIHtcbiAgICAgIGtub3dsZWRnZUJhc2U6IHRoaXMsXG4gICAgICAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIFBST1BTIEZPUiBORVcgQ09OU1RSVUNUXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGEga25vd2xlZGdlIGJhc2VcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBWZWN0b3JLbm93bGVkZ2VCYXNlUHJvcHMgZXh0ZW5kcyBDb21tb25Lbm93bGVkZ2VCYXNlUHJvcHMge1xuICAvKipcbiAgICogVGhlIGVtYmVkZGluZ3MgbW9kZWwgZm9yIHRoZSBrbm93bGVkZ2UgYmFzZVxuICAgKi9cbiAgcmVhZG9ubHkgZW1iZWRkaW5nc01vZGVsOiBCZWRyb2NrRm91bmRhdGlvbk1vZGVsO1xuXG4gIC8qKlxuICAgKiBUaGUgc3VwcGxlbWVudGFsIGRhdGEgc3RvcmFnZSBsb2NhdGlvbnMgZm9yIHRoZSBrbm93bGVkZ2UgYmFzZVxuICAgKi9cbiAgcmVhZG9ubHkgc3VwcGxlbWVudGFsRGF0YVN0b3JhZ2VMb2NhdGlvbnM/OiBTdXBwbGVtZW50YWxEYXRhU3RvcmFnZUxvY2F0aW9uW107XG5cbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3IgdHlwZSB0byBzdG9yZSB2ZWN0b3IgZW1iZWRkaW5ncy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBWZWN0b3JUeXBlLkZMT0FUSU5HX1BPSU5UXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JUeXBlPzogVmVjdG9yVHlwZTtcblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIHZlY3RvciBpbmRleC5cbiAgICogSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgYFZlY3RvckNvbGxlY3Rpb25gLFxuICAgKiBkbyBub3QgaW5jbHVkZSB0aGlzIHByb3BlcnR5IGFzIGl0IHdpbGwgdGhyb3cgZXJyb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleCdcbiAgICovXG4gIHJlYWRvbmx5IGluZGV4TmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGZpZWxkIGluIHRoZSB2ZWN0b3IgaW5kZXguXG4gICAqIElmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIGBWZWN0b3JDb2xsZWN0aW9uYCxcbiAgICogZG8gbm90IGluY2x1ZGUgdGhpcyBwcm9wZXJ0eSBhcyBpdCB3aWxsIHRocm93IGVycm9yLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtdmVjdG9yJ1xuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9yRmllbGQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3Igc3RvcmUgZm9yIHRoZSBrbm93bGVkZ2UgYmFzZS4gTXVzdCBiZSBlaXRoZXIgb2ZcbiAgICogdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsIGBSZWRpc0VudGVycHJpc2VWZWN0b3JTdG9yZWAsXG4gICAqIGBQaW5lY29uZVZlY3RvclN0b3JlYCwgYEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlYCwgb3IgYE1vbmdvREJBdGxhc1ZlY3RvclN0b3JlYC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBIG5ldyBPcGVuU2VhcmNoIFNlcnZlcmxlc3MgdmVjdG9yIGNvbGxlY3Rpb24gaXMgY3JlYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IHZlY3RvclN0b3JlPzpcbiAgICB8IFZlY3RvckNvbGxlY3Rpb25cbiAgICB8IFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgICB8IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgfCBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgfCBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZVxuICAgIHwgT3BlblNlYXJjaE1hbmFnZWRDbHVzdGVyVmVjdG9yU3RvcmU7XG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIGluZGV4IGZvciB0aGUgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzIGJhY2tlZCBrbm93bGVkZ2UgYmFzZS5cbiAgICogSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgYFZlY3RvckNvbGxlY3Rpb25gLCBkbyBub3QgaW5jbHVkZVxuICAgKiB0aGlzIHByb3BlcnR5IGFzIGl0IHdpbGwgdGhyb3cgZXJyb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuZXcgdmVjdG9yIGluZGV4IGlzIGNyZWF0ZWQgb24gdGhlIFZlY3RvciBDb2xsZWN0aW9uXG4gICAqIGlmIHZlY3RvciBzdG9yZSBpcyBvZiBgVmVjdG9yQ29sbGVjdGlvbmAgdHlwZS5cbiAgICovXG4gIHJlYWRvbmx5IHZlY3RvckluZGV4PzogVmVjdG9ySW5kZXg7XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgIEFUVFJTIEZPUiBJTVBPUlRFRCBDT05TVFJVQ1RcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogUHJvcGVydGllcyBmb3IgaW1wb3J0aW5nIGEga25vd2xlZGdlIGJhc2Ugb3V0c2lkZSBvZiB0aGlzIHN0YWNrXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmVjdG9yS25vd2xlZGdlQmFzZUF0dHJpYnV0ZXMgZXh0ZW5kcyBDb21tb25Lbm93bGVkZ2VCYXNlQXR0cmlidXRlcyB7XG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIHN0b3JlIHR5cGUgZm9yIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHJlYWRvbmx5IHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xufVxuXG4vKipcbiAqIERlcGxveXMgYSBCZWRyb2NrIEtub3dsZWRnZSBCYXNlIGFuZCBjb25maWd1cmVzIGEgYmFja2VuZCBieSBPcGVuU2VhcmNoIFNlcnZlcmxlc3MsXG4gKiBQaW5lY29uZSwgUmVkaXMgRW50ZXJwcmlzZSBDbG91ZCBvciBBbWF6b24gQXVyb3JhIFBvc3RncmVTUUwuXG4gKlxuICovXG5leHBvcnQgY2xhc3MgVmVjdG9yS25vd2xlZGdlQmFzZSBleHRlbmRzIFZlY3Rvcktub3dsZWRnZUJhc2VCYXNlIHtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEltcG9ydCBNZXRob2RzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBwdWJsaWMgc3RhdGljIGZyb21Lbm93bGVkZ2VCYXNlQXR0cmlidXRlcyhcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIGlkOiBzdHJpbmcsXG4gICAgYXR0cnM6IFZlY3Rvcktub3dsZWRnZUJhc2VBdHRyaWJ1dGVzLFxuICApOiBJVmVjdG9yS25vd2xlZGdlQmFzZSB7XG4gICAgY29uc3Qgc3RhY2sgPSBTdGFjay5vZihzY29wZSk7XG5cbiAgICBjbGFzcyBJbXBvcnQgZXh0ZW5kcyBWZWN0b3JLbm93bGVkZ2VCYXNlQmFzZSB7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgcm9sZSA9IGlhbS5Sb2xlLmZyb21Sb2xlQXJuKFxuICAgICAgICB0aGlzLFxuICAgICAgICBga2ItJHthdHRycy5rbm93bGVkZ2VCYXNlSWR9LXJvbGVgLFxuICAgICAgICBhdHRycy5leGVjdXRpb25Sb2xlQXJuLFxuICAgICAgKTtcbiAgICAgIHB1YmxpYyByZWFkb25seSBkZXNjcmlwdGlvbiA9IGF0dHJzLmRlc2NyaXB0aW9uO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGluc3RydWN0aW9uID0gYXR0cnMuaW5zdHJ1Y3Rpb247XG4gICAgICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZUlkID0gYXR0cnMua25vd2xlZGdlQmFzZUlkO1xuICAgICAgcHVibGljIHJlYWRvbmx5IHZlY3RvclN0b3JlVHlwZSA9IGF0dHJzLnZlY3RvclN0b3JlVHlwZTtcbiAgICAgIHB1YmxpYyByZWFkb25seSBrbm93bGVkZ2VCYXNlQXJuID0gc3RhY2suZm9ybWF0QXJuKHtcbiAgICAgICAgc2VydmljZTogJ2JlZHJvY2snLFxuICAgICAgICByZXNvdXJjZTogJ2tub3dsZWRnZS1iYXNlJyxcbiAgICAgICAgcmVzb3VyY2VOYW1lOiBhdHRycy5rbm93bGVkZ2VCYXNlSWQsXG4gICAgICAgIGFybkZvcm1hdDogQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBJbXBvcnQoc2NvcGUsIGlkKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQXR0cmlidXRlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBuYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEluc3RhbmNlIG9mIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VJbnN0YW5jZTogYmVkcm9jay5DZm5Lbm93bGVkZ2VCYXNlO1xuXG4gIC8qKlxuICAgKiBUaGUgcm9sZSB0aGUgS25vd2xlZGdlIEJhc2UgdXNlcyB0byBhY2Nlc3MgdGhlIHZlY3RvciBzdG9yZSBhbmQgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcm9sZTogaWFtLklSb2xlO1xuXG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIHN0b3JlIGZvciB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdmVjdG9yU3RvcmU6XG4gICAgfCBWZWN0b3JDb2xsZWN0aW9uXG4gICAgfCBQaW5lY29uZVZlY3RvclN0b3JlXG4gICAgfCBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICAgIHwgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICAgIHwgTW9uZ29EQkF0bGFzVmVjdG9yU3RvcmVcbiAgICB8IE9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlO1xuXG4gIC8qKlxuICAgKiBBIGRlc2NyaXB0aW9uIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHJlYWRvbmx5IGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJbnN0cnVjdGlvbnMgZm9yIGFnZW50cyBiYXNlZCBvbiB0aGUgZGVzaWduIGFuZCB0eXBlIG9mIGluZm9ybWF0aW9uIG9mIHRoZVxuICAgKiBLbm93bGVkZ2UgQmFzZS4gVGhpcyB3aWxsIGltcGFjdCBob3cgQWdlbnRzIGludGVyYWN0IHdpdGggdGhlIEtub3dsZWRnZSBCYXNlLlxuICAgKi9cbiAgcmVhZG9ubHkgaW5zdHJ1Y3Rpb24/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VBcm46IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBrbm93bGVkZ2VCYXNlSWQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuXG4gIC8qKlxuICAgKiBUaGUgT3BlblNlYXJjaCB2ZWN0b3IgaW5kZXggZm9yIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgdmVjdG9ySW5kZXg/OiBWZWN0b3JJbmRleDtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogVmVjdG9yS25vd2xlZGdlQmFzZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNldCBwcm9wZXJ0aWVzIG9yIGRlZmF1bHRzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29uc3QgZW1iZWRkaW5nc01vZGVsID0gcHJvcHMuZW1iZWRkaW5nc01vZGVsO1xuICAgIGNvbnN0IHZlY3RvclR5cGUgPSBwcm9wcy52ZWN0b3JUeXBlID8/IFZlY3RvclR5cGUuRkxPQVRJTkdfUE9JTlQ7XG4gICAgY29uc3QgaW5kZXhOYW1lID0gcHJvcHMuaW5kZXhOYW1lID8/ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXgnO1xuICAgIGNvbnN0IHZlY3RvckZpZWxkID0gcHJvcHMudmVjdG9yRmllbGQgPz8gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3InO1xuICAgIGNvbnN0IHRleHRGaWVsZCA9ICdBTUFaT05fQkVEUk9DS19URVhUX0NIVU5LJztcbiAgICBjb25zdCBtZXRhZGF0YUZpZWxkID0gJ0FNQVpPTl9CRURST0NLX01FVEFEQVRBJztcblxuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBwcm9wcy5kZXNjcmlwdGlvbiA/PyAnQ0RLIGRlcGxveWVkIEtub3dsZWRnZSBiYXNlJzsgLy8gZXZlbiB0aG91Z2ggdGhpcyBwcm9wIGlzIG9wdGlvbmFsLCBpZiBubyB2YWx1ZSBpcyBwcm92aWRlZCBpdCB3aWxsIGZhaWwgdG8gZGVwbG95XG4gICAgLy8gdGhpcy5rbm93bGVkZ2VCYXNlU3RhdGUgPSBwcm9wcy5rbm93bGVkZ2VCYXNlU3RhdGUgPz8gJ0VOQUJMRUQnO1xuICAgIHRoaXMuaW5zdHJ1Y3Rpb24gPSBwcm9wcy5pbnN0cnVjdGlvbjtcbiAgICB0aGlzLm5hbWUgPSBwcm9wcy5uYW1lID8/IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ0tCJywgeyBtYXhMZW5ndGg6IDMyIH0pO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gVmFsaWRhdGlvbnNcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIHZhbGlkYXRlTW9kZWwoZW1iZWRkaW5nc01vZGVsLCB2ZWN0b3JUeXBlKTtcbiAgICB2YWxpZGF0ZVZlY3RvckluZGV4KHByb3BzLnZlY3RvclN0b3JlLCBwcm9wcy52ZWN0b3JJbmRleCwgcHJvcHMudmVjdG9yRmllbGQsIHByb3BzLmluZGV4TmFtZSk7XG4gICAgaWYgKHByb3BzLnZlY3RvckluZGV4KSB7XG4gICAgICB2YWxpZGF0ZUluZGV4UGFyYW1ldGVycyhwcm9wcy52ZWN0b3JJbmRleCwgaW5kZXhOYW1lLCB2ZWN0b3JGaWVsZCk7XG4gICAgfVxuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gUm9sZVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFVzZSBleGlzdGluZyByb2xlIGlmIHByb3ZpZGVkLCBvdGhlcndpc2UgY3JlYXRlIGEgbmV3IG9uZVxuICAgIHRoaXMucm9sZSA9IHByb3BzLmV4aXN0aW5nUm9sZSA/PyBjcmVhdGVLbm93bGVkZ2VCYXNlU2VydmljZVJvbGUodGhpcyk7XG5cbiAgICBpZiAoIXByb3BzLmV4aXN0aW5nUm9sZSkge1xuICAgICAgZW1iZWRkaW5nc01vZGVsLmdyYW50SW52b2tlKHRoaXMucm9sZSk7XG5cbiAgICAgIC8vIEFkZCBDREsgTmFnIHN1cHByZXNzaW9uIGZvciBiZWRyb2NrOkludm9rZU1vZGVsKiB3aWxkY2FyZCBwZXJtaXNzaW9uXG4gICAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICAgIHRoaXMucm9sZSxcbiAgICAgICAgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnQXdzU29sdXRpb25zLUlBTTUnLFxuICAgICAgICAgICAgcmVhc29uOiAnQmVkcm9jayBLbm93bGVkZ2UgQmFzZSByZXF1aXJlcyB3aWxkY2FyZCBwZXJtaXNzaW9ucyB0byBpbnZva2UgZW1iZWRkaW5nIG1vZGVscycsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgdHJ1ZSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gVmVjdG9yIFN0b3JlXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSB2ZWN0b3Igc3RvcmUgaWYgdGhlIHZlY3RvciBzdG9yZSB3YXMgcHJvdmlkZWQgYnkgdGhlIHVzZXIuXG4gICAgICogT3RoZXJ3aXNlIGNoZWNrIGFnYWludHMgYWxsIHBvc3NpYmxlIHZlY3RvciBkYXRhc3RvcmVzLlxuICAgICAqIElmIG5vbmUgd2FzIHByb3ZpZGVkIGNyZWF0ZSBkZWZhdWx0IE9wZW5TZWFyY2ggU2VydmVybGVzcyBDb2xsZWN0aW9uLlxuICAgICAqL1xuICAgIGlmIChwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pIHtcbiAgICAgIHRoaXMudmVjdG9yU3RvcmVUeXBlID0gVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfU0VSVkVSTEVTUztcbiAgICAgICh7IHZlY3RvclN0b3JlOiB0aGlzLnZlY3RvclN0b3JlLCB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlIH0gPVxuICAgICAgICB0aGlzLmhhbmRsZU9wZW5TZWFyY2hDb2xsZWN0aW9uKHByb3BzKSk7XG4gICAgfSBlbHNlIGlmIChwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFBpbmVjb25lVmVjdG9yU3RvcmUpIHtcbiAgICAgIHRoaXMudmVjdG9yU3RvcmVUeXBlID0gVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FO1xuICAgICAgKHsgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUgfSA9XG4gICAgICAgIHRoaXMuaGFuZGxlUGluZWNvbmVWZWN0b3JTdG9yZShwcm9wcykpO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHx8XG4gICAgICBwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICApIHtcbiAgICAgIHRoaXMudmVjdG9yU3RvcmVUeXBlID0gVmVjdG9yU3RvcmVUeXBlLkFNQVpPTl9BVVJPUkE7XG4gICAgICAoeyB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSwgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSB9ID1cbiAgICAgICAgdGhpcy5oYW5kbGVBbWF6b25BdXJvcmFWZWN0b3JTdG9yZShwcm9wcykpO1xuICAgIH0gZWxzZSBpZiAocHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZSkge1xuICAgICAgdGhpcy52ZWN0b3JTdG9yZVR5cGUgPSBWZWN0b3JTdG9yZVR5cGUuTU9OR09fREJfQVRMQVM7XG4gICAgICAoeyB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSwgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSB9ID1cbiAgICAgICAgdGhpcy5oYW5kbGVNb25nb0RCQXRsYXNWZWN0b3JTdG9yZShwcm9wcykpO1xuICAgIH0gZWxzZSBpZiAocHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBPcGVuU2VhcmNoTWFuYWdlZENsdXN0ZXJWZWN0b3JTdG9yZSkge1xuICAgICAgdGhpcy52ZWN0b3JTdG9yZVR5cGUgPSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9NQU5BR0VEX0NMVVNURVI7XG4gICAgICAoeyB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSwgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSB9ID1cbiAgICAgICAgdGhpcy5oYW5kbGVPcGVuU2VhcmNoTWFuYWdlZENsdXN0ZXJWZWN0b3JTdG9yZShwcm9wcykpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnZlY3RvclN0b3JlVHlwZSA9IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1M7XG4gICAgICAoeyB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSwgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSB9ID1cbiAgICAgICAgdGhpcy5oYW5kbGVPcGVuU2VhcmNoRGVmYXVsdFZlY3RvckNvbGxlY3Rpb24oKSk7XG4gICAgfVxuXG4gICAgLy8gcGVyZm9ybSB0aGlzIHZhbGlkYXRpb24gYWZ0ZXIgdGhlIHZlY3RvciBzdG9yZSBpcyBoYW5kbGVkIHNpbmNlIGlmIHRoZSB1c2VyXG4gICAgLy8gZG9lc24ndCBwcm92aWRlIG9uZSwgdGhlIG1ldGhvZCBhYm92ZSB3aWxsIGNyZWF0ZSBpdFxuICAgIHZhbGlkYXRlVmVjdG9yVHlwZSh0aGlzLnZlY3RvclN0b3JlLCB2ZWN0b3JUeXBlKTtcblxuICAgIC8qKlxuICAgICAqIFdlIG5lZWQgdG8gYWRkIGBzZWNyZXRzbWFuYWdlcjpHZXRTZWNyZXRWYWx1ZWAgdG8gdGhlIHJvbGVcbiAgICAgKiBvZiB0aGUga25vd2xlZGdlIGJhc2UgaWYgd2UgdXNlIHZlY3RvciBzdG9yZXNcbiAgICAgKiBvdGhlciB0aGFuIE9wZW5TZWFyY2ggU2VydmVybGVzcy5cbiAgICAgKi9cbiAgICBpZiAoISh0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgISh0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgT3BlblNlYXJjaE1hbmFnZWRDbHVzdGVyVmVjdG9yU3RvcmUpKSB7XG4gICAgICB0aGlzLnJvbGUuYWRkVG9QcmluY2lwYWxQb2xpY3koXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ3NlY3JldHNtYW5hZ2VyOkdldFNlY3JldFZhbHVlJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbdGhpcy52ZWN0b3JTdG9yZS5jcmVkZW50aWFsc1NlY3JldEFybl0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXZSBuZWVkIHRvIGFkZCBgcmRzLWRhdGE6RXhlY3V0ZVN0YXRlbWVudGAsXG4gICAgICogYHJkcy1kYXRhOkJhdGNoRXhlY3V0ZVN0YXRlbWVudGAgYW5kXG4gICAgICogYHJkczpEZXNjcmliZURCQ2x1c3RlcnNgIHRvIHRoZSByb2xlXG4gICAgICogb2YgdGhlIGtub3dsZWRnZSBiYXNlIGlmIHdlIHVzZSBBbWF6b24gQXVyb3JhIGFzXG4gICAgICogYSBkYXRhIHNvdXJjZS5cbiAgICAgKi9cbiAgICBpZiAoXG4gICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgKSB7XG4gICAgICB0aGlzLnJvbGUuYWRkVG9QcmluY2lwYWxQb2xpY3koXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAncmRzLWRhdGE6RXhlY3V0ZVN0YXRlbWVudCcsXG4gICAgICAgICAgICAncmRzLWRhdGE6QmF0Y2hFeGVjdXRlU3RhdGVtZW50JyxcbiAgICAgICAgICAgICdyZHM6RGVzY3JpYmVEQkNsdXN0ZXJzJyxcbiAgICAgICAgICBdLFxuICAgICAgICAgIHJlc291cmNlczogW3RoaXMudmVjdG9yU3RvcmUucmVzb3VyY2VBcm5dLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSB2ZWN0b3IgaW5kZXggaWYgdGhlIHZlY3RvciBzdG9yZSBpcyBPcGVuU2VhcmNoIFNlcnZlcmxlc3NcbiAgICAgKiBhbmQgaXQgd2FzIG5vdCBwcm92aWRlZC4gT3RoZXJ3aXNlIHVzZSB0aGUgcHJvdmlkZWQgdmVjdG9yIGluZGV4LlxuICAgICAqL1xuICAgIGlmICh0aGlzLnZlY3RvclN0b3JlVHlwZSA9PT0gVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfU0VSVkVSTEVTUykge1xuICAgICAgaWYgKCFwcm9wcy52ZWN0b3JJbmRleCkge1xuICAgICAgICB0aGlzLnZlY3RvckluZGV4ID0gbmV3IFZlY3RvckluZGV4KHRoaXMsICdLQkluZGV4Jywge1xuICAgICAgICAgIGNvbGxlY3Rpb246IHRoaXMudmVjdG9yU3RvcmUgYXMgVmVjdG9yQ29sbGVjdGlvbixcbiAgICAgICAgICBpbmRleE5hbWUsXG4gICAgICAgICAgdmVjdG9yRmllbGQsXG4gICAgICAgICAgdmVjdG9yRGltZW5zaW9uczogZW1iZWRkaW5nc01vZGVsLnZlY3RvckRpbWVuc2lvbnMhLFxuICAgICAgICAgIHByZWNpc2lvbjogcHJvcHMudmVjdG9yVHlwZSA9PT0gVmVjdG9yVHlwZS5CSU5BUlkgPyAnQmluYXJ5JyA6ICdmbG9hdCcsXG4gICAgICAgICAgZGlzdGFuY2VUeXBlOiBwcm9wcy52ZWN0b3JUeXBlID09PSBWZWN0b3JUeXBlLkJJTkFSWSA/ICdoYW1taW5nJyA6ICdsMicsXG4gICAgICAgICAgbWFwcGluZ3M6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbWFwcGluZ0ZpZWxkOiAnQU1BWk9OX0JFRFJPQ0tfVEVYVF9DSFVOSycsXG4gICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgIGZpbHRlcmFibGU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtYXBwaW5nRmllbGQ6ICdBTUFaT05fQkVEUk9DS19NRVRBREFUQScsXG4gICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgIGZpbHRlcmFibGU6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnZlY3RvckluZGV4Lm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvclN0b3JlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudmVjdG9ySW5kZXggPSBwcm9wcy52ZWN0b3JJbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgc3RvcmFnZSBjb25maWd1cmFpb24uIElmIGl0IGlzIG9mIHR5cGUgb2ZcbiAgICAgKiBgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVgIG9yIGBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlYCxcbiAgICAgKiB0aGVuIGdldCB0ZXh0RmllbGQsIG1ldGFkYXRhRmllbGQgYW5kIHZlY3RvckZpZWxkIGZyb21cbiAgICAgKiB0aGUgYXJndW1lbnRzLiBPdGhlcndpc2UgdXNlIGRlZmF1bHQgdmFsdWVzLlxuICAgICAqL1xuICAgIGNvbnN0IHN0b3JhZ2VDb25maWd1cmF0aW9uOiBTdG9yYWdlQ29uZmlndXJhdGlvbiA9IHtcbiAgICAgIGluZGV4TmFtZTogaW5kZXhOYW1lLFxuICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlLFxuICAgICAgdmVjdG9yRmllbGQ6XG4gICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICAgICAgICAgID8gdGhpcy52ZWN0b3JTdG9yZS52ZWN0b3JGaWVsZFxuICAgICAgICAgIDogdmVjdG9yRmllbGQsXG4gICAgICB0ZXh0RmllbGQ6XG4gICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgUGluZWNvbmVWZWN0b3JTdG9yZVxuICAgICAgICAgID8gdGhpcy52ZWN0b3JTdG9yZS50ZXh0RmllbGRcbiAgICAgICAgICA6IHRleHRGaWVsZCxcbiAgICAgIG1ldGFkYXRhRmllbGQ6XG4gICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgUGluZWNvbmVWZWN0b3JTdG9yZVxuICAgICAgICAgID8gdGhpcy52ZWN0b3JTdG9yZS5tZXRhZGF0YUZpZWxkXG4gICAgICAgICAgOiBtZXRhZGF0YUZpZWxkLFxuICAgIH07XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMMSBJbnN0YW50aWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29uc3Qga25vd2xlZGdlQmFzZSA9IG5ldyBiZWRyb2NrLkNmbktub3dsZWRnZUJhc2UodGhpcywgJ015Q2ZuS25vd2xlZGdlQmFzZScsIHtcbiAgICAgIGtub3dsZWRnZUJhc2VDb25maWd1cmF0aW9uOiB7XG4gICAgICAgIHR5cGU6IEtub3dsZWRnZUJhc2VUeXBlLlZFQ1RPUixcbiAgICAgICAgdmVjdG9yS25vd2xlZGdlQmFzZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBlbWJlZGRpbmdNb2RlbEFybjogZW1iZWRkaW5nc01vZGVsLmFzQXJuKHRoaXMpLFxuICAgICAgICAgIC8vIFVzZWQgdGhpcyBhcHByb2FjaCBhcyBpZiBwcm9wZXJ0eSBpcyBzcGVjaWZpZWQgb24gbW9kZWxzIHRoYXQgZG8gbm90XG4gICAgICAgICAgLy8gc3VwcG9ydCBjb25maWd1cmFibGUgZGltZW5zaW9ucyBDbG91ZEZvcm1hdGlvbiB0aHJvd3MgYW4gZXJyb3IgYXQgcnVudGltZVxuICAgICAgICAgIGVtYmVkZGluZ01vZGVsQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgYmVkcm9ja0VtYmVkZGluZ01vZGVsQ29uZmlndXJhdGlvbjpcbiAgICAgICAgICAgICAgZW1iZWRkaW5nc01vZGVsLm1vZGVsSWQgPT09ICdhbWF6b24udGl0YW4tZW1iZWQtdGV4dC12MjowJ1xuICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgZGltZW5zaW9uczogZW1iZWRkaW5nc01vZGVsLnZlY3RvckRpbWVuc2lvbnMsXG4gICAgICAgICAgICAgICAgICBlbWJlZGRpbmdEYXRhVHlwZTogdmVjdG9yVHlwZSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgOiB7IGVtYmVkZGluZ0RhdGFUeXBlOiB2ZWN0b3JUeXBlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICAuLi4ocHJvcHMuc3VwcGxlbWVudGFsRGF0YVN0b3JhZ2VMb2NhdGlvbnMgJiYgcHJvcHMuc3VwcGxlbWVudGFsRGF0YVN0b3JhZ2VMb2NhdGlvbnMubGVuZ3RoID4gMFxuICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgIHN1cHBsZW1lbnRhbERhdGFTdG9yYWdlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgICAgIHN1cHBsZW1lbnRhbERhdGFTdG9yYWdlTG9jYXRpb25zOiBwcm9wcy5zdXBwbGVtZW50YWxEYXRhU3RvcmFnZUxvY2F0aW9ucy5tYXAobG9jYXRpb24gPT4gbG9jYXRpb24uX19yZW5kZXIoKSksXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICByb2xlQXJuOiB0aGlzLnJvbGUucm9sZUFybixcbiAgICAgIHN0b3JhZ2VDb25maWd1cmF0aW9uOiBnZXRTdG9yYWdlQ29uZmlndXJhdGlvbihzdG9yYWdlQ29uZmlndXJhdGlvbiksXG4gICAgICBkZXNjcmlwdGlvbjogcHJvcHMuZGVzY3JpcHRpb24sXG4gICAgfSk7XG5cbiAgICB0aGlzLmtub3dsZWRnZUJhc2VJbnN0YW5jZSA9IGtub3dsZWRnZUJhc2U7XG5cbiAgICBjb25zdCBrYkNSUG9saWN5ID0gbmV3IGlhbS5Qb2xpY3kodGhpcywgJ0tCQ1JQb2xpY3knLCB7XG4gICAgICAvLyByb2xlczogW2NyUHJvdmlkZXIucm9sZV0sXG4gICAgICByb2xlczogW3RoaXMucm9sZV0sXG4gICAgICBzdGF0ZW1lbnRzOiBbXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAnYmVkcm9jazpDcmVhdGVLbm93bGVkZ2VCYXNlJyxcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogV2UgbmVlZCB0byBhZGQgYGJlZHJvY2s6QXNzb2NpYXRlVGhpcmRQYXJ0eUtub3dsZWRnZUJhc2VgIGlmXG4gICAgICAgICAgICAgKiB3ZSBhcmUgZGVwbG95aW5nIFJlZGlzIG9yIFBpbmVjb25lIGRhdGEgc291cmNlc1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAvLyAuLi4odGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5SRURJU19FTlRFUlBSSVNFX0NMT1VEIHx8XG4gICAgICAgICAgICAuLi4odGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORVxuICAgICAgICAgICAgICA/IFsnYmVkcm9jazpBc3NvY2lhdGVUaGlyZFBhcnR5S25vd2xlZGdlQmFzZSddXG4gICAgICAgICAgICAgIDogW10pLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAnYmVkcm9jazpVcGRhdGVLbm93bGVkZ2VCYXNlJyxcbiAgICAgICAgICAgICdiZWRyb2NrOkRlbGV0ZUtub3dsZWRnZUJhc2UnLFxuICAgICAgICAgICAgJ2JlZHJvY2s6VGFnUmVzb3VyY2UnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbXG4gICAgICAgICAgICBTdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgIHJlc291cmNlOiAna25vd2xlZGdlLWJhc2UnLFxuICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcqJyxcbiAgICAgICAgICAgICAgYXJuRm9ybWF0OiBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydpYW06UGFzc1JvbGUnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFt0aGlzLnJvbGUucm9sZUFybl0sXG4gICAgICAgIH0pLFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGtub3dsZWRnZUJhc2Uubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMucm9sZSk7XG4gICAga25vd2xlZGdlQmFzZS5ub2RlLmFkZERlcGVuZGVuY3koa2JDUlBvbGljeSk7XG4gICAgaWYgKHRoaXMudmVjdG9yU3RvcmVUeXBlID09PSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTICYmIHRoaXMudmVjdG9ySW5kZXgpIHtcbiAgICAgIGtub3dsZWRnZUJhc2Uubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMudmVjdG9ySW5kZXgpO1xuICAgIH1cbiAgICBpZiAodGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBKSB7XG4gICAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvclN0b3JlKTtcbiAgICB9XG5cbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICBrYkNSUG9saWN5LFxuICAgICAgW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdBd3NTb2x1dGlvbnMtSUFNNScsXG4gICAgICAgICAgcmVhc29uOiBcIkJlZHJvY2sgQ3JlYXRlS25vd2xlZGdlQmFzZSBjYW4ndCBiZSByZXN0cmljdGVkIGJ5IHJlc291cmNlLlwiLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHRydWUsXG4gICAgKTtcblxuICAgIHRoaXMua25vd2xlZGdlQmFzZUFybiA9IGtub3dsZWRnZUJhc2UuYXR0cktub3dsZWRnZUJhc2VBcm47XG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlSWQgPSBrbm93bGVkZ2VCYXNlLmF0dHJLbm93bGVkZ2VCYXNlSWQ7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIFZlY3RvckNvbGxlY3Rpb24gdHlwZSBvZiBWZWN0b3JTdG9yZS5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIC0gVGhlIHByb3BlcnRpZXMgb2YgdGhlIEtub3dsZWRnZUJhc2UuXG4gICAqIEByZXR1cm5zIFRoZSBpbnN0YW5jZSBvZiBWZWN0b3JDb2xsZWN0aW9uLCBWZWN0b3JTdG9yZVR5cGUuXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVPcGVuU2VhcmNoQ29sbGVjdGlvbihwcm9wczogVmVjdG9yS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBWZWN0b3JDb2xsZWN0aW9uO1xuICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICB9IHtcbiAgICBjb25zdCB2ZWN0b3JTdG9yZSA9IHByb3BzLnZlY3RvclN0b3JlIGFzIFZlY3RvckNvbGxlY3Rpb247XG4gICAgdmVjdG9yU3RvcmUuZ3JhbnREYXRhQWNjZXNzKHRoaXMucm9sZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZlY3RvclN0b3JlOiB2ZWN0b3JTdG9yZSxcbiAgICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfU0VSVkVSTEVTUyxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBQaW5lY29uZVZlY3RvclN0b3JlIHR5cGUgb2YgVmVjdG9yU3RvcmUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICAgKiBAcmV0dXJucyBUaGUgaW5zdGFuY2Ugb2YgUGluZWNvbmVWZWN0b3JTdG9yZSwgVmVjdG9yU3RvcmVUeXBlLlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlUGluZWNvbmVWZWN0b3JTdG9yZShwcm9wczogVmVjdG9yS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBQaW5lY29uZVZlY3RvclN0b3JlO1xuICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICB9IHtcbiAgICBjb25zdCB2ZWN0b3JTdG9yZSA9IHByb3BzLnZlY3RvclN0b3JlIGFzIFBpbmVjb25lVmVjdG9yU3RvcmU7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZlY3RvclN0b3JlOiB2ZWN0b3JTdG9yZSxcbiAgICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHR5cGUgb2YgVmVjdG9yU3RvcmUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICAgKiBAcmV0dXJucyBUaGUgaW5zdGFuY2Ugb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZUFtYXpvbkF1cm9yYVZlY3RvclN0b3JlKHByb3BzOiBWZWN0b3JLbm93bGVkZ2VCYXNlUHJvcHMpOiB7XG4gICAgdmVjdG9yU3RvcmU6IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHwgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZTtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPVxuICAgICAgcHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgICAgID8gcHJvcHMudmVjdG9yU3RvcmVcbiAgICAgICAgOiAocHJvcHMudmVjdG9yU3RvcmUgYXMgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIE9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlIHR5cGUgb2YgVmVjdG9yU3RvcmUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICAgKiBAcmV0dXJucyBUaGUgaW5zdGFuY2Ugb2YgT3BlblNlYXJjaE1hbmFnZWRDbHVzdGVyVmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZU9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlKHByb3BzOiBWZWN0b3JLbm93bGVkZ2VCYXNlUHJvcHMpOiB7XG4gICAgdmVjdG9yU3RvcmU6IE9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlO1xuICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICB9IHtcbiAgICBjb25zdCB2ZWN0b3JTdG9yZSA9IHByb3BzLnZlY3RvclN0b3JlIGFzIE9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX01BTkFHRURfQ0xVU1RFUixcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZSB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgS25vd2xlZGdlQmFzZS5cbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIE1vbmdvREJBdGxhc1ZlY3RvclN0b3JlLCBWZWN0b3JTdG9yZVR5cGUuXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVNb25nb0RCQXRsYXNWZWN0b3JTdG9yZShwcm9wczogVmVjdG9yS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZTtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZTtcbiAgICByZXR1cm4ge1xuICAgICAgdmVjdG9yU3RvcmU6IHZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGUuTU9OR09fREJfQVRMQVMsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGRlZmF1bHQgVmVjdG9yU3RvcmUgdHlwZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIFZlY3RvckNvbGxlY3Rpb24sIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZU9wZW5TZWFyY2hEZWZhdWx0VmVjdG9yQ29sbGVjdGlvbigpOiB7XG4gICAgdmVjdG9yU3RvcmU6IFZlY3RvckNvbGxlY3Rpb247XG4gICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gIH0ge1xuICAgIGNvbnN0IHZlY3RvclN0b3JlID0gbmV3IFZlY3RvckNvbGxlY3Rpb24odGhpcywgJ0tCVmVjdG9ycycpO1xuICAgIHZlY3RvclN0b3JlLmdyYW50RGF0YUFjY2Vzcyh0aGlzLnJvbGUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3NvY2lhdGUga25vd2xlZGdlIGJhc2Ugd2l0aCBhbiBhZ2VudFxuICAgKi9cbiAgcHVibGljIGFzc29jaWF0ZVRvQWdlbnQoYWdlbnQ6IEFnZW50KSB7XG4gICAgYWdlbnQuYWRkS25vd2xlZGdlQmFzZSh0aGlzKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgQmVkcm9jayBLbm93bGVkZ2UgQmFzZSBjYW4gdXNlIHRoZSBzZWxlY3RlZCBtb2RlbC5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVNb2RlbChmb3VuZGF0aW9uTW9kZWw6IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWwsIHZlY3RvclR5cGU6IFZlY3RvclR5cGUpIHtcbiAgaWYgKCFmb3VuZGF0aW9uTW9kZWwuc3VwcG9ydHNLbm93bGVkZ2VCYXNlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgbW9kZWwgJHtmb3VuZGF0aW9uTW9kZWx9IGlzIG5vdCBzdXBwb3J0ZWQgYnkgQmVkcm9jayBLbm93bGVkZ2UgQmFzZS5gKTtcbiAgfVxuICBpZiAoXG4gICAgZm91bmRhdGlvbk1vZGVsLnN1cHBvcnRlZFZlY3RvclR5cGUgJiZcbiAgICAhZm91bmRhdGlvbk1vZGVsLnN1cHBvcnRlZFZlY3RvclR5cGUuaW5jbHVkZXModmVjdG9yVHlwZSlcbiAgKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYFRoZSB2ZWN0b3IgdHlwZSAke3ZlY3RvclR5cGV9IGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIG1vZGVsICR7Zm91bmRhdGlvbk1vZGVsfS5gLFxuICAgICk7XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IHRoZSBzdG9yYWdlIGNvbmZpZ3VyYXRpb24gY2FuIHVzZSB0aGUgc2VsZWN0ZWQgdmVjdG9yIHR5cGUuXG4gKiBJdCBwcmV2ZW50cyB0aGUgdXNlIG9mIHZlY3RvciB0eXBlcyB3aXRoIHZlY3RvciBzdG9yZXMgdGhhdCBkbyBub3Qgc3VwcG9ydCB0aGVtLFxuICogdGhlcmVieSBhdm9pZGluZyBwb3RlbnRpYWwgcnVudGltZSBlcnJvcnMuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlVmVjdG9yVHlwZSh2ZWN0b3JTdG9yZTogYW55LCB2ZWN0b3JUeXBlOiBWZWN0b3JUeXBlKSB7XG4gIGlmICghKHZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgdmVjdG9yVHlwZSA9PSBWZWN0b3JUeXBlLkJJTkFSWSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdBbWF6b24gT3BlblNlYXJjaCBTZXJ2ZXJsZXNzIGlzIGN1cnJlbnRseSB0aGUgb25seSB2ZWN0b3Igc3RvcmUgdGhhdCBzdXBwb3J0cyBzdG9yaW5nIGJpbmFyeSB2ZWN0b3JzLicsXG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIGlmIFZlY3RvckluZGV4IHdhcyBwcm92aWRlZCBmb3IgYSBWZWN0b3JTdG9yZSBvZiB0eXBlXG4gKiBvdGhlciB0aGFuIGBWZWN0b3JDb2xsZWN0aW9uYC5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVWZWN0b3JJbmRleCh2ZWN0b3JTdG9yZTogYW55LCB2ZWN0b3JJbmRleDogYW55LCB2ZWN0b3JGaWVsZDogYW55LCBpbmRleE5hbWU6IGFueSkge1xuICBpZiAoISh2ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pICYmIHZlY3RvckluZGV4KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0lmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIFZlY3RvckNvbGxlY3Rpb24sIHZlY3RvckluZGV4IHNob3VsZCBub3QgYmUgcHJvdmlkZWQgJyArXG4gICAgICAgICdpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nLFxuICAgICk7XG4gIH1cbiAgaWYgKCEodmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBWZWN0b3JDb2xsZWN0aW9uKSAmJiBpbmRleE5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgVmVjdG9yQ29sbGVjdGlvbiwgaW5kZXhOYW1lIHNob3VsZCBub3QgYmUgcHJvdmlkZWQgJyArXG4gICAgICAgICdpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nLFxuICAgICk7XG4gIH1cbiAgaWYgKCEodmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBWZWN0b3JDb2xsZWN0aW9uKSAmJiB2ZWN0b3JGaWVsZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBWZWN0b3JDb2xsZWN0aW9uLCB2ZWN0b3JGaWVsZCBzaG91bGQgbm90IGJlIHByb3ZpZGVkICcgK1xuICAgICAgICAnaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICApO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgdGhhdCBpbmRleE5hbWUgYW5kIHZlY3RvckZpZWxkIHBhcmFtZXRlcnMgYXJlIGlkZW50aWNhbFxuICogaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QgaWYgVmVjdG9ySW5kZXggd2FzIGNyZWF0ZWQgbWFudWFsbHkuXG4gKlxuICogQnkgZGVmYXVsdCB3ZSBhc3NpZ24gYHZlY3RvckluZGV4YCB0byBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YFxuICogdmFsdWUgYW5kIGlmIHVzZXIgcHJvdmlkZXMgYHZlY3RvckluZGV4YCBtYW51YWxseSwgd2UgbmVlZCB0byBtYWtlIHN1cmVcbiAqIHRoZXkgYWxzbyBwcm92aWRlIGl0IGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0IGlmIHRoZSB2YWx1ZSBpcyBub3RcbiAqIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXhgLiBTYW1lIGZvciB2ZWN0b3JGaWVsZC5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVJbmRleFBhcmFtZXRlcnModmVjdG9ySW5kZXg6IFZlY3RvckluZGV4LCBpbmRleE5hbWU6IHN0cmluZywgdmVjdG9yRmllbGQ6IHN0cmluZykge1xuICBpZiAodmVjdG9ySW5kZXguaW5kZXhOYW1lICE9PSAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4Jykge1xuICAgIGlmICh2ZWN0b3JJbmRleC5pbmRleE5hbWUgIT09IGluZGV4TmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnRGVmYXVsdCB2YWx1ZSBvZiBpbmRleE5hbWUgaXMgYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGAuJyArXG4gICAgICAgICAgJyBJZiB5b3UgY3JlYXRlIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBhc3NpZ24gdmVjdG9ySW5kZXggdG8gdmFsdWUgb3RoZXIgdGhhbicgK1xuICAgICAgICAgICcgYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGAgdGhlbiB5b3UgbXVzdCBwcm92aWRlIHRoZSBzYW1lIHZhbHVlIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicgK1xuICAgICAgICAgICcgSWYgeW91IGNyZWF0ZWQgVmVjdG9ySW5kZXggbWFudWFsbHkgYW5kIHNldCBpdCB0byBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YCcgK1xuICAgICAgICAgICcgdGhlbiBkbyBub3QgYXNzaWduIGluZGV4TmFtZSBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgaWYgKHZlY3RvckluZGV4LnZlY3RvckZpZWxkICE9PSAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LXZlY3RvcicpIHtcbiAgICBpZiAodmVjdG9ySW5kZXgudmVjdG9yRmllbGQgIT09IHZlY3RvckZpZWxkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdEZWZhdWx0IHZhbHVlIG9mIHZlY3RvckZpZWxkIGlzIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtdmVjdG9yYC4nICtcbiAgICAgICAgICAnIElmIHlvdSBjcmVhdGUgVmVjdG9ySW5kZXggbWFudWFsbHkgYW5kIGFzc2lnbiB2ZWN0b3JGaWVsZCB0byB2YWx1ZSBvdGhlciB0aGFuJyArXG4gICAgICAgICAgJyBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWZpZWxkYCB0aGVuIHlvdSBtdXN0IHByb3ZpZGUgdGhlIHNhbWUgdmFsdWUgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyArXG4gICAgICAgICAgJyBJZiB5b3UgY3JlYXRlZCBWZWN0b3JJbmRleCBtYW51YWxseSBhbmQgc2V0IGl0IHRvIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtdmVjdG9yYCcgK1xuICAgICAgICAgICcgdGhlbiBkbyBub3QgYXNzaWduIHZlY3RvckZpZWxkIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicsXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIERldGVybWluZSBzdG9yYWdlIGNvbmZpZ3VyYXRpb24gYmFzZWQgb24gdmVjdG9yIHN0b3JlIHR5cGUuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIGdldFN0b3JhZ2VDb25maWd1cmF0aW9uKHBhcmFtczogU3RvcmFnZUNvbmZpZ3VyYXRpb24pOiBhbnkge1xuICBzd2l0Y2ggKHBhcmFtcy52ZWN0b3JTdG9yZVR5cGUpIHtcbiAgICBjYXNlIFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1M6XG4gICAgICBwYXJhbXMudmVjdG9yU3RvcmUgPSBwYXJhbXMudmVjdG9yU3RvcmUgYXMgVmVjdG9yQ29sbGVjdGlvbjtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgICAgIG9wZW5zZWFyY2hTZXJ2ZXJsZXNzQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIGNvbGxlY3Rpb25Bcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5jb2xsZWN0aW9uQXJuLFxuICAgICAgICAgIGZpZWxkTWFwcGluZzoge1xuICAgICAgICAgICAgdmVjdG9yRmllbGQ6IHBhcmFtcy52ZWN0b3JGaWVsZCxcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZCxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmVjdG9ySW5kZXhOYW1lOiBwYXJhbXMuaW5kZXhOYW1lLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICBjYXNlIFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORTpcbiAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSA9IHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBQaW5lY29uZVZlY3RvclN0b3JlO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FLFxuICAgICAgICBwaW5lY29uZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBuYW1lc3BhY2U6IHBhcmFtcy52ZWN0b3JTdG9yZS5uYW1lc3BhY2UgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIGNvbm5lY3Rpb25TdHJpbmc6IHBhcmFtcy52ZWN0b3JTdG9yZS5jb25uZWN0aW9uU3RyaW5nLFxuICAgICAgICAgIGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBwYXJhbXMudmVjdG9yU3RvcmUuY3JlZGVudGlhbHNTZWNyZXRBcm4sXG4gICAgICAgICAgZmllbGRNYXBwaW5nOiB7XG4gICAgICAgICAgICB0ZXh0RmllbGQ6IHBhcmFtcy50ZXh0RmllbGQsXG4gICAgICAgICAgICBtZXRhZGF0YUZpZWxkOiBwYXJhbXMubWV0YWRhdGFGaWVsZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICBjYXNlIFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBOlxuICAgICAgcGFyYW1zLnZlY3RvclN0b3JlID1cbiAgICAgICAgcGFyYW1zLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICAgICAgICAgID8gcGFyYW1zLnZlY3RvclN0b3JlXG4gICAgICAgICAgOiAocGFyYW1zLnZlY3RvclN0b3JlIGFzIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBLFxuICAgICAgICByZHNDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgY3JlZGVudGlhbHNTZWNyZXRBcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5jcmVkZW50aWFsc1NlY3JldEFybixcbiAgICAgICAgICBkYXRhYmFzZU5hbWU6IHBhcmFtcy52ZWN0b3JTdG9yZS5kYXRhYmFzZU5hbWUsXG4gICAgICAgICAgcmVzb3VyY2VBcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5yZXNvdXJjZUFybixcbiAgICAgICAgICB0YWJsZU5hbWU6IGAke3BhcmFtcy52ZWN0b3JTdG9yZS5zY2hlbWFOYW1lfS4ke3BhcmFtcy52ZWN0b3JTdG9yZS50YWJsZU5hbWV9YCxcbiAgICAgICAgICBmaWVsZE1hcHBpbmc6IHtcbiAgICAgICAgICAgIHZlY3RvckZpZWxkOiBwYXJhbXMudmVjdG9yRmllbGQucmVwbGFjZSgvLS9nLCAnXycpLFxuICAgICAgICAgICAgcHJpbWFyeUtleUZpZWxkOiBwYXJhbXMudmVjdG9yU3RvcmUucHJpbWFyeUtleUZpZWxkLFxuICAgICAgICAgICAgdGV4dEZpZWxkOiBwYXJhbXMudGV4dEZpZWxkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBtZXRhZGF0YUZpZWxkOiBwYXJhbXMubWV0YWRhdGFGaWVsZC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIGNhc2UgVmVjdG9yU3RvcmVUeXBlLk1PTkdPX0RCX0FUTEFTOlxuICAgICAgcGFyYW1zLnZlY3RvclN0b3JlID0gcGFyYW1zLnZlY3RvclN0b3JlIGFzIE1vbmdvREJBdGxhc1ZlY3RvclN0b3JlO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogVmVjdG9yU3RvcmVUeXBlLk1PTkdPX0RCX0FUTEFTLFxuICAgICAgICBtb25nb0RiQXRsYXNDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgY29sbGVjdGlvbk5hbWU6IHBhcmFtcy52ZWN0b3JTdG9yZS5jb2xsZWN0aW9uTmFtZSxcbiAgICAgICAgICBjcmVkZW50aWFsc1NlY3JldEFybjogcGFyYW1zLnZlY3RvclN0b3JlLmNyZWRlbnRpYWxzU2VjcmV0QXJuLFxuICAgICAgICAgIGRhdGFiYXNlTmFtZTogcGFyYW1zLnZlY3RvclN0b3JlLmRhdGFiYXNlTmFtZSxcbiAgICAgICAgICBlbmRwb2ludDogcGFyYW1zLnZlY3RvclN0b3JlLmVuZHBvaW50LFxuICAgICAgICAgIGVuZHBvaW50U2VydmljZU5hbWU6IHBhcmFtcy52ZWN0b3JTdG9yZS5lbmRwb2ludFNlcnZpY2VOYW1lLFxuICAgICAgICAgIGZpZWxkTWFwcGluZzoge1xuICAgICAgICAgICAgdmVjdG9yRmllbGQ6IHBhcmFtcy52ZWN0b3JGaWVsZCxcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZCxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmVjdG9ySW5kZXhOYW1lOiBwYXJhbXMuaW5kZXhOYW1lLFxuICAgICAgICAgIHRleHRJbmRleE5hbWU6IHBhcmFtcy52ZWN0b3JTdG9yZS50ZXh0SW5kZXhOYW1lLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICBjYXNlIFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX01BTkFHRURfQ0xVU1RFUjpcbiAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSA9IHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBPcGVuU2VhcmNoTWFuYWdlZENsdXN0ZXJWZWN0b3JTdG9yZTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX01BTkFHRURfQ0xVU1RFUixcbiAgICAgICAgb3BlbnNlYXJjaE1hbmFnZWRDbHVzdGVyQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIGRvbWFpbkFybjogcGFyYW1zLnZlY3RvclN0b3JlLmRvbWFpbkFybixcbiAgICAgICAgICBkb21haW5FbmRwb2ludDogcGFyYW1zLnZlY3RvclN0b3JlLmRvbWFpbkVuZHBvaW50LFxuICAgICAgICAgIGZpZWxkTWFwcGluZzoge1xuICAgICAgICAgICAgdmVjdG9yRmllbGQ6IHBhcmFtcy52ZWN0b3JGaWVsZCxcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZCxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmVjdG9ySW5kZXhOYW1lOiBwYXJhbXMuaW5kZXhOYW1lLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCB2ZWN0b3Igc3RvcmUgdHlwZTogJHtwYXJhbXMudmVjdG9yU3RvcmVUeXBlfWApO1xuICB9XG59XG4iXX0=