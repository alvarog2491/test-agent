"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Memory = void 0;
const jsiiDeprecationWarnings = require("../../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const core_1 = require("aws-cdk-lib/core");
const validation = require("./validation-helpers");
/**
 * Memory options for agent conversational context retention.
 * Memory enables agents to maintain context across multiple sessions and recall past interactions.
 * By default, agents retain context from the current session only.
 */
var MemoryType;
(function (MemoryType) {
    /**
     * Your agent uses memory summarization to enhance accuracy using
     * advanced prompt templates in Amazon Bedrock to call the foundation model with guidelines
     * to summarize all your sessions. You can optionally modify the default prompt template
     * or provide your own custom parser to parse model output.
     *
     * Since the summarization process takes place in an asynchronous flow after a session ends,
     * logs for any failures in summarization due to overridden template or parser will be
     * published to your AWS accounts. For more information on enabling the logging, see
     * Enable memory summarization log delivery.
     */
    MemoryType["SESSION_SUMMARY"] = "SESSION_SUMMARY";
})(MemoryType || (MemoryType = {}));
/**
 * Memory class for managing Bedrock Agent memory configurations. Enables conversational context retention
 * across multiple sessions through session identifiers. Memory context is stored with unique
 * memory IDs per user, allowing access to conversation history and summaries. Supports viewing
 * stored sessions and clearing memory.
 *
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/agents-memory.html
 */
class Memory {
    static [JSII_RTTI_SYMBOL_1] = { fqn: "@aws-cdk/aws-bedrock-alpha.Memory", version: "2.235.0-alpha.0" };
    /**
     * Returns session summary memory with default configuration.
     * @default memoryDuration=Duration.days(30), maxRecentSessions=20
     */
    static SESSION_SUMMARY = new Memory({ memoryDuration: core_1.Duration.days(30), maxRecentSessions: 20 });
    /**
     * Creates a session summary memory with custom configuration.
     * @param props Optional memory configuration properties
     * @returns Memory instance
     */
    static sessionSummary(props) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_bedrock_alpha_SessionSummaryMemoryProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.sessionSummary);
            }
            throw error;
        }
        return new Memory(props);
    }
    memoryDuration;
    maxRecentSessions;
    constructor(props) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_bedrock_alpha_SessionSummaryMemoryProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, Memory);
            }
            throw error;
        }
        // Validate props
        validation.throwIfInvalid((config) => {
            let errors = [];
            // Validate memory duration is between 1 and 365 days
            if (config.memoryDuration !== undefined) {
                const days = config.memoryDuration.toDays();
                if (days < 1 || days > 365) {
                    errors.push('memoryDuration must be between 1 and 365 days');
                }
            }
            if (config.maxRecentSessions !== undefined) {
                if (config.maxRecentSessions < 1) {
                    errors.push('maxRecentSessions must be greater than 0');
                }
            }
            return errors;
        }, props);
        this.memoryDuration = props.memoryDuration;
        this.maxRecentSessions = props.maxRecentSessions;
    }
    /**
     * Render the memory configuration to a CloudFormation property.
     * @internal
     */
    _render() {
        return {
            enabledMemoryTypes: [MemoryType.SESSION_SUMMARY],
            storageDays: this.memoryDuration?.toDays() ?? 30,
            sessionSummaryConfiguration: {
                maxRecentSessions: this.maxRecentSessions ?? 20,
            },
        };
    }
}
exports.Memory = Memory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVtb3J5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWVtb3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsMkNBQTRDO0FBQzVDLG1EQUFtRDtBQUVuRDs7OztHQUlHO0FBQ0gsSUFBSyxVQWFKO0FBYkQsV0FBSyxVQUFVO0lBQ2I7Ozs7Ozs7Ozs7T0FVRztJQUNILGlEQUFtQyxDQUFBO0FBQ3JDLENBQUMsRUFiSSxVQUFVLEtBQVYsVUFBVSxRQWFkO0FBbUJEOzs7Ozs7O0dBT0c7QUFDSCxNQUFhLE1BQU07O0lBQ2pCOzs7T0FHRztJQUNJLE1BQU0sQ0FBVSxlQUFlLEdBQUcsSUFBSSxNQUFNLENBQUMsRUFBRSxjQUFjLEVBQUUsZUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxpQkFBaUIsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRWxIOzs7O09BSUc7SUFDSSxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQWdDOzs7Ozs7Ozs7O1FBQzNELE9BQU8sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDMUI7SUFFZ0IsY0FBYyxDQUFZO0lBQzFCLGlCQUFpQixDQUFVO0lBRTVDLFlBQVksS0FBZ0M7Ozs7OzsrQ0FuQmpDLE1BQU07Ozs7UUFvQmYsaUJBQWlCO1FBQ2pCLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxNQUFpQyxFQUFFLEVBQUU7WUFDOUQsSUFBSSxNQUFNLEdBQWEsRUFBRSxDQUFDO1lBRTFCLHFEQUFxRDtZQUNyRCxJQUFJLE1BQU0sQ0FBQyxjQUFjLEtBQUssU0FBUyxFQUFFLENBQUM7Z0JBQ3hDLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQzVDLElBQUksSUFBSSxHQUFHLENBQUMsSUFBSSxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7b0JBQzNCLE1BQU0sQ0FBQyxJQUFJLENBQUMsK0NBQStDLENBQUMsQ0FBQztnQkFDL0QsQ0FBQztZQUNILENBQUM7WUFDRCxJQUFJLE1BQU0sQ0FBQyxpQkFBaUIsS0FBSyxTQUFTLEVBQUUsQ0FBQztnQkFDM0MsSUFBSSxNQUFNLENBQUMsaUJBQWlCLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQ2pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsMENBQTBDLENBQUMsQ0FBQztnQkFDMUQsQ0FBQztZQUNILENBQUM7WUFFRCxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFVixJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQyxjQUFjLENBQUM7UUFDM0MsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQztLQUNsRDtJQUVEOzs7T0FHRztJQUNJLE9BQU87UUFDWixPQUFPO1lBQ0wsa0JBQWtCLEVBQUUsQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDO1lBQ2hELFdBQVcsRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7WUFDaEQsMkJBQTJCLEVBQUU7Z0JBQzNCLGlCQUFpQixFQUFFLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxFQUFFO2FBQ2hEO1NBQ0YsQ0FBQztLQUNIOztBQXhESCx3QkF5REMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDZm5BZ2VudCB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1iZWRyb2NrJztcbmltcG9ydCB7IER1cmF0aW9uIH0gZnJvbSAnYXdzLWNkay1saWIvY29yZSc7XG5pbXBvcnQgKiBhcyB2YWxpZGF0aW9uIGZyb20gJy4vdmFsaWRhdGlvbi1oZWxwZXJzJztcblxuLyoqXG4gKiBNZW1vcnkgb3B0aW9ucyBmb3IgYWdlbnQgY29udmVyc2F0aW9uYWwgY29udGV4dCByZXRlbnRpb24uXG4gKiBNZW1vcnkgZW5hYmxlcyBhZ2VudHMgdG8gbWFpbnRhaW4gY29udGV4dCBhY3Jvc3MgbXVsdGlwbGUgc2Vzc2lvbnMgYW5kIHJlY2FsbCBwYXN0IGludGVyYWN0aW9ucy5cbiAqIEJ5IGRlZmF1bHQsIGFnZW50cyByZXRhaW4gY29udGV4dCBmcm9tIHRoZSBjdXJyZW50IHNlc3Npb24gb25seS5cbiAqL1xuZW51bSBNZW1vcnlUeXBlIHtcbiAgLyoqXG4gICAqIFlvdXIgYWdlbnQgdXNlcyBtZW1vcnkgc3VtbWFyaXphdGlvbiB0byBlbmhhbmNlIGFjY3VyYWN5IHVzaW5nXG4gICAqIGFkdmFuY2VkIHByb21wdCB0ZW1wbGF0ZXMgaW4gQW1hem9uIEJlZHJvY2sgdG8gY2FsbCB0aGUgZm91bmRhdGlvbiBtb2RlbCB3aXRoIGd1aWRlbGluZXNcbiAgICogdG8gc3VtbWFyaXplIGFsbCB5b3VyIHNlc3Npb25zLiBZb3UgY2FuIG9wdGlvbmFsbHkgbW9kaWZ5IHRoZSBkZWZhdWx0IHByb21wdCB0ZW1wbGF0ZVxuICAgKiBvciBwcm92aWRlIHlvdXIgb3duIGN1c3RvbSBwYXJzZXIgdG8gcGFyc2UgbW9kZWwgb3V0cHV0LlxuICAgKlxuICAgKiBTaW5jZSB0aGUgc3VtbWFyaXphdGlvbiBwcm9jZXNzIHRha2VzIHBsYWNlIGluIGFuIGFzeW5jaHJvbm91cyBmbG93IGFmdGVyIGEgc2Vzc2lvbiBlbmRzLFxuICAgKiBsb2dzIGZvciBhbnkgZmFpbHVyZXMgaW4gc3VtbWFyaXphdGlvbiBkdWUgdG8gb3ZlcnJpZGRlbiB0ZW1wbGF0ZSBvciBwYXJzZXIgd2lsbCBiZVxuICAgKiBwdWJsaXNoZWQgdG8geW91ciBBV1MgYWNjb3VudHMuIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIGVuYWJsaW5nIHRoZSBsb2dnaW5nLCBzZWVcbiAgICogRW5hYmxlIG1lbW9yeSBzdW1tYXJpemF0aW9uIGxvZyBkZWxpdmVyeS5cbiAgICovXG4gIFNFU1NJT05fU1VNTUFSWSA9ICdTRVNTSU9OX1NVTU1BUlknLFxufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIFNlc3Npb25TdW1tYXJ5Q29uZmlndXJhdGlvbi5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uU3VtbWFyeU1lbW9yeVByb3BzIHtcbiAgLyoqXG4gICAqIER1cmF0aW9uIGZvciB3aGljaCBzZXNzaW9uIHN1bW1hcmllcyBhcmUgcmV0YWluZWQgKGJldHdlZW4gMSBhbmQgMzY1IGRheXMpXG4gICAqIEBkZWZhdWx0IER1cmF0aW9uLmRheXMoMzApXG4gICAqL1xuICByZWFkb25seSBtZW1vcnlEdXJhdGlvbj86IER1cmF0aW9uO1xuXG4gIC8qKlxuICAgKiBNYXhpbXVtIG51bWJlciBvZiByZWNlbnQgc2Vzc2lvbiBzdW1tYXJpZXMgdG8gaW5jbHVkZSAobWluIDEpXG4gICAqIEBkZWZhdWx0IDIwXG4gICAqL1xuICByZWFkb25seSBtYXhSZWNlbnRTZXNzaW9ucz86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBNZW1vcnkgY2xhc3MgZm9yIG1hbmFnaW5nIEJlZHJvY2sgQWdlbnQgbWVtb3J5IGNvbmZpZ3VyYXRpb25zLiBFbmFibGVzIGNvbnZlcnNhdGlvbmFsIGNvbnRleHQgcmV0ZW50aW9uXG4gKiBhY3Jvc3MgbXVsdGlwbGUgc2Vzc2lvbnMgdGhyb3VnaCBzZXNzaW9uIGlkZW50aWZpZXJzLiBNZW1vcnkgY29udGV4dCBpcyBzdG9yZWQgd2l0aCB1bmlxdWVcbiAqIG1lbW9yeSBJRHMgcGVyIHVzZXIsIGFsbG93aW5nIGFjY2VzcyB0byBjb252ZXJzYXRpb24gaGlzdG9yeSBhbmQgc3VtbWFyaWVzLiBTdXBwb3J0cyB2aWV3aW5nXG4gKiBzdG9yZWQgc2Vzc2lvbnMgYW5kIGNsZWFyaW5nIG1lbW9yeS5cbiAqXG4gKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9iZWRyb2NrL2xhdGVzdC91c2VyZ3VpZGUvYWdlbnRzLW1lbW9yeS5odG1sXG4gKi9cbmV4cG9ydCBjbGFzcyBNZW1vcnkge1xuICAvKipcbiAgICogUmV0dXJucyBzZXNzaW9uIHN1bW1hcnkgbWVtb3J5IHdpdGggZGVmYXVsdCBjb25maWd1cmF0aW9uLlxuICAgKiBAZGVmYXVsdCBtZW1vcnlEdXJhdGlvbj1EdXJhdGlvbi5kYXlzKDMwKSwgbWF4UmVjZW50U2Vzc2lvbnM9MjBcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgU0VTU0lPTl9TVU1NQVJZID0gbmV3IE1lbW9yeSh7IG1lbW9yeUR1cmF0aW9uOiBEdXJhdGlvbi5kYXlzKDMwKSwgbWF4UmVjZW50U2Vzc2lvbnM6IDIwIH0pO1xuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgc2Vzc2lvbiBzdW1tYXJ5IG1lbW9yeSB3aXRoIGN1c3RvbSBjb25maWd1cmF0aW9uLlxuICAgKiBAcGFyYW0gcHJvcHMgT3B0aW9uYWwgbWVtb3J5IGNvbmZpZ3VyYXRpb24gcHJvcGVydGllc1xuICAgKiBAcmV0dXJucyBNZW1vcnkgaW5zdGFuY2VcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgc2Vzc2lvblN1bW1hcnkocHJvcHM6IFNlc3Npb25TdW1tYXJ5TWVtb3J5UHJvcHMpOiBNZW1vcnkge1xuICAgIHJldHVybiBuZXcgTWVtb3J5KHByb3BzKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVhZG9ubHkgbWVtb3J5RHVyYXRpb24/OiBEdXJhdGlvbjtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhSZWNlbnRTZXNzaW9ucz86IG51bWJlcjtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogU2Vzc2lvblN1bW1hcnlNZW1vcnlQcm9wcykge1xuICAgIC8vIFZhbGlkYXRlIHByb3BzXG4gICAgdmFsaWRhdGlvbi50aHJvd0lmSW52YWxpZCgoY29uZmlnOiBTZXNzaW9uU3VtbWFyeU1lbW9yeVByb3BzKSA9PiB7XG4gICAgICBsZXQgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgICAvLyBWYWxpZGF0ZSBtZW1vcnkgZHVyYXRpb24gaXMgYmV0d2VlbiAxIGFuZCAzNjUgZGF5c1xuICAgICAgaWYgKGNvbmZpZy5tZW1vcnlEdXJhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnN0IGRheXMgPSBjb25maWcubWVtb3J5RHVyYXRpb24udG9EYXlzKCk7XG4gICAgICAgIGlmIChkYXlzIDwgMSB8fCBkYXlzID4gMzY1KSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goJ21lbW9yeUR1cmF0aW9uIG11c3QgYmUgYmV0d2VlbiAxIGFuZCAzNjUgZGF5cycpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoY29uZmlnLm1heFJlY2VudFNlc3Npb25zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGNvbmZpZy5tYXhSZWNlbnRTZXNzaW9ucyA8IDEpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaCgnbWF4UmVjZW50U2Vzc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCcpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBlcnJvcnM7XG4gICAgfSwgcHJvcHMpO1xuXG4gICAgdGhpcy5tZW1vcnlEdXJhdGlvbiA9IHByb3BzLm1lbW9yeUR1cmF0aW9uO1xuICAgIHRoaXMubWF4UmVjZW50U2Vzc2lvbnMgPSBwcm9wcy5tYXhSZWNlbnRTZXNzaW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgdGhlIG1lbW9yeSBjb25maWd1cmF0aW9uIHRvIGEgQ2xvdWRGb3JtYXRpb24gcHJvcGVydHkuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcHVibGljIF9yZW5kZXIoKTogQ2ZuQWdlbnQuTWVtb3J5Q29uZmlndXJhdGlvblByb3BlcnR5IHtcbiAgICByZXR1cm4ge1xuICAgICAgZW5hYmxlZE1lbW9yeVR5cGVzOiBbTWVtb3J5VHlwZS5TRVNTSU9OX1NVTU1BUlldLFxuICAgICAgc3RvcmFnZURheXM6IHRoaXMubWVtb3J5RHVyYXRpb24/LnRvRGF5cygpID8/IDMwLFxuICAgICAgc2Vzc2lvblN1bW1hcnlDb25maWd1cmF0aW9uOiB7XG4gICAgICAgIG1heFJlY2VudFNlc3Npb25zOiB0aGlzLm1heFJlY2VudFNlc3Npb25zID8/IDIwLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG4iXX0=