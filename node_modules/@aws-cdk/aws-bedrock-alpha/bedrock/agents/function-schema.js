"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FunctionSchema = exports.Function = exports.FunctionParameter = exports.RequireConfirmation = exports.ParameterType = void 0;
const jsiiDeprecationWarnings = require("../../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const schema_base_1 = require("./schema-base");
const validation = require("./validation-helpers");
/**
 * Enum for parameter types in function schemas
 */
var ParameterType;
(function (ParameterType) {
    /**
     * String parameter type
     */
    ParameterType["STRING"] = "string";
    /**
     * Number parameter type
     */
    ParameterType["NUMBER"] = "number";
    /**
     * Integer parameter type
     */
    ParameterType["INTEGER"] = "integer";
    /**
     * Boolean parameter type
     */
    ParameterType["BOOLEAN"] = "boolean";
    /**
     * Array parameter type
     */
    ParameterType["ARRAY"] = "array";
    /**
     * Object parameter type
     */
    ParameterType["OBJECT"] = "object";
})(ParameterType || (exports.ParameterType = ParameterType = {}));
/**
 * Enum for require confirmation state in function schemas
 */
var RequireConfirmation;
(function (RequireConfirmation) {
    /**
     * Confirmation is enabled
     */
    RequireConfirmation["ENABLED"] = "ENABLED";
    /**
     * Confirmation is disabled
     */
    RequireConfirmation["DISABLED"] = "DISABLED";
})(RequireConfirmation || (exports.RequireConfirmation = RequireConfirmation = {}));
/**
 * Represents a function parameter in a function schema
 */
class FunctionParameter {
    static [JSII_RTTI_SYMBOL_1] = { fqn: "@aws-cdk/aws-bedrock-alpha.FunctionParameter", version: "2.235.0-alpha.0" };
    /**
     * The type of the parameter
     */
    type;
    /**
     * Whether the parameter is required
     */
    required;
    /**
     * Description of the parameter
     * @default undefined no description will be present
     */
    description;
    constructor(props) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_bedrock_alpha_FunctionParameterProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, FunctionParameter);
            }
            throw error;
        }
        // Validate description if provided
        if (props.description) {
            const descErrors = validation.validateStringFieldLength({
                fieldName: 'parameter description',
                value: props.description,
                minLength: 1,
                maxLength: 500,
            });
            if (descErrors.length > 0) {
                throw new validation.ValidationError(descErrors.join('\n'));
            }
        }
        this.type = props.type;
        this.required = props.required ?? true;
        this.description = props.description;
    }
    /**
     * Render the parameter as a CloudFormation property
     * @internal
     */
    _render() {
        return {
            type: this.type,
            required: this.required,
            description: this.description,
        };
    }
}
exports.FunctionParameter = FunctionParameter;
/**
 * Represents a function in a function schema
 */
class Function {
    static [JSII_RTTI_SYMBOL_1] = { fqn: "@aws-cdk/aws-bedrock-alpha.Function", version: "2.235.0-alpha.0" };
    /**
     * The name of the function
     */
    name;
    /**
     * Description of the function
     */
    description;
    /**
     * Parameters for the function
     */
    parameters;
    /**
     * Whether to require confirmation before executing the function
     */
    requireConfirmation;
    constructor(props) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_bedrock_alpha_FunctionProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, Function);
            }
            throw error;
        }
        // Validate function name
        const nameErrors = validation.validateStringFieldLength({
            fieldName: 'function name',
            value: props.name,
            minLength: 1,
            maxLength: 100,
        });
        if (nameErrors.length > 0) {
            throw new validation.ValidationError(nameErrors.join('\n'));
        }
        // Validate function description
        const descErrors = validation.validateStringFieldLength({
            fieldName: 'function description',
            value: props.description,
            minLength: 1,
            maxLength: 500,
        });
        if (descErrors.length > 0) {
            throw new validation.ValidationError(descErrors.join('\n'));
        }
        this.name = props.name;
        this.description = props.description;
        // Convert parameters object to a record of FunctionParameter instances
        this.parameters = {};
        if (props.parameters) {
            Object.entries(props.parameters).forEach(([name, paramProps]) => {
                // Validate parameter name
                const paramNameErrors = validation.validateStringFieldLength({
                    fieldName: 'parameter name',
                    value: name,
                    minLength: 1,
                    maxLength: 100,
                });
                if (paramNameErrors.length > 0) {
                    throw new validation.ValidationError(paramNameErrors.join('\n'));
                }
                this.parameters[name] = new FunctionParameter(paramProps);
            });
        }
        this.requireConfirmation = props.requireConfirmation ?? RequireConfirmation.DISABLED;
    }
    /**
     * Render the function as a CloudFormation property
     * @internal
     */
    _render() {
        const parametersObj = {};
        Object.entries(this.parameters).forEach(([name, param]) => {
            parametersObj[name] = param._render();
        });
        return {
            name: this.name,
            description: this.description,
            parameters: parametersObj,
            requireConfirmation: this.requireConfirmation,
        };
    }
}
exports.Function = Function;
/**
 * Represents a function schema for a Bedrock Agent Action Group
 */
class FunctionSchema extends schema_base_1.ActionGroupSchema {
    static [JSII_RTTI_SYMBOL_1] = { fqn: "@aws-cdk/aws-bedrock-alpha.FunctionSchema", version: "2.235.0-alpha.0" };
    /**
     * The functions defined in the schema
     */
    functions;
    constructor(props) {
        super();
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_bedrock_alpha_FunctionSchemaProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, FunctionSchema);
            }
            throw error;
        }
        if (!props.functions || props.functions.length === 0) {
            throw new validation.ValidationError('At least one function must be defined in the function schema');
        }
        this.functions = props.functions.map(f => new Function(f));
    }
    /**
     * Render the function schema as a CloudFormation property
     * @internal
     */
    _render() {
        return {
            functions: this.functions.map(f => f._render()),
        };
    }
}
exports.FunctionSchema = FunctionSchema;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnVuY3Rpb24tc2NoZW1hLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZnVuY3Rpb24tc2NoZW1hLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsK0NBQWtEO0FBQ2xELG1EQUFtRDtBQUVuRDs7R0FFRztBQUNILElBQVksYUE4Qlg7QUE5QkQsV0FBWSxhQUFhO0lBQ3ZCOztPQUVHO0lBQ0gsa0NBQWlCLENBQUE7SUFFakI7O09BRUc7SUFDSCxrQ0FBaUIsQ0FBQTtJQUVqQjs7T0FFRztJQUNILG9DQUFtQixDQUFBO0lBRW5COztPQUVHO0lBQ0gsb0NBQW1CLENBQUE7SUFFbkI7O09BRUc7SUFDSCxnQ0FBZSxDQUFBO0lBRWY7O09BRUc7SUFDSCxrQ0FBaUIsQ0FBQTtBQUNuQixDQUFDLEVBOUJXLGFBQWEsNkJBQWIsYUFBYSxRQThCeEI7QUFFRDs7R0FFRztBQUNILElBQVksbUJBVVg7QUFWRCxXQUFZLG1CQUFtQjtJQUM3Qjs7T0FFRztJQUNILDBDQUFtQixDQUFBO0lBRW5COztPQUVHO0lBQ0gsNENBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQVZXLG1CQUFtQixtQ0FBbkIsbUJBQW1CLFFBVTlCO0FBNkREOztHQUVHO0FBQ0gsTUFBYSxpQkFBaUI7O0lBQzVCOztPQUVHO0lBQ2EsSUFBSSxDQUFnQjtJQUVwQzs7T0FFRztJQUNhLFFBQVEsQ0FBVTtJQUVsQzs7O09BR0c7SUFDYSxXQUFXLENBQVU7SUFFckMsWUFBWSxLQUE2Qjs7Ozs7OytDQWpCOUIsaUJBQWlCOzs7O1FBa0IxQixtQ0FBbUM7UUFDbkMsSUFBSSxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdEIsTUFBTSxVQUFVLEdBQUcsVUFBVSxDQUFDLHlCQUF5QixDQUFDO2dCQUN0RCxTQUFTLEVBQUUsdUJBQXVCO2dCQUNsQyxLQUFLLEVBQUUsS0FBSyxDQUFDLFdBQVc7Z0JBQ3hCLFNBQVMsRUFBRSxDQUFDO2dCQUNaLFNBQVMsRUFBRSxHQUFHO2FBQ2YsQ0FBQyxD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QUFFLENBQUMsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUM1RDtJQUVEOzs7T0FHRztJQUNJLE9BQU87UUFDWixPQUFPO1lBQ0wsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1NBQ2hELENBQUM7S0FDSDs7QUF4Qkgsd0NBeUJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2ZuQWdlbnQgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtYmVkcm9jayc7XG5pbXBvcnQgeyBBY3Rpb25Hcm91cFNjaGVtYSB9IGZyb20gJy4vc2NoZW1hLWJhc2UnO1xuaW1wb3J0ICogYXMgdmFsaWRhdGlvbiBmcm9tICcuL3ZhbGlkYXRpb24taGVscGVycyc7XG5cbi8qKlxuICogRW51bSBmb3IgcGFyYW1ldGVyIHR5cGVzIGluIGZ1bmN0aW9uIHNjaGVtYXNcbiAqL1xuZXhwb3J0IGVudW0gUGFyYW1ldGVyVHlwZSB7XG4gIC8qKlxuICAgKiBTdHJpbmcgcGFyYW1ldGVyIHR5cGVcbiAgICovXG4gIFNUUklORyA9ICdzdHJpbmcnLFxuXG4gIC8qKlxuICAgKiBOdW1iZXIgcGFyYW1ldGVyIHR5cGVcbiAgICovXG4gIE5VTUJFUiA9ICdudW1iZXInLFxuXG4gIC8qKlxuICAgKiBJbnRlZ2VyIHBhcmFtZXRlciB0eXBlXG4gICAqL1xuICBJTlRFR0VSID0gJ2ludGVnZXInLFxuXG4gIC8qKlxuICAgKiBCb29sZWFuIHBhcmFtZXRlciB0eXBlXG4gICAqL1xuICBCT09MRUFOID0gJ2Jvb2xlYW4nLFxuXG4gIC8qKlxuICAgKiBBcnJheSBwYXJhbWV0ZXIgdHlwZVxuICAgKi9cbiAgQVJSQVkgPSAnYXJyYXknLFxuXG4gIC8qKlxuICAgKiBPYmplY3QgcGFyYW1ldGVyIHR5cGVcbiAgICovXG4gIE9CSkVDVCA9ICdvYmplY3QnLFxufVxuXG4vKipcbiAqIEVudW0gZm9yIHJlcXVpcmUgY29uZmlybWF0aW9uIHN0YXRlIGluIGZ1bmN0aW9uIHNjaGVtYXNcbiAqL1xuZXhwb3J0IGVudW0gUmVxdWlyZUNvbmZpcm1hdGlvbiB7XG4gIC8qKlxuICAgKiBDb25maXJtYXRpb24gaXMgZW5hYmxlZFxuICAgKi9cbiAgRU5BQkxFRCA9ICdFTkFCTEVEJyxcblxuICAvKipcbiAgICogQ29uZmlybWF0aW9uIGlzIGRpc2FibGVkXG4gICAqL1xuICBESVNBQkxFRCA9ICdESVNBQkxFRCcsXG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBmdW5jdGlvbiBwYXJhbWV0ZXJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGdW5jdGlvblBhcmFtZXRlclByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIHRoZSBwYXJhbWV0ZXJcbiAgICovXG4gIHJlYWRvbmx5IHR5cGU6IFBhcmFtZXRlclR5cGU7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHBhcmFtZXRlciBpcyByZXF1aXJlZFxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICByZWFkb25seSByZXF1aXJlZD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIERlc2NyaXB0aW9uIG9mIHRoZSBwYXJhbWV0ZXJcbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkIG5vIGRlc2NyaXB0aW9uIHdpbGwgYmUgcHJlc2VudFxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBmdW5jdGlvbiBpbiBhIGZ1bmN0aW9uIHNjaGVtYVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZ1bmN0aW9uUHJvcHMge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGZ1bmN0aW9uXG4gICAqL1xuICByZWFkb25seSBuYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIERlc2NyaXB0aW9uIG9mIHRoZSBmdW5jdGlvblxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb246IHN0cmluZztcblxuICAvKipcbiAgICogUGFyYW1ldGVycyBmb3IgdGhlIGZ1bmN0aW9uIGFzIGEgcmVjb3JkIG9mIHBhcmFtZXRlciBuYW1lIHRvIHBhcmFtZXRlciBwcm9wZXJ0aWVzXG4gICAqIEBkZWZhdWx0IHt9XG4gICAqL1xuICByZWFkb25seSBwYXJhbWV0ZXJzPzogUmVjb3JkPHN0cmluZywgRnVuY3Rpb25QYXJhbWV0ZXJQcm9wcz47XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gcmVxdWlyZSBjb25maXJtYXRpb24gYmVmb3JlIGV4ZWN1dGluZyB0aGUgZnVuY3Rpb25cbiAgICogQGRlZmF1bHQgUmVxdWlyZUNvbmZpcm1hdGlvbi5ESVNBQkxFRFxuICAgKi9cbiAgcmVhZG9ubHkgcmVxdWlyZUNvbmZpcm1hdGlvbj86IFJlcXVpcmVDb25maXJtYXRpb247XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBmdW5jdGlvbiBzY2hlbWFcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGdW5jdGlvblNjaGVtYVByb3BzIHtcbiAgLyoqXG4gICAqIEZ1bmN0aW9ucyBkZWZpbmVkIGluIHRoZSBzY2hlbWFcbiAgICovXG4gIHJlYWRvbmx5IGZ1bmN0aW9uczogRnVuY3Rpb25Qcm9wc1tdO1xufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgYSBmdW5jdGlvbiBwYXJhbWV0ZXIgaW4gYSBmdW5jdGlvbiBzY2hlbWFcbiAqL1xuZXhwb3J0IGNsYXNzIEZ1bmN0aW9uUGFyYW1ldGVyIHtcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIHRoZSBwYXJhbWV0ZXJcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB0eXBlOiBQYXJhbWV0ZXJUeXBlO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBwYXJhbWV0ZXIgaXMgcmVxdWlyZWRcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSByZXF1aXJlZDogYm9vbGVhbjtcblxuICAvKipcbiAgICogRGVzY3JpcHRpb24gb2YgdGhlIHBhcmFtZXRlclxuICAgKiBAZGVmYXVsdCB1bmRlZmluZWQgbm8gZGVzY3JpcHRpb24gd2lsbCBiZSBwcmVzZW50XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IEZ1bmN0aW9uUGFyYW1ldGVyUHJvcHMpIHtcbiAgICAvLyBWYWxpZGF0ZSBkZXNjcmlwdGlvbiBpZiBwcm92aWRlZFxuICAgIGlmIChwcm9wcy5kZXNjcmlwdGlvbikge1xuICAgICAgY29uc3QgZGVzY0Vycm9ycyA9IHZhbGlkYXRpb24udmFsaWRhdGVTdHJpbmdGaWVsZExlbmd0aCh7XG4gICAgICAgIGZpZWxkTmFtZTogJ3BhcmFtZXRlciBkZXNjcmlwdGlvbicsXG4gICAgICAgIHZhbHVlOiBwcm9wcy5kZXNjcmlwdGlvbixcbiAgICAgICAgbWluTGVuZ3RoOiAxLFxuICAgICAgICBtYXhMZW5ndGg6IDUwMCxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZGVzY0Vycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRocm93IG5ldyB2YWxpZGF0aW9uLlZhbGlkYXRpb25FcnJvcihkZXNjRXJyb3JzLmpvaW4oJ1xcbicpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnR5cGUgPSBwcm9wcy50eXBlO1xuICAgIHRoaXMucmVxdWlyZWQgPSBwcm9wcy5yZXF1aXJlZCA/PyB0cnVlO1xuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBwcm9wcy5kZXNjcmlwdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgdGhlIHBhcmFtZXRlciBhcyBhIENsb3VkRm9ybWF0aW9uIHByb3BlcnR5XG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcHVibGljIF9yZW5kZXIoKTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogdGhpcy50eXBlLFxuICAgICAgcmVxdWlyZWQ6IHRoaXMucmVxdWlyZWQsXG4gICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbixcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIGZ1bmN0aW9uIGluIGEgZnVuY3Rpb24gc2NoZW1hXG4gKi9cbmV4cG9ydCBjbGFzcyBGdW5jdGlvbiB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZnVuY3Rpb25cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBuYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIERlc2NyaXB0aW9uIG9mIHRoZSBmdW5jdGlvblxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRlc2NyaXB0aW9uOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFBhcmFtZXRlcnMgZm9yIHRoZSBmdW5jdGlvblxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHBhcmFtZXRlcnM6IFJlY29yZDxzdHJpbmcsIEZ1bmN0aW9uUGFyYW1ldGVyPjtcblxuICAvKipcbiAgICogV2hldGhlciB0byByZXF1aXJlIGNvbmZpcm1hdGlvbiBiZWZvcmUgZXhlY3V0aW5nIHRoZSBmdW5jdGlvblxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHJlcXVpcmVDb25maXJtYXRpb246IFJlcXVpcmVDb25maXJtYXRpb247XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IEZ1bmN0aW9uUHJvcHMpIHtcbiAgICAvLyBWYWxpZGF0ZSBmdW5jdGlvbiBuYW1lXG4gICAgY29uc3QgbmFtZUVycm9ycyA9IHZhbGlkYXRpb24udmFsaWRhdGVTdHJpbmdGaWVsZExlbmd0aCh7XG4gICAgICBmaWVsZE5hbWU6ICdmdW5jdGlvbiBuYW1lJyxcbiAgICAgIHZhbHVlOiBwcm9wcy5uYW1lLFxuICAgICAgbWluTGVuZ3RoOiAxLFxuICAgICAgbWF4TGVuZ3RoOiAxMDAsXG4gICAgfSk7XG5cbiAgICBpZiAobmFtZUVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICB0aHJvdyBuZXcgdmFsaWRhdGlvbi5WYWxpZGF0aW9uRXJyb3IobmFtZUVycm9ycy5qb2luKCdcXG4nKSk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgZnVuY3Rpb24gZGVzY3JpcHRpb25cbiAgICBjb25zdCBkZXNjRXJyb3JzID0gdmFsaWRhdGlvbi52YWxpZGF0ZVN0cmluZ0ZpZWxkTGVuZ3RoKHtcbiAgICAgIGZpZWxkTmFtZTogJ2Z1bmN0aW9uIGRlc2NyaXB0aW9uJyxcbiAgICAgIHZhbHVlOiBwcm9wcy5kZXNjcmlwdGlvbixcbiAgICAgIG1pbkxlbmd0aDogMSxcbiAgICAgIG1heExlbmd0aDogNTAwLFxuICAgIH0pO1xuXG4gICAgaWYgKGRlc2NFcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhyb3cgbmV3IHZhbGlkYXRpb24uVmFsaWRhdGlvbkVycm9yKGRlc2NFcnJvcnMuam9pbignXFxuJykpO1xuICAgIH1cblxuICAgIHRoaXMubmFtZSA9IHByb3BzLm5hbWU7XG4gICAgdGhpcy5kZXNjcmlwdGlvbiA9IHByb3BzLmRlc2NyaXB0aW9uO1xuXG4gICAgLy8gQ29udmVydCBwYXJhbWV0ZXJzIG9iamVjdCB0byBhIHJlY29yZCBvZiBGdW5jdGlvblBhcmFtZXRlciBpbnN0YW5jZXNcbiAgICB0aGlzLnBhcmFtZXRlcnMgPSB7fTtcbiAgICBpZiAocHJvcHMucGFyYW1ldGVycykge1xuICAgICAgT2JqZWN0LmVudHJpZXMocHJvcHMucGFyYW1ldGVycykuZm9yRWFjaCgoW25hbWUsIHBhcmFtUHJvcHNdKSA9PiB7XG4gICAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlciBuYW1lXG4gICAgICAgIGNvbnN0IHBhcmFtTmFtZUVycm9ycyA9IHZhbGlkYXRpb24udmFsaWRhdGVTdHJpbmdGaWVsZExlbmd0aCh7XG4gICAgICAgICAgZmllbGROYW1lOiAncGFyYW1ldGVyIG5hbWUnLFxuICAgICAgICAgIHZhbHVlOiBuYW1lLFxuICAgICAgICAgIG1pbkxlbmd0aDogMSxcbiAgICAgICAgICBtYXhMZW5ndGg6IDEwMCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHBhcmFtTmFtZUVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IHZhbGlkYXRpb24uVmFsaWRhdGlvbkVycm9yKHBhcmFtTmFtZUVycm9ycy5qb2luKCdcXG4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBhcmFtZXRlcnNbbmFtZV0gPSBuZXcgRnVuY3Rpb25QYXJhbWV0ZXIocGFyYW1Qcm9wcyk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLnJlcXVpcmVDb25maXJtYXRpb24gPSBwcm9wcy5yZXF1aXJlQ29uZmlybWF0aW9uID8/IFJlcXVpcmVDb25maXJtYXRpb24uRElTQUJMRUQ7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSBmdW5jdGlvbiBhcyBhIENsb3VkRm9ybWF0aW9uIHByb3BlcnR5XG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcHVibGljIF9yZW5kZXIoKTogYW55IHtcbiAgICBjb25zdCBwYXJhbWV0ZXJzT2JqOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG5cbiAgICBPYmplY3QuZW50cmllcyh0aGlzLnBhcmFtZXRlcnMpLmZvckVhY2goKFtuYW1lLCBwYXJhbV0pID0+IHtcbiAgICAgIHBhcmFtZXRlcnNPYmpbbmFtZV0gPSBwYXJhbS5fcmVuZGVyKCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAgcGFyYW1ldGVyczogcGFyYW1ldGVyc09iaixcbiAgICAgIHJlcXVpcmVDb25maXJtYXRpb246IHRoaXMucmVxdWlyZUNvbmZpcm1hdGlvbixcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIGZ1bmN0aW9uIHNjaGVtYSBmb3IgYSBCZWRyb2NrIEFnZW50IEFjdGlvbiBHcm91cFxuICovXG5leHBvcnQgY2xhc3MgRnVuY3Rpb25TY2hlbWEgZXh0ZW5kcyBBY3Rpb25Hcm91cFNjaGVtYSB7XG4gIC8qKlxuICAgKiBUaGUgZnVuY3Rpb25zIGRlZmluZWQgaW4gdGhlIHNjaGVtYVxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGZ1bmN0aW9uczogRnVuY3Rpb25bXTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogRnVuY3Rpb25TY2hlbWFQcm9wcykge1xuICAgIHN1cGVyKCk7XG5cbiAgICBpZiAoIXByb3BzLmZ1bmN0aW9ucyB8fCBwcm9wcy5mdW5jdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgdmFsaWRhdGlvbi5WYWxpZGF0aW9uRXJyb3IoJ0F0IGxlYXN0IG9uZSBmdW5jdGlvbiBtdXN0IGJlIGRlZmluZWQgaW4gdGhlIGZ1bmN0aW9uIHNjaGVtYScpO1xuICAgIH1cblxuICAgIHRoaXMuZnVuY3Rpb25zID0gcHJvcHMuZnVuY3Rpb25zLm1hcChmID0+IG5ldyBGdW5jdGlvbihmKSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSBmdW5jdGlvbiBzY2hlbWEgYXMgYSBDbG91ZEZvcm1hdGlvbiBwcm9wZXJ0eVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHB1YmxpYyBfcmVuZGVyKCk6IENmbkFnZW50LkZ1bmN0aW9uU2NoZW1hUHJvcGVydHkge1xuICAgIHJldHVybiB7XG4gICAgICBmdW5jdGlvbnM6IHRoaXMuZnVuY3Rpb25zLm1hcChmID0+IGYuX3JlbmRlcigpKSxcbiAgICB9O1xuICB9XG59XG4iXX0=