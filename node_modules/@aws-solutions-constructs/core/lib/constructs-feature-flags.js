"use strict";
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConstructsFeatureFlagsReport = void 0;
/*
 *  The functions found here in the core library are for internal use and can be changed
 *  or removed outside of a major release. We recommend against calling them directly from client code.
 */
const constructs_1 = require("constructs");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const cloud_assembly_schema_1 = require("@aws-cdk/cloud-assembly-schema");
const QUEUE_USE_SSE = "@aws-solutions-constructs/aws-sqs:QueueUseSse";
/**
 * A CDK L3 construct that creates resources for Solutions Feature Flags reporting
 */
class ConstructsFeatureFlagsReport extends constructs_1.Construct {
    static ensure(scope) {
        const app = scope.node.root;
        if (!app || !aws_cdk_lib_1.App.isApp(app)) {
            throw new Error('Invalid scope provided to ConstructsFeatureFlagsReport');
        }
        const id = 'AwsSolutionsFeatureFlagsReport';
        if (!app.node.tryFindChild(id)) {
            new ConstructsFeatureFlagsReport(app, id);
        }
    }
    constructor(scope, id) {
        super(scope, id);
        (0, aws_cdk_lib_1.attachCustomSynthesis)(this, {
            onSynthesize: (session) => {
                session.assembly.addArtifact("@aws-solutions-constructs/feature-flag-report", {
                    type: cloud_assembly_schema_1.ArtifactType.FEATURE_FLAG_REPORT,
                    properties: {
                        module: '@aws-solutions-constructs',
                        flags: this.GetFlagDefinitions()
                    }
                });
            }
        });
    }
    GetFlagDefinitions() {
        return {
            [QUEUE_USE_SSE]: {
                recommendedValue: true,
                explanation: "Change the default behavior for the construct to encrypt the queue using Server Side Encryption (SSE)",
                userValue: this.node.tryGetContext(QUEUE_USE_SSE)
            }
        };
    }
}
exports.ConstructsFeatureFlagsReport = ConstructsFeatureFlagsReport;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uc3RydWN0cy1mZWF0dXJlLWZsYWdzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29uc3RydWN0cy1mZWF0dXJlLWZsYWdzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7O0FBRUg7OztHQUdHO0FBRUgsMkNBQXVDO0FBQ3ZDLDZDQUE0RTtBQUM1RSwwRUFBMkU7QUFFM0UsTUFBTSxhQUFhLEdBQUcsK0NBQStDLENBQUM7QUFFdEU7O0dBRUc7QUFDSCxNQUFhLDRCQUE2QixTQUFRLHNCQUFTO0lBRWxELE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBZ0I7UUFDbkMsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDNUIsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLGlCQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDNUIsTUFBTSxJQUFJLEtBQUssQ0FBQyx3REFBd0QsQ0FBQyxDQUFDO1FBQzVFLENBQUM7UUFDRCxNQUFNLEVBQUUsR0FBRyxnQ0FBZ0MsQ0FBQztRQUM1QyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUMvQixJQUFJLDRCQUE0QixDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM1QyxDQUFDO0lBQ0gsQ0FBQztJQUVELFlBQW9CLEtBQWdCLEVBQUUsRUFBVTtRQUM5QyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpCLElBQUEsbUNBQXFCLEVBQUMsSUFBSSxFQUFFO1lBQzFCLFlBQVksRUFBRSxDQUFDLE9BQTBCLEVBQUUsRUFBRTtnQkFDM0MsT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsK0NBQStDLEVBQUU7b0JBQzVFLElBQUksRUFBRSxvQ0FBWSxDQUFDLG1CQUFtQjtvQkFDdEMsVUFBVSxFQUFFO3dCQUNWLE1BQU0sRUFBRSwyQkFBMkI7d0JBQ25DLEtBQUssRUFBRSxJQUFJLENBQUMsa0JBQWtCLEVBQUU7cUJBQ2pDO2lCQUNGLENBQUMsQ0FBQztZQUNMLENBQUM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8sa0JBQWtCO1FBQ3RCLE9BQU87WUFDTCxDQUFDLGFBQWEsQ0FBQyxFQUFFO2dCQUNmLGdCQUFnQixFQUFFLElBQUk7Z0JBQ3RCLFdBQVcsRUFBRSx1R0FBdUc7Z0JBQ3BILFNBQVMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUM7YUFDbEQ7U0FDRixDQUFDO0lBQ0osQ0FBQztDQUNKO0FBdENELG9FQXNDQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8qXG4gKiAgVGhlIGZ1bmN0aW9ucyBmb3VuZCBoZXJlIGluIHRoZSBjb3JlIGxpYnJhcnkgYXJlIGZvciBpbnRlcm5hbCB1c2UgYW5kIGNhbiBiZSBjaGFuZ2VkXG4gKiAgb3IgcmVtb3ZlZCBvdXRzaWRlIG9mIGEgbWFqb3IgcmVsZWFzZS4gV2UgcmVjb21tZW5kIGFnYWluc3QgY2FsbGluZyB0aGVtIGRpcmVjdGx5IGZyb20gY2xpZW50IGNvZGUuXG4gKi9cblxuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyBBcHAsIGF0dGFjaEN1c3RvbVN5bnRoZXNpcywgSVN5bnRoZXNpc1Nlc3Npb24gfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBBcnRpZmFjdFR5cGUsIEZlYXR1cmVGbGFnIH0gZnJvbSAnQGF3cy1jZGsvY2xvdWQtYXNzZW1ibHktc2NoZW1hJztcblxuY29uc3QgUVVFVUVfVVNFX1NTRSA9IFwiQGF3cy1zb2x1dGlvbnMtY29uc3RydWN0cy9hd3Mtc3FzOlF1ZXVlVXNlU3NlXCI7XG5cbi8qKlxuICogQSBDREsgTDMgY29uc3RydWN0IHRoYXQgY3JlYXRlcyByZXNvdXJjZXMgZm9yIFNvbHV0aW9ucyBGZWF0dXJlIEZsYWdzIHJlcG9ydGluZ1xuICovXG5leHBvcnQgY2xhc3MgQ29uc3RydWN0c0ZlYXR1cmVGbGFnc1JlcG9ydCBleHRlbmRzIENvbnN0cnVjdCB7XG5cbiAgcHVibGljIHN0YXRpYyBlbnN1cmUoc2NvcGU6IENvbnN0cnVjdCkge1xuICAgIGNvbnN0IGFwcCA9IHNjb3BlLm5vZGUucm9vdDtcbiAgICBpZiAoIWFwcCB8fCAhQXBwLmlzQXBwKGFwcCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBzY29wZSBwcm92aWRlZCB0byBDb25zdHJ1Y3RzRmVhdHVyZUZsYWdzUmVwb3J0Jyk7XG4gICAgfVxuICAgIGNvbnN0IGlkID0gJ0F3c1NvbHV0aW9uc0ZlYXR1cmVGbGFnc1JlcG9ydCc7XG4gICAgaWYgKCFhcHAubm9kZS50cnlGaW5kQ2hpbGQoaWQpKSB7XG4gICAgICBuZXcgQ29uc3RydWN0c0ZlYXR1cmVGbGFnc1JlcG9ydChhcHAsIGlkKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgYXR0YWNoQ3VzdG9tU3ludGhlc2lzKHRoaXMsIHtcbiAgICAgIG9uU3ludGhlc2l6ZTogKHNlc3Npb246IElTeW50aGVzaXNTZXNzaW9uKSA9PiB7XG4gICAgICAgIHNlc3Npb24uYXNzZW1ibHkuYWRkQXJ0aWZhY3QoXCJAYXdzLXNvbHV0aW9ucy1jb25zdHJ1Y3RzL2ZlYXR1cmUtZmxhZy1yZXBvcnRcIiwge1xuICAgICAgICAgIHR5cGU6IEFydGlmYWN0VHlwZS5GRUFUVVJFX0ZMQUdfUkVQT1JULFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIG1vZHVsZTogJ0Bhd3Mtc29sdXRpb25zLWNvbnN0cnVjdHMnLFxuICAgICAgICAgICAgZmxhZ3M6IHRoaXMuR2V0RmxhZ0RlZmluaXRpb25zKClcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBHZXRGbGFnRGVmaW5pdGlvbnMoKTogUmVjb3JkIDwgc3RyaW5nLCBGZWF0dXJlRmxhZyA+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFtRVUVVRV9VU0VfU1NFXToge1xuICAgICAgICAgIHJlY29tbWVuZGVkVmFsdWU6IHRydWUsXG4gICAgICAgICAgZXhwbGFuYXRpb246IFwiQ2hhbmdlIHRoZSBkZWZhdWx0IGJlaGF2aW9yIGZvciB0aGUgY29uc3RydWN0IHRvIGVuY3J5cHQgdGhlIHF1ZXVlIHVzaW5nIFNlcnZlciBTaWRlIEVuY3J5cHRpb24gKFNTRSlcIixcbiAgICAgICAgICB1c2VyVmFsdWU6IHRoaXMubm9kZS50cnlHZXRDb250ZXh0KFFVRVVFX1VTRV9TU0UpXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxufVxuIl19