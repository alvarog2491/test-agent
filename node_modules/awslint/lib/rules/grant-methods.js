"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.grantsMethodsLinter = void 0;
const linter_1 = require("../linter");
const EXCLUDE_ANNOTATION_NO_GRANTS = '[disable-awslint:no-grants]';
exports.grantsMethodsLinter = new linter_1.Linter(assembly => assembly.allClasses);
exports.grantsMethodsLinter.add({
    code: 'no-grants',
    message: 'L2 constructs are not allowed to have new "grantXxx()" methods. Create or re-use a companion <Contruct>Grants class instead.',
    eval: e => {
        Object.values(e.ctx.getMethods())
            .filter(m => !m.static)
            .filter(m => !m.abstract)
            .filter(m => m.name.startsWith('grant') && m.name !== 'grantOnKey')
            .filter(m => m.parameters.length > 0 && m.parameters[0].type.fqn === 'aws-cdk-lib.aws_iam.IGrantable')
            .forEach((grant) => {
            e.assert(isExempted(grant), `${e.ctx.fqn}.${grant.name}`);
        });
    },
});
function isExempted(method) {
    const docs = method.docs;
    return [docs.summary, docs.remarks].some(doc => doc.includes(EXCLUDE_ANNOTATION_NO_GRANTS));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhbnQtbWV0aG9kcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdyYW50LW1ldGhvZHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0Esc0NBQW1DO0FBRW5DLE1BQU0sNEJBQTRCLEdBQUcsNkJBQTZCLENBQUM7QUFFdEQsUUFBQSxtQkFBbUIsR0FBRyxJQUFJLGVBQU0sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUUvRSwyQkFBbUIsQ0FBQyxHQUFHLENBQUM7SUFDdEIsSUFBSSxFQUFFLFdBQVc7SUFDakIsT0FBTyxFQUFFLDhIQUE4SDtJQUN2SSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUU7UUFDUixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLENBQUM7YUFDOUIsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO2FBQ3RCLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQzthQUN4QixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxLQUFLLFlBQVksQ0FBQzthQUNsRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLGdDQUFnQyxDQUFDO2FBQ3JHLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ2pCLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsU0FBUyxVQUFVLENBQUMsTUFBYztJQUNoQyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ3pCLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLDRCQUE0QixDQUFDLENBQUMsQ0FBQztBQUM5RixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWV0aG9kIH0gZnJvbSAnanNpaS1yZWZsZWN0JztcbmltcG9ydCB7IExpbnRlciB9IGZyb20gJy4uL2xpbnRlcic7XG5cbmNvbnN0IEVYQ0xVREVfQU5OT1RBVElPTl9OT19HUkFOVFMgPSAnW2Rpc2FibGUtYXdzbGludDpuby1ncmFudHNdJztcblxuZXhwb3J0IGNvbnN0IGdyYW50c01ldGhvZHNMaW50ZXIgPSBuZXcgTGludGVyKGFzc2VtYmx5ID0+IGFzc2VtYmx5LmFsbENsYXNzZXMpO1xuXG5ncmFudHNNZXRob2RzTGludGVyLmFkZCh7XG4gIGNvZGU6ICduby1ncmFudHMnLFxuICBtZXNzYWdlOiAnTDIgY29uc3RydWN0cyBhcmUgbm90IGFsbG93ZWQgdG8gaGF2ZSBuZXcgXCJncmFudFh4eCgpXCIgbWV0aG9kcy4gQ3JlYXRlIG9yIHJlLXVzZSBhIGNvbXBhbmlvbiA8Q29udHJ1Y3Q+R3JhbnRzIGNsYXNzIGluc3RlYWQuJyxcbiAgZXZhbDogZSA9PiB7XG4gICAgT2JqZWN0LnZhbHVlcyhlLmN0eC5nZXRNZXRob2RzKCkpXG4gICAgICAuZmlsdGVyKG0gPT4gIW0uc3RhdGljKVxuICAgICAgLmZpbHRlcihtID0+ICFtLmFic3RyYWN0KVxuICAgICAgLmZpbHRlcihtID0+IG0ubmFtZS5zdGFydHNXaXRoKCdncmFudCcpICYmIG0ubmFtZSAhPT0gJ2dyYW50T25LZXknKVxuICAgICAgLmZpbHRlcihtID0+IG0ucGFyYW1ldGVycy5sZW5ndGggPiAwICYmIG0ucGFyYW1ldGVyc1swXS50eXBlLmZxbiA9PT0gJ2F3cy1jZGstbGliLmF3c19pYW0uSUdyYW50YWJsZScpXG4gICAgICAuZm9yRWFjaCgoZ3JhbnQpID0+IHtcbiAgICAgICAgZS5hc3NlcnQoaXNFeGVtcHRlZChncmFudCksIGAke2UuY3R4LmZxbn0uJHtncmFudC5uYW1lfWApO1xuICAgICAgfSk7XG4gIH0sXG59KTtcblxuZnVuY3Rpb24gaXNFeGVtcHRlZChtZXRob2Q6IE1ldGhvZCk6IGJvb2xlYW4ge1xuICBjb25zdCBkb2NzID0gbWV0aG9kLmRvY3M7XG4gIHJldHVybiBbZG9jcy5zdW1tYXJ5LCBkb2NzLnJlbWFya3NdLnNvbWUoZG9jID0+IGRvYy5pbmNsdWRlcyhFWENMVURFX0FOTk9UQVRJT05fTk9fR1JBTlRTKSk7XG59XG4iXX0=