"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.integrationLinter = void 0;
const util_1 = require("./util");
const linter_1 = require("../linter");
exports.integrationLinter = new linter_1.Linter(assembly => assembly.allInterfaces
    .filter(IntegrationReflection.isIntegrationInterface)
    .map(construct => new IntegrationReflection(construct)));
const BIND_METHOD_NAME = 'bind';
class IntegrationReflection {
    integrationInterface;
    static isIntegrationInterface(x) {
        return x.allMethods.some(m => m.name === BIND_METHOD_NAME);
    }
    constructor(integrationInterface) {
        this.integrationInterface = integrationInterface;
    }
    get bindMethod() {
        return this.integrationInterface.allMethods.find(m => m.name === BIND_METHOD_NAME);
    }
}
exports.integrationLinter.add({
    code: 'integ-return-type',
    message: '\'bind(...)\' should return a type named \'XxxConfig\'',
    eval: e => {
        const returnsFqn = e.ctx.bindMethod.returns.type.fqn;
        e.assert(returnsFqn && returnsFqn.endsWith('Config'), (0, util_1.memberFqn)(e.ctx.bindMethod));
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW50ZWdyYXRpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaW50ZWdyYXRpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLGlDQUFtQztBQUNuQyxzQ0FBbUM7QUFFdEIsUUFBQSxpQkFBaUIsR0FBRyxJQUFJLGVBQU0sQ0FBd0IsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsYUFBYTtLQUNsRyxNQUFNLENBQUMscUJBQXFCLENBQUMsc0JBQXNCLENBQUM7S0FDcEQsR0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsSUFBSSxxQkFBcUIsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFM0QsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUM7QUFFaEMsTUFBTSxxQkFBcUI7SUFLRztJQUpyQixNQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBd0I7UUFDM0QsT0FBTyxDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssZ0JBQWdCLENBQUMsQ0FBQztJQUM3RCxDQUFDO0lBRUQsWUFBNEIsb0JBQTJDO1FBQTNDLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBdUI7SUFDdkUsQ0FBQztJQUVELElBQVcsVUFBVTtRQUNuQixPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxnQkFBZ0IsQ0FBRSxDQUFDO0lBQ3RGLENBQUM7Q0FDRjtBQUVELHlCQUFpQixDQUFDLEdBQUcsQ0FBQztJQUNwQixJQUFJLEVBQUUsbUJBQW1CO0lBQ3pCLE9BQU8sRUFBRSx3REFBd0Q7SUFDakUsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFO1FBQ1IsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7UUFFckQsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLElBQUksVUFBVSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFBLGdCQUFTLEVBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7Q0FDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyByZWZsZWN0IGZyb20gJ2pzaWktcmVmbGVjdCc7XG5pbXBvcnQgeyBtZW1iZXJGcW4gfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IHsgTGludGVyIH0gZnJvbSAnLi4vbGludGVyJztcblxuZXhwb3J0IGNvbnN0IGludGVncmF0aW9uTGludGVyID0gbmV3IExpbnRlcjxJbnRlZ3JhdGlvblJlZmxlY3Rpb24+KGFzc2VtYmx5ID0+IGFzc2VtYmx5LmFsbEludGVyZmFjZXNcbiAgLmZpbHRlcihJbnRlZ3JhdGlvblJlZmxlY3Rpb24uaXNJbnRlZ3JhdGlvbkludGVyZmFjZSlcbiAgLm1hcChjb25zdHJ1Y3QgPT4gbmV3IEludGVncmF0aW9uUmVmbGVjdGlvbihjb25zdHJ1Y3QpKSk7XG5cbmNvbnN0IEJJTkRfTUVUSE9EX05BTUUgPSAnYmluZCc7XG5cbmNsYXNzIEludGVncmF0aW9uUmVmbGVjdGlvbiB7XG4gIHB1YmxpYyBzdGF0aWMgaXNJbnRlZ3JhdGlvbkludGVyZmFjZSh4OiByZWZsZWN0LkludGVyZmFjZVR5cGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4geC5hbGxNZXRob2RzLnNvbWUobSA9PiBtLm5hbWUgPT09IEJJTkRfTUVUSE9EX05BTUUpO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IGludGVncmF0aW9uSW50ZXJmYWNlOiByZWZsZWN0LkludGVyZmFjZVR5cGUpIHtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYmluZE1ldGhvZCgpOiByZWZsZWN0Lk1ldGhvZCB7XG4gICAgcmV0dXJuIHRoaXMuaW50ZWdyYXRpb25JbnRlcmZhY2UuYWxsTWV0aG9kcy5maW5kKG0gPT4gbS5uYW1lID09PSBCSU5EX01FVEhPRF9OQU1FKSE7XG4gIH1cbn1cblxuaW50ZWdyYXRpb25MaW50ZXIuYWRkKHtcbiAgY29kZTogJ2ludGVnLXJldHVybi10eXBlJyxcbiAgbWVzc2FnZTogJ1xcJ2JpbmQoLi4uKVxcJyBzaG91bGQgcmV0dXJuIGEgdHlwZSBuYW1lZCBcXCdYeHhDb25maWdcXCcnLFxuICBldmFsOiBlID0+IHtcbiAgICBjb25zdCByZXR1cm5zRnFuID0gZS5jdHguYmluZE1ldGhvZC5yZXR1cm5zLnR5cGUuZnFuO1xuXG4gICAgZS5hc3NlcnQocmV0dXJuc0ZxbiAmJiByZXR1cm5zRnFuLmVuZHNXaXRoKCdDb25maWcnKSwgbWVtYmVyRnFuKGUuY3R4LmJpbmRNZXRob2QpKTtcbiAgfSxcbn0pO1xuIl19