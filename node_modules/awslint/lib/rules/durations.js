"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.durationsLinter = void 0;
const linter_1 = require("../linter");
const DURATION_FQN = 'aws-cdk-lib.Duration';
const DURATION_SUFFIX = /(Days|Milli(?:(?:S|s)econd)?s?|Sec(?:ond)?s?)$/;
const EXCLUDE_ANNOTATION_DURATION_PROP_TYPE = '[disable-awslint:duration-prop-type]';
exports.durationsLinter = new linter_1.Linter(assm => {
    const result = new Array();
    const generatedClassesPrefix = `${assm.name}.Cfn`;
    for (const type of assm.types) {
        // L1 classes are exempted from this rule, doing basic name matching here...
        if (type.fqn.startsWith(generatedClassesPrefix)) {
            continue;
        }
        if (!type.isClassType() && !type.isDataType() && !type.isInterfaceType()) {
            continue;
        }
        for (const property of type.allProperties) {
            if (isDurationProperty(property)
                && !property.docs.toString().includes(EXCLUDE_ANNOTATION_DURATION_PROP_TYPE)) {
                result.push(property);
            }
        }
    }
    return result;
    function isDurationProperty(prop) {
        const lowerCaseName = prop.name.toLowerCase();
        // No lookbehind in JS regexes, so excluding "*PerSecond" by hand here...
        return (DURATION_SUFFIX.test(prop.name) && !/PerSecond$/.test(prop.name))
            || lowerCaseName.endsWith('duration')
            || lowerCaseName.endsWith('period')
            || lowerCaseName.endsWith('timeout')
            || lowerCaseName.endsWith('ttl')
            || prop.type.fqn === DURATION_FQN;
    }
});
exports.durationsLinter.add({
    code: 'duration-prop-type',
    message: `property must be typed ${DURATION_FQN}`,
    eval: evaluation => {
        evaluation.assert(evaluation.ctx.type.fqn === DURATION_FQN, `${evaluation.ctx.parentType.fqn}.${evaluation.ctx.name}`);
    },
});
exports.durationsLinter.add({
    code: 'duration-prop-name',
    message: 'property must not use time-unit suffix',
    eval: evaluation => {
        evaluation.assert(!DURATION_SUFFIX.test(evaluation.ctx.name), `${evaluation.ctx.parentType.fqn}.${evaluation.ctx.name}`, `(suggested name: "${evaluation.ctx.name.replace(DURATION_SUFFIX, '')}")`);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHVyYXRpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZHVyYXRpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLHNDQUFtQztBQUVuQyxNQUFNLFlBQVksR0FBRyxzQkFBc0IsQ0FBQztBQUM1QyxNQUFNLGVBQWUsR0FBRyxnREFBZ0QsQ0FBQztBQUN6RSxNQUFNLHFDQUFxQyxHQUFHLHNDQUFzQyxDQUFDO0FBRXhFLFFBQUEsZUFBZSxHQUFHLElBQUksZUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQy9DLE1BQU0sTUFBTSxHQUFHLElBQUksS0FBSyxFQUFZLENBQUM7SUFDckMsTUFBTSxzQkFBc0IsR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQztJQUNsRCxLQUFLLE1BQU0sSUFBSSxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM5Qiw0RUFBNEU7UUFDNUUsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLENBQUM7WUFBQyxTQUFTO1FBQUMsQ0FBQztRQUM5RCxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxFQUFFLENBQUM7WUFBQyxTQUFTO1FBQUMsQ0FBQztRQUN2RixLQUFLLE1BQU0sUUFBUSxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUMxQyxJQUFJLGtCQUFrQixDQUFDLFFBQVEsQ0FBQzttQkFDekIsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxxQ0FBcUMsQ0FBQyxFQUFFLENBQUM7Z0JBQ2pGLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEIsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBQ0QsT0FBTyxNQUFNLENBQUM7SUFFZCxTQUFTLGtCQUFrQixDQUFDLElBQWM7UUFDeEMsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM5Qyx5RUFBeUU7UUFDekUsT0FBTyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7ZUFDcEUsYUFBYSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUM7ZUFDbEMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUM7ZUFDaEMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUM7ZUFDakMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUM7ZUFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssWUFBWSxDQUFDO0lBQ3RDLENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILHVCQUFlLENBQUMsR0FBRyxDQUFDO0lBQ2xCLElBQUksRUFBRSxvQkFBb0I7SUFDMUIsT0FBTyxFQUFFLDBCQUEwQixZQUFZLEVBQUU7SUFDakQsSUFBSSxFQUFFLFVBQVUsQ0FBQyxFQUFFO1FBQ2pCLFVBQVUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLFlBQVksRUFDeEQsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQy9ELENBQUM7Q0FDRixDQUFDLENBQUM7QUFFSCx1QkFBZSxDQUFDLEdBQUcsQ0FBQztJQUNsQixJQUFJLEVBQUUsb0JBQW9CO0lBQzFCLE9BQU8sRUFBRSx3Q0FBd0M7SUFDakQsSUFBSSxFQUFFLFVBQVUsQ0FBQyxFQUFFO1FBQ2pCLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQzFELEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQ3pELHFCQUFxQixVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvRSxDQUFDO0NBQ0YsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tICdqc2lpLXJlZmxlY3QnO1xuaW1wb3J0IHsgTGludGVyIH0gZnJvbSAnLi4vbGludGVyJztcblxuY29uc3QgRFVSQVRJT05fRlFOID0gJ2F3cy1jZGstbGliLkR1cmF0aW9uJztcbmNvbnN0IERVUkFUSU9OX1NVRkZJWCA9IC8oRGF5c3xNaWxsaSg/Oig/OlN8cyllY29uZCk/cz98U2VjKD86b25kKT9zPykkLztcbmNvbnN0IEVYQ0xVREVfQU5OT1RBVElPTl9EVVJBVElPTl9QUk9QX1RZUEUgPSAnW2Rpc2FibGUtYXdzbGludDpkdXJhdGlvbi1wcm9wLXR5cGVdJztcblxuZXhwb3J0IGNvbnN0IGR1cmF0aW9uc0xpbnRlciA9IG5ldyBMaW50ZXIoYXNzbSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IG5ldyBBcnJheTxQcm9wZXJ0eT4oKTtcbiAgY29uc3QgZ2VuZXJhdGVkQ2xhc3Nlc1ByZWZpeCA9IGAke2Fzc20ubmFtZX0uQ2ZuYDtcbiAgZm9yIChjb25zdCB0eXBlIG9mIGFzc20udHlwZXMpIHtcbiAgICAvLyBMMSBjbGFzc2VzIGFyZSBleGVtcHRlZCBmcm9tIHRoaXMgcnVsZSwgZG9pbmcgYmFzaWMgbmFtZSBtYXRjaGluZyBoZXJlLi4uXG4gICAgaWYgKHR5cGUuZnFuLnN0YXJ0c1dpdGgoZ2VuZXJhdGVkQ2xhc3Nlc1ByZWZpeCkpIHsgY29udGludWU7IH1cbiAgICBpZiAoIXR5cGUuaXNDbGFzc1R5cGUoKSAmJiAhdHlwZS5pc0RhdGFUeXBlKCkgJiYgIXR5cGUuaXNJbnRlcmZhY2VUeXBlKCkpIHsgY29udGludWU7IH1cbiAgICBmb3IgKGNvbnN0IHByb3BlcnR5IG9mIHR5cGUuYWxsUHJvcGVydGllcykge1xuICAgICAgaWYgKGlzRHVyYXRpb25Qcm9wZXJ0eShwcm9wZXJ0eSlcbiAgICAgICAgICAmJiAhcHJvcGVydHkuZG9jcy50b1N0cmluZygpLmluY2x1ZGVzKEVYQ0xVREVfQU5OT1RBVElPTl9EVVJBVElPTl9QUk9QX1RZUEUpKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHByb3BlcnR5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcblxuICBmdW5jdGlvbiBpc0R1cmF0aW9uUHJvcGVydHkocHJvcDogUHJvcGVydHkpOiBib29sZWFuIHtcbiAgICBjb25zdCBsb3dlckNhc2VOYW1lID0gcHJvcC5uYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgLy8gTm8gbG9va2JlaGluZCBpbiBKUyByZWdleGVzLCBzbyBleGNsdWRpbmcgXCIqUGVyU2Vjb25kXCIgYnkgaGFuZCBoZXJlLi4uXG4gICAgcmV0dXJuIChEVVJBVElPTl9TVUZGSVgudGVzdChwcm9wLm5hbWUpICYmICEvUGVyU2Vjb25kJC8udGVzdChwcm9wLm5hbWUpKVxuICAgICAgfHwgbG93ZXJDYXNlTmFtZS5lbmRzV2l0aCgnZHVyYXRpb24nKVxuICAgICAgfHwgbG93ZXJDYXNlTmFtZS5lbmRzV2l0aCgncGVyaW9kJylcbiAgICAgIHx8IGxvd2VyQ2FzZU5hbWUuZW5kc1dpdGgoJ3RpbWVvdXQnKVxuICAgICAgfHwgbG93ZXJDYXNlTmFtZS5lbmRzV2l0aCgndHRsJylcbiAgICAgIHx8IHByb3AudHlwZS5mcW4gPT09IERVUkFUSU9OX0ZRTjtcbiAgfVxufSk7XG5cbmR1cmF0aW9uc0xpbnRlci5hZGQoe1xuICBjb2RlOiAnZHVyYXRpb24tcHJvcC10eXBlJyxcbiAgbWVzc2FnZTogYHByb3BlcnR5IG11c3QgYmUgdHlwZWQgJHtEVVJBVElPTl9GUU59YCxcbiAgZXZhbDogZXZhbHVhdGlvbiA9PiB7XG4gICAgZXZhbHVhdGlvbi5hc3NlcnQoZXZhbHVhdGlvbi5jdHgudHlwZS5mcW4gPT09IERVUkFUSU9OX0ZRTixcbiAgICAgIGAke2V2YWx1YXRpb24uY3R4LnBhcmVudFR5cGUuZnFufS4ke2V2YWx1YXRpb24uY3R4Lm5hbWV9YCk7XG4gIH0sXG59KTtcblxuZHVyYXRpb25zTGludGVyLmFkZCh7XG4gIGNvZGU6ICdkdXJhdGlvbi1wcm9wLW5hbWUnLFxuICBtZXNzYWdlOiAncHJvcGVydHkgbXVzdCBub3QgdXNlIHRpbWUtdW5pdCBzdWZmaXgnLFxuICBldmFsOiBldmFsdWF0aW9uID0+IHtcbiAgICBldmFsdWF0aW9uLmFzc2VydCghRFVSQVRJT05fU1VGRklYLnRlc3QoZXZhbHVhdGlvbi5jdHgubmFtZSksXG4gICAgICBgJHtldmFsdWF0aW9uLmN0eC5wYXJlbnRUeXBlLmZxbn0uJHtldmFsdWF0aW9uLmN0eC5uYW1lfWAsXG4gICAgICBgKHN1Z2dlc3RlZCBuYW1lOiBcIiR7ZXZhbHVhdGlvbi5jdHgubmFtZS5yZXBsYWNlKERVUkFUSU9OX1NVRkZJWCwgJycpfVwiKWApO1xuICB9LFxufSk7XG4iXX0=